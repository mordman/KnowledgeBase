# Pomodoro Timer
    Сделать помодоро таймер с пмощью скриптового языка с запуском из 'коробки'.


# 📚 Полная документация Pomodoro Widget

## 1. Общее описание приложения

**Pomodoro Widget** — это легковесное настольное приложение-таймер для работы по методике Pomodoro. Написано на Python с использованием библиотеки `tkinter`.

### 🎯 Ключевые особенности:
| Характеристика | Описание |
|----------------|----------|
| **Размер кода** | ~520 строк (оптимизировано) |
| **Зависимости** | Только стандартные библиотеки Python |
| **Платформа** | Windows, macOS, Linux |
| **Режим работы** | Окно поверх всех приложений (Always on Top) |
| **Прозрачность** | Настраиваемая (0.5-1.0) |

### ⏱ Функционал:
- ✅ Таймер работы и отдыха с настраиваемым временем
- ✅ 6+ тем оформления с возможностью создания своих
- ✅ История сессий с сохранением в JSON
- ✅ Статистика по выполненным сессиям
- ✅ Авто-сохранение позиции и настроек окна
- ✅ Импорт/экспорт тем оформления

---

## 2. Структура файлов

```
pomodoro/
├── pomodoro.py              # Основной скрипт (520 строк)
├── config.json              # Настройки приложения
├── pomodoro_history.json    # История сессий
└── themes/                  # Папка с темами
    ├── dark.json            # Тёмная тема
    ├── light.json           # Светлая тема
    └── blue.json            # Синяя тема
```

---

## 3. Архитектура кода

### 📊 Схема классов:

```
┌─────────────────────────────────────────────────────────┐
│                    class Pomodoro                       │
├─────────────────────────────────────────────────────────┤
│  Атрибуты:                                              │
│  • root (Tk)           • themes (dict)                  │
│  • config (dict)       • history (list)                 │
│  • theme (dict)        • time, running, work_mode       │
├─────────────────────────────────────────────────────────┤
│  Методы инициализации:                                  │
│  • __init__()          • load_config()                  │
│  • setup_window()      • load_themes()                  │
│  • setup_ui()          • load_json()                    │
│  • setup_bindings()    • save_json()                    │
├─────────────────────────────────────────────────────────┤
│  Методы таймера:                                        │
│  • toggle()            • switch_mode()                  │
│  • countdown()         • reset()                        │
│  • update_display()    • save_session()                 │
│  • get_duration()                                       │
├─────────────────────────────────────────────────────────┤
│  Методы интерфейса:                                     │
│  • open_settings()     • create_btn()                   │
│  • open_stats()        • tooltip()                      │
│  • apply_theme()       • close_app()                    │
└─────────────────────────────────────────────────────────┘
```

---

## 4. Описание ключевых методов

### 🔹 Инициализация и загрузка

| Метод | Строки | Описание |
|-------|--------|----------|
| `__init__()` | 24-39 | Создание окна, загрузка конфига, тем, истории |
| `load_config()` | 41-51 | Загрузка `config.json` с применением значений по умолчанию |
| `load_themes()` | 60-74 | Сканирование папки `themes/`, загрузка всех `.json` файлов |
| `load_json()` | 53-58 | Универсальная загрузка JSON файлов |
| `save_json()` | 60-62 | Универсальное сохранение JSON файлов |

### 🔹 Настройка интерфейса

| Метод | Строки | Описание |
|-------|--------|----------|
| `setup_window()` | 93-98 | Настройка главного окна (размер, прозрачность, topmost) |
| `setup_ui()` | 100-125 | Создание кнопок, таймера, метки режима |
| `setup_bindings()` | 127-133 | Привязка событий мыши (перетаскивание, клики) |
| `tooltip()` | 135-144 | Создание всплывающих подсказок для кнопок |
| `create_btn()` | 208-211 | Универсальное создание кнопок |

### 🔹 Логика таймера

| Метод | Строки | Описание |
|-------|--------|----------|
| `toggle()` | 146-155 | Старт/пауза таймера по клику |
| `countdown()` | 157-163 | Рекурсивный отсчёт времени (каждую секунду) |
| `switch_mode()` | 165-175 | Переключение Работа ↔ Отдых |
| `reset()` | 177-186 | Сброс таймера в начальное состояние |
| `update_display()` | 188-189 | Обновление отображения времени (MM:SS) |
| `save_session()` | 191-198 | Сохранение завершённой сессии в историю |
| `get_duration()` | 200-202 | Получение длительности (совместимость форматов) |

### 🔹 Окна настроек и статистики

| Метод | Строки | Описание |
|-------|--------|----------|
| `open_settings()` | 213-295 | Окно настроек (время, размер, тема, тексты) |
| `open_stats()` | 297-355 | Окно статистики с прокручиваемой историей |
| `apply_theme()` | 357-364 | Применение выбранной темы ко всем элементам |
| `close_app()` | 366-371 | Закрытие приложения с сохранением настроек |

---

## 5. Формат конфигурационных файлов

### 📋 `config.json` — Настройки приложения

```json
{
  "work_time": 25,           // Время работы (минуты)
  "break_time": 5,           // Время отдыха (минуты)
  "opacity": 0.95,           // Прозрачность окна (0.5-1.0)
  "pos_x": 100,              // Позиция окна X
  "pos_y": 100,              // Позиция окна Y
  "width": 240,              // Ширина окна (пиксели)
  "height": 100,             // Высота окна (пиксели)
  "theme": "dark",           // Ключ активной темы
  "sound": true,             // Звуковые уведомления
  "auto_start": true,        // Автозапуск после переключения
  "work_text": "WORK",       // Текст режима работы
  "break_text": "BREAK"      // Текст режима отдыха
}
```

### 📋 `pomodoro_history.json` — История сессий

```json
[
  {
    "date": "2024-01-15 10:30:00",
    "type": "Work",
    "duration": 1500
  },
  {
    "date": "2024-01-15 11:00:00",
    "type": "Break",
    "duration": 300
  }
]
```

### 📋 `themes/*.json` — Файл темы

```json
{
  "name": "Тёмная",
  "bg_primary": "#1a1a1a",       // Фон главного окна
  "bg_secondary": "#2a2a2a",     // Фон окон настроек/статистики
  "bg_button": "#333333",        // Фон кнопок
  "bg_button_active": "#555555", // Фон кнопок при наведении
  "fg_primary": "#ffffff",       // Основной текст
  "fg_secondary": "#888888",     // Вторичный текст
  "fg_accent": "#4CAF50",        // Цвет таймера (работа)
  "fg_break": "#2196F3",         // Цвет таймера (отдых)
  "fg_pause": "#FF9800",         // Цвет таймера (пауза)
  "btn_close_bg": "#ff4444",     // Фон кнопки закрытия
  "btn_close_fg": "#ffffff",     // Текст кнопки закрытия
  "font_time": ["Helvetica", 32, "bold"],    // Шрифт таймера
  "font_text": ["Arial", 10, "bold"],        // Шрифт текста
  "font_button": ["Arial", 11]               // Шрифт кнопок
}
```

---

## 6. Поток выполнения программы

```
┌─────────────┐
│   Запуск    │
│ pomodoro.py │
└──────┬──────┘
       │
       ▼
┌─────────────────┐
│ __init__()      │
│ • Загрузка конфига │
│ • Загрузка тем     │
│ • Загрузка истории │
└──────┬──────────┘
       │
       ▼
┌─────────────────┐
│ setup_window()  │
│ • Создание окна │
│ • Настройка GUI │
└──────┬──────────┘
       │
       ▼
┌─────────────────┐
│ setup_ui()      │
│ • Кнопки        │
│ • Таймер        │
│ • Метки         │
└──────┬──────────┘
       │
       ▼
┌─────────────────┐
│ setup_bindings()│
│ • События мыши  │
│ • Перетаскивание│
└──────┬──────────┘
       │
       ▼
┌─────────────────┐
│ run()           │
│ • mainloop()    │
│ • Ожидание      │
│ • событий       │
└─────────────────┘
```

---

## 7. Управление приложением

### 🖱️ Жесты мыши:

| Действие | Управление |
|----------|------------|
| Старт/Пауза | Левый клик по таймеру |
| Сброс | Правый клик мыши |
| Перетаскивание | Зажать левую кнопку + движение |
| Закрытие | Двойной клик или кнопка ✕ |

### ⚙️ Окно настроек (⚙️):

| Параметр | Описание |
|----------|----------|
| Время работы | Длительность сессии работы (мин) |
| Время отдыха | Длительность перерыва (мин) |
| Ширина/Высота | Размер главного окна (пиксели) |
| Текст работы | Надпись в режиме работы |
| Текст отдыха | Надпись в режиме отдыха |
| Тема | Выбор из доступных тем |
| Звук | Вкл/выкл звуковые уведомления |
| Автозапуск | Автоматический старт после переключения |

### 📊 Окно статистики (📊):

- Общая статистика (всего сессий, время работы/отдыха)
- Последние 10 сессий с датой и длительностью
- Кнопка очистки истории

---

### 💡 Ключевые оптимизации:

1. **Универсальные функции:**
   ```python
   def load_json(path, default)  # Вместо 3 отдельных функций
   def create_btn(...)           # Вместо дублирования кода кнопок
   def get_duration(session)     # Совместимость форматов
   ```

2. **Ленивая загрузка:**
   ```python
   self.themes = self.load_themes()  # Один раз при старте
   ```

3. **Безопасный доступ:**
   ```python
   session.get('duration', session.get('duration_seconds', 0))
   ```

4. **Компактные привязки:**
   ```python
   widget.bind("<ButtonPress-1>", lambda e: setattr(self, '_drag', ...))
   ```

---

## 9. Инструкция по использованию

### 📥 Установка:

```bash
# 1. Создайте папку для проекта
mkdir pomodoro
cd pomodoro

# 2. Сохраните код в файл pomodoro.py
# 3. Запустите приложение
python pomodoro.py
```

### 🎨 Добавление своей темы:

1. Скопируйте любой файл из `themes/`
2. Переименуйте (например, `my_theme.json`)
3. Измените цвета в JSON
4. Перезапустите приложение

### 🔄 Сброс настроек:

```bash
# Удалите файлы конфига
rm config.json
rm pomodoro_history.json

# При следующем запуске создадутся новые с настройками по умолчанию
```

---

## 10. Технические характеристики

| Параметр | Значение |
|----------|----------|
| **Язык** | Python 3.6+ |
| **GUI** | tkinter (стандартная библиотека) |
| **Хранение данных** | JSON файлы |
| **Память** | ~32 MB |
| **Время запуска** | ~0.5 сек |
| **Размер дистрибутива** | < 50 KB (без Python) |

---

## 11. Расширяемость

### 📦 Как добавить новую функцию:

1. **Новая настройка:** Добавьте ключ в `DEFAULTS` и поле в `open_settings()`
2. **Новая тема:** Создайте JSON файл в папке `themes/`
3. **Новое событие:** Добавьте `bind()` в `setup_bindings()`
4. **Новое окно:** Создайте метод по аналогии с `open_stats()`

### 🔧 Точки расширения:

```python
# В DEFAULTS добавьте новую настройку
DEFAULTS = {
    ...
    "new_feature": True,
}

# В setup_ui() добавьте новый элемент
# В open_settings() добавьте поле настройки
# В save() добавьте сохранение значения
```

---

## 12. Заключение

**Pomodoro Widget** — это пример компактного, оптимизированного приложения с:

- ✅ **Минимальными зависимостями** (только стандартная библиотека)
- ✅ **Модульной архитектурой** (легко расширять)
- ✅ **Полной кастомизацией** (темы, размеры, тексты)
- ✅ **Сохранением состояния** (позиция, настройки, история)
- ✅ **Кроссплатформенностью** (Windows, macOS, Linux)

Код написан с соблюдением принципов **DRY** (Don't Repeat Yourself) и **KISS** (Keep It Simple, Stupid), что делает его лёгким для понимания и модификации.