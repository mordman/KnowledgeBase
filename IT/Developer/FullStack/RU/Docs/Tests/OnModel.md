### **Тестирование на основе моделей (Model-Based Testing, MBT): подробный разбор**



## Оглавление
  - [**Тестирование на основе моделей (Model-Based Testing, MBT): подробный разбор**](#тестирование-на-основе-моделей-model-based-testing-mbt-подробный-разбор)
- [**Преимущества MBT**](#преимущества-mbt)
- [**Основные концепции MBT**](#основные-концепции-mbt)
- [**Виды моделей для MBT**](#виды-моделей-для-mbt)
- [**Пример: Тестирование на основе конечного автомата**](#пример-тестирование-на-основе-конечного-автомата)
  - [**Описание системы**](#описание-системы)
  - [**Модель в виде конечного автомата**](#модель-в-виде-конечного-автомата)
  - [**Примеры тест-кейсов, сгенерированных на основе модели**](#примеры-тест-кейсов-сгенерированных-на-основе-модели)
    - [**Тест-кейс 1: Успешная авторизация**](#тест-кейс-1-успешная-авторизация)
    - [**Тест-кейс 2: Блокировка после 3 неудачных попыток**](#тест-кейс-2-блокировка-после-3-неудачных-попыток)
    - [**Тест-кейс 3: Разблокировка пользователя**](#тест-кейс-3-разблокировка-пользователя)
    - [**Тест-кейс 4: Логаут авторизованного пользователя**](#тест-кейс-4-логаут-авторизованного-пользователя)
- [**Инструменты для Model-Based Testing**](#инструменты-для-model-based-testing)
- [**Пример использования GraphWalker**](#пример-использования-graphwalker)
  - [**Шаг 1: Описание модели**](#шаг-1-описание-модели)
  - [**Шаг 2: Генерация тестов**](#шаг-2-генерация-тестов)
  - [**Шаг 3: Реализация тестов**](#шаг-3-реализация-тестов)
- [**Рекомендации по использованию MBT**](#рекомендации-по-использованию-mbt)

  - [**Тестирование на основе моделей (Model-Based Testing, MBT): подробный разбор**](#тестирование-на-основе-моделей-model-based-testing-mbt-подробный-разбор)
  - [**Описание системы**](#описание-системы)
  - [**Модель в виде конечного автомата**](#модель-в-виде-конечного-автомата)
  - [**Примеры тест-кейсов, сгенерированных на основе модели**](#примеры-тест-кейсов-сгенерированных-на-основе-модели)
    - [**Тест-кейс 1: Успешная авторизация**](#тест-кейс-1-успешная-авторизация)
    - [**Тест-кейс 2: Блокировка после 3 неудачных попыток**](#тест-кейс-2-блокировка-после-3-неудачных-попыток)
    - [**Тест-кейс 3: Разблокировка пользователя**](#тест-кейс-3-разблокировка-пользователя)
    - [**Тест-кейс 4: Логаут авторизованного пользователя**](#тест-кейс-4-логаут-авторизованного-пользователя)
  - [**Шаг 1: Описание модели**](#шаг-1-описание-модели)
  - [**Шаг 2: Генерация тестов**](#шаг-2-генерация-тестов)
  - [**Шаг 3: Реализация тестов**](#шаг-3-реализация-тестов)
**Тестирование на основе моделей (Model-Based Testing, MBT)** — это подход к тестированию программного обеспечения, при котором тестовые случаи генерируются автоматически на основе формальной модели системы. Модель описывает ожидаемое поведение системы, её состояния, переходы между ними и правила взаимодействия. Этот подход позволяет повысить покрытие тестами, сократить время на создание тест-кейсов и улучшить качество тестирования.

---

## **Преимущества MBT**
1. **Автоматизация генерации тестов** — тест-кейсы создаются автоматически на основе модели.
2. **Повышение покрытия** — модель позволяет учитывать все возможные сценарии поведения системы.
3. **Сокращение времени** — уменьшается ручная работа по созданию и поддержке тестов.
4. **Улучшение качества** — модель помогает выявить логические ошибки на ранних этапах.
5. **Документация** — модель служит живой документацией системы.

---

## **Основные концепции MBT**
1. **Модель системы** — формальное описание поведения системы (например, конечный автомат, диаграмма состояний, граф переходов).
2. **Генерация тестов** — автоматизированное создание тест-кейсов на основе модели.
3. **Оракул тестирования** — механизм, определяющий ожидаемый результат для каждого теста.
4. **Исполнение тестов** — запуск сгенерированных тестов на реальной системе.

---

## **Виды моделей для MBT**
1. **Конечные автоматы (Finite State Machines, FSM)** — модель описывает состояния системы и переходы между ними.
2. **Диаграммы последовательности (Sequence Diagrams)** — модель описывает взаимодействие между объектами.
3. **Графы переходов (Transition Graphs)** — модель описывает возможные пути выполнения программы.
4. **Модели на основе прецедентов (Use Case Models)** — модель описывает сценарии использования системы.

---

## **Пример: Тестирование на основе конечного автомата**

### **Описание системы**
Рассмотрим простую систему **авторизации пользователя** с тремя состояниями:
1. **Не авторизован** — пользователь не вошёл в систему.
2. **Авторизован** — пользователь успешно вошёл.
3. **Заблокирован** — пользователь заблокирован после нескольких неудачных попыток.

**Переходы между состояниями:**
- Из **Не авторизован** в **Авторизован** — при вводе правильного логина и пароля.
- Из **Не авторизован** в **Заблокирован** — после 3 неудачных попыток ввода пароля.
- Из **Заблокирован** в **Не авторизован** — после разблокировки (например, через 5 минут).

---

### **Модель в виде конечного автомата**

```plaintext
        +-------------------+       +-------------------+       +-------------------+
        |   Не авторизован  |       |     Авторизован    |       |     Заблокирован   |
        +-------------------+       +-------------------+       +-------------------+
               |                           |                           |
               | Успешная авторизация      |                           | Разблокировка
               |-------------------------->|                           |-------------------------+
               |                           |                           |                          |
               | 3 неудачные попытки      |                           |                          |
               +-------------------------->|                           |                          |
                                               |                           |                          |
                                               | Логаут                    |                          |
                                               +-------------------------->|                          |
                                                                              |--------------------------+
```

---

### **Примеры тест-кейсов, сгенерированных на основе модели**

---

#### **Тест-кейс 1: Успешная авторизация**

| Поле                | Значение                                                                 |
|---------------------|--------------------------------------------------------------------------|
| **ID**              | TC-MBT-001                                                               |
| **Название**        | Успешная авторизация пользователя.                                      |
| **Предусловия**     | Пользователь не авторизован.                                             |
| **Шаги**            | 1. Открыть форму авторизации. <br> 2. Ввести корректные логин и пароль. <br> 3. Нажать "Войти". |
| **Ожидаемый результат** | Пользователь переходит в состояние "Авторизован".                       |
| **Фактический результат** | (Заполняется после выполнения теста).                                   |
| **Статус**          | (Пройден/Не пройден).                                                    |

---

#### **Тест-кейс 2: Блокировка после 3 неудачных попыток**

| Поле                | Значение                                                                 |
|---------------------|--------------------------------------------------------------------------|
| **ID**              | TC-MBT-002                                                               |
| **Название**        | Блокировка пользователя после 3 неудачных попыток ввода пароля.         |
| **Предусловия**     | Пользователь не авторизован.                                             |
| **Шаги**            | 1. Открыть форму авторизации. <br> 2. Ввести некорректный пароль 3 раза. |
| **Ожидаемый результат** | Пользователь переходит в состояние "Заблокирован".                     |
| **Фактический результат** | (Заполняется после выполнения теста).                                   |
| **Статус**          | (Пройден/Не пройден).                                                    |

---

#### **Тест-кейс 3: Разблокировка пользователя**

| Поле                | Значение                                                                 |
|---------------------|--------------------------------------------------------------------------|
| **ID**              | TC-MBT-003                                                               |
| **Название**        | Разблокировка пользователя после истечения времени блокировки.          |
| **Предусловия**     | Пользователь заблокирован.                                               |
| **Шаги**            | 1. Подождать 5 минут. <br> 2. Попытаться авторизоваться с корректными данными. |
| **Ожидаемый результат** | Пользователь переходит в состояние "Авторизован".                       |
| **Фактический результат** | (Заполняется после выполнения теста).                                   |
| **Статус**          | (Пройден/Не пройден).                                                    |

---

#### **Тест-кейс 4: Логаут авторизованного пользователя**

| Поле                | Значение                                                                 |
|---------------------|--------------------------------------------------------------------------|
| **ID**              | TC-MBT-004                                                               |
| **Название**        | Логаут авторизованного пользователя.                                    |
| **Предусловия**     | Пользователь авторизован.                                                |
| **Шаги**            | 1. Нажать кнопку "Выйти".                                                |
| **Ожидаемый результат** | Пользователь переходит в состояние "Не авторизован".                     |
| **Фактический результат** | (Заполняется после выполнения теста).                                   |
| **Статус**          | (Пройден/Не пройден).                                                    |

---

## **Инструменты для Model-Based Testing**
1. **GraphWalker** — инструмент для генерации тестов на основе графов и конечных автоматов.
2. **Spec Explorer** — инструмент от Microsoft для моделирования и генерации тестов.
3. **UML-based tools** — инструменты, поддерживающие UML-диаграммы (например, IBM Rational).
4. **TLA+** — язык для формального описания моделей и проверки их корректности.
5. **PlantUML + Python** — комбинация для создания моделей и генерации тестов.

---

## **Пример использования GraphWalker**

### **Шаг 1: Описание модели**
Модель описывается в формате `.gw` (GraphWalker):
```plaintext
// Модель авторизации
Start: NotAuthenticated

NotAuthenticated:
  - LoginSuccess -> Authenticated
  - LoginFail -> NotAuthenticated
  - LoginFail -> NotAuthenticated
  - LoginFail -> Blocked

Authenticated:
  - Logout -> NotAuthenticated

Blocked:
  - Unblock -> NotAuthenticated
```

### **Шаг 2: Генерация тестов**
GraphWalker генерирует последовательность действий на основе модели:
```plaintext
1. Start at NotAuthenticated
2. LoginSuccess -> Authenticated
3. Logout -> NotAuthenticated
4. LoginFail -> NotAuthenticated
5. LoginFail -> NotAuthenticated
6. LoginFail -> Blocked
7. Unblock -> NotAuthenticated
```

### **Шаг 3: Реализация тестов**
На основе сгенерированной последовательности пишутся автоматизированные тесты (например, на Python с Selenium):
```python
def test_authentication_flow():
    # 1. Начальное состояние: NotAuthenticated
    open_login_page()

    # 2. Успешная авторизация
    enter_credentials("correct_login", "correct_password")
    click_login()
    assert is_authenticated()

    # 3. Логаут
    click_logout()
    assert is_not_authenticated()

    # 4-6. Три неудачные попытки
    for _ in range(3):
        enter_credentials("wrong_login", "wrong_password")
        click_login()
    assert is_blocked()

    # 7. Разблокировка
    wait(300)  # Ожидание 5 минут
    assert is_not_authenticated()
```

---

## **Рекомендации по использованию MBT**
1. **Начните с простой модели** — описывайте ключевые сценарии, затем усложняйте.
2. **Интегрируйте с CI/CD** — автоматически генерируйте и запускайте тесты в пайплайне.
3. **Сотрудничайте с аналитиками** — модель должна отражать реальные бизнес-процессы.
4. **Обновляйте модель** — поддерживайте её в актуальном состоянии при изменении требований.

---