## 1. Реляционные базы данных (SQL)


## Оглавление
  - [1. Реляционные базы данных (SQL)](#1-реляционные-базы-данных-sql)
    - [Теоретические основы](#теоретические-основы)
    - [Архитектура](#архитектура)
    - [Сценарии использования](#сценарии-использования)
    - [Примеры запросов](#примеры-запросов)
  - [2. NoSQL базы данных](#2-nosql-базы-данных)
    - [Теоретические основы](#теоретические-основы)
    - [Типы NoSQL](#типы-nosql)
    - [Архитектура](#архитектура)
    - [Сценарии использования](#сценарии-использования)
    - [Пример запроса (MongoDB)](#пример-запроса-mongodb)
  - [3. Поисковые базы данных](#3-поисковые-базы-данных)
    - [Теоретические основы](#теоретические-основы)
    - [Архитектура](#архитектура)
    - [Сценарии использования](#сценарии-использования)
    - [Пример запроса (Elasticsearch)](#пример-запроса-elasticsearch)
  - [4. Колоночные базы данных](#4-колоночные-базы-данных)
    - [Теоретические основы](#теоретические-основы)
    - [Архитектура](#архитектура)
    - [Сценарии использования](#сценарии-использования)
    - [Пример запроса (Cassandra CQL)](#пример-запроса-cassandra-cql)
  - [5. Графовые базы данных](#5-графовые-базы-данных)
    - [Теоретические основы](#теоретические-основы)
    - [Архитектура](#архитектура)
    - [Сценарии использования](#сценарии-использования)
    - [Пример запроса (Neo4j Cypher)](#пример-запроса-neo4j-cypher)
  - [6. Базы данных "Ключ-значение"](#6-базы-данных-ключ-значение)
    - [Теоретические основы](#теоретические-основы)
    - [Архитектура](#архитектура)
    - [Сценарии использования](#сценарии-использования)
    - [Пример запроса (Redis)](#пример-запроса-redis)
- [Установка значения с TTL (время жизни)](#установка-значения-с-ttl-время-жизни)
- [Инкремент счётчика](#инкремент-счётчика)
- [Pub/Sub: публикация сообщения](#pubsub-публикация-сообщения)

### Теоретические основы
Реляционные базы данных основаны на **реляционной модели**, предложенной Эдгаром Коддом в 1970 году. Данные представляются в виде **таблиц** (отношений), состоящих из строк (кортежей) и столбцов (атрибутов). Основные понятия:
- **Первичный ключ (Primary Key):** Уникальный идентификатор строки.
- **Внешний ключ (Foreign Key):** Ссылка на первичный ключ другой таблицы для установления связи.
- **Нормализация:** Процесс организации данных для минимизации избыточности (1NF, 2NF, 3NF, BCNF).
- **ACID-транзакции:**
  - **Atomicity (Атомарность):** Транзакция выполняется полностью или не выполняется вообще.
  - **Consistency (Согласованность):** Данные остаются в допустимом состоянии после транзакции.
  - **Isolation (Изолированность):** Транзакции не влияют друг на друга.
  - **Durability (Долговечность):** Результаты транзакции сохраняются после её завершения.

### Архитектура
- **Ядро СУБД:** Управляет хранением, обработкой запросов и транзакциями.
- **Оптимизатор запросов:** Выбирает оптимальный план выполнения SQL-запроса.
- **Менеджер буферов:** Кэширует часто используемые данные в оперативной памяти.

### Сценарии использования
- **Финансовые системы:** Банковские транзакции, бухгалтерия.
- **ERP-системы:** Управление ресурсами предприятий.
- **CRM-системы:** Управление взаимоотношениями с клиентами.

### Примеры запросов
```sql
-- Создание таблицы с ограничениями
CREATE TABLE Orders (
    OrderID INT PRIMARY KEY,
    UserID INT,
    OrderDate DATETIME DEFAULT CURRENT_TIMESTAMP,
    TotalAmount DECIMAL(10, 2),
    FOREIGN KEY (UserID) REFERENCES Users(UserID)
);

-- Вставка данных с транзакцией
BEGIN TRANSACTION;
    INSERT INTO Users (UserID, Name, Email)
    VALUES (1, 'Иван Иванов', 'ivan@example.com');

    INSERT INTO Orders (OrderID, UserID, TotalAmount)
    VALUES (101, 1, 999.99);
COMMIT;

-- Сложный запрос с JOIN и агрегацией
SELECT
    u.Name,
    COUNT(o.OrderID) AS OrderCount,
    SUM(o.TotalAmount) AS TotalSpent
FROM
    Users u
LEFT JOIN
    Orders o ON u.UserID = o.UserID
GROUP BY
    u.UserID, u.Name
HAVING
    SUM(o.TotalAmount) > 1000;
```

---

## 2. NoSQL базы данных

### Теоретические основы
NoSQL-базы данных возникли как ответ на ограничения реляционных СУБД в условиях **больших данных** и **горизонтального масштабирования**. Они отказываются от строгой схемы и поддерживают **CAP-теорему** (Consistency, Availability, Partition tolerance), где можно выбрать только два из трёх свойств.

### Типы NoSQL
1. **Документоориентированные:** Данные хранятся в формате JSON или BSON.
2. **Ключ-значение:** Простейшая модель хранения.
3. **Колоночные:** Данные хранятся в колонках, оптимизированы для аналитики.
4. **Графовые:** Данные хранятся в виде графов (узлы и рёбра).

### Архитектура
- **Шардинг (Sharding):** Горизонтальное разделение данных по узлам.
- **Репликация:** Копирование данных на несколько узлов для отказоустойчивости.
- **Eventual Consistency:** Данные становятся согласованными со временем.

### Сценарии использования
- **Документоориентированные:** Хранение данных с изменяемой структурой (например, профили пользователей).
- **Ключ-значение:** Кэширование, сессии пользователей.
- **Колоночные:** Аналитика больших данных, временные ряды.
- **Графовые:** Социальные сети, рекомендательные системы.

### Пример запроса (MongoDB)
```javascript
// Вставка документа с вложенными данными
db.users.insertOne({
    _id: ObjectId("507f1f77bcf86cd799439011"),
    name: "Иван Иванов",
    email: "ivan@example.com",
    address: {
        city: "Москва",
        street: "Ленинский проспект, 10"
    },
    orders: [
        { orderId: 101, amount: 999.99 },
        { orderId: 102, amount: 1999.99 }
    ]
});

// Агрегация данных
db.users.aggregate([
    { $unwind: "$orders" },
    { $group: {
        _id: "$_id",
        name: { $first: "$name" },
        totalSpent: { $sum: "$orders.amount" }
    }},
    { $match: { totalSpent: { $gt: 1000 } } }
]);
```

---

## 3. Поисковые базы данных

### Теоретические основы
Поисковые базы данных основаны на **инвертированных индексах**, которые позволяют быстро находить документы по ключевым словам. Они поддерживают:
- **Full-Text Search:** Поиск по всему тексту документа.
- **Фасетный поиск:** Фильтрация по категориям (например, цена, бренд).
- **Ранжирование:** Оценка релевантности результатов (например, TF-IDF, BM25).

### Архитектура
- **Индексация:** Преобразование текста в инвертированные индексы.
- **Шардинг:** Распределение индексов по узлам.
- **Репликация:** Копирование индексов для отказоустойчивости.

### Сценарии использования
- **Поисковые системы:** Поиск по сайту или каталогу товаров.
- **Логи и мониторинг:** Анализ логов в реальном времени.
- **Аналитика:** Агрегация данных (например, статистика продаж).

### Пример запроса (Elasticsearch)
```json
// Создание индекса с маппингом
PUT /products
{
  "mappings": {
    "properties": {
      "name": { "type": "text", "analyzer": "russian" },
      "price": { "type": "float" },
      "category": { "type": "keyword" }
    }
  }
}

// Поиск с фильтрацией и агрегацией
GET /products/_search
{
  "query": {
    "bool": {
      "must": [
        { "match": { "name": "ноутбук" } }
      ],
      "filter": [
        { "range": { "price": { "gte": 50000 } } }
      ]
    }
  },
  "aggs": {
    "avg_price": { "avg": { "field": "price" } },
    "categories": { "terms": { "field": "category" } }
  }
}
```

---

## 4. Колоночные базы данных

### Теоретические основы
Колоночные базы данных хранят данные в **колонках**, а не в строках. Это позволяет:
- **Эффективно сжимать данные** (например, с помощью кодирования длины серии).
- **Быстро выполнять аналитические запросы** (например, агрегацию по столбцам).
- **Масштабироваться горизонтально** за счёт распределённого хранения.

### Архитектура
- **SSTables (Sorted String Tables):** Файлы, в которых данные отсортированы по ключу.
- **MemTables:** Данные в оперативной памяти перед записью на диск.
- **Compaction:** Процесс слияния SSTables для оптимизации хранения.

### Сценарии использования
- **Аналитика больших данных:** OLAP-запросы (Online Analytical Processing).
- **Временные ряды:** Данные с датчиками, IoT-устройствами.
- **Логи и события:** Хранение логов приложений.

### Пример запроса (Cassandra CQL)
```sql
-- Создание таблицы с композитным ключом
CREATE TABLE sensor_readings (
    sensor_id UUID,
    bucket TEXT,  -- Например, '2025-11'
    reading_time TIMESTAMP,
    temperature FLOAT,
    PRIMARY KEY ((sensor_id, bucket), reading_time)
) WITH CLUSTERING ORDER BY (reading_time DESC);

-- Вставка данных
INSERT INTO sensor_readings (sensor_id, bucket, reading_time, temperature)
VALUES (uuid(), '2025-11', toTimestamp(now()), 23.5);

-- Запрос с фильтрацией по времени
SELECT * FROM sensor_readings
WHERE sensor_id = ?
AND bucket = '2025-11'
AND reading_time > '2025-11-01';
```

---

## 5. Графовые базы данных

### Теоретические основы
Графовые базы данных основаны на **теории графов**. Данные хранятся в виде:
- **Узлов (Nodes):** Сущности (например, пользователи, продукты).
- **Рёбер (Edges):** Связи между узлами (например, "дружит с", "купил").
- **Свойств (Properties):** Атрибуты узлов и рёбер.

### Архитектура
- **Хранение:** Оптимизировано для обхода графов (например, с помощью индексов).
- **Языки запросов:** Cypher (Neo4j), Gremlin (Apache TinkerPop).

### Сценарии использования
- **Социальные сети:** Поиск друзей, рекомендации.
- **Детекция мошенничества:** Анализ связей между транзакциями.
- **Логистика:** Оптимизация маршрутов.

### Пример запроса (Neo4j Cypher)
```cypher
// Создание узлов и связей
CREATE (alice:Person {name: 'Alice', age: 30})
CREATE (bob:Person {name: 'Bob', age: 35})
CREATE (charlie:Person {name: 'Charlie', age: 40})
CREATE (alice)-[:FRIENDS_WITH {since: '2020-01-01'}]->(bob)
CREATE (bob)-[:FRIENDS_WITH {since: '2021-05-10'}]->(charlie);

// Поиск друзей друзей
MATCH (p:Person {name: 'Alice'})-[:FRIENDS_WITH]->(friend)-[:FRIENDS_WITH]->(foaf)
WHERE NOT (p)-[:FRIENDS_WITH]->(foaf)
RETURN foaf.name AS friend_of_a_friend;

// Поиск кратчайшего пути
MATCH path = shortestPath(
    (a:Person {name: 'Alice'})-[*]-(b:Person {name: 'Charlie'})
)
RETURN path;
```

---

## 6. Базы данных "Ключ-значение"

### Теоретические основы
Базы данных "ключ-значение" — это простейшая модель хранения, где каждое значение ассоциировано с уникальным ключом. Они обеспечивают:
- **Высокую производительность** за счёт простоты модели.
- **Масштабируемость** благодаря шардингу и репликации.

### Архитектура
- **In-Memory Storage:** Данные хранятся в оперативной памяти (например, Redis).
- **Persistent Storage:** Данные записываются на диск (например, RocksDB в DynamoDB).

### Сценарии использования
- **Кэширование:** Ускорение доступа к часто используемым данным.
- **Сессии пользователей:** Хранение временных данных.
- **Очереди сообщений:** Реализация pub/sub систем.

### Пример запроса (Redis)
```bash
# Установка значения с TTL (время жизни)

  - [1. Реляционные базы данных (SQL)](#1-реляционные-базы-данных-sql)
    - [Теоретические основы](#теоретические-основы)
    - [Архитектура](#архитектура)
    - [Сценарии использования](#сценарии-использования)
    - [Примеры запросов](#примеры-запросов)
  - [2. NoSQL базы данных](#2-nosql-базы-данных)
    - [Теоретические основы](#теоретические-основы)
    - [Типы NoSQL](#типы-nosql)
    - [Архитектура](#архитектура)
    - [Сценарии использования](#сценарии-использования)
    - [Пример запроса (MongoDB)](#пример-запроса-mongodb)
  - [3. Поисковые базы данных](#3-поисковые-базы-данных)
    - [Теоретические основы](#теоретические-основы)
    - [Архитектура](#архитектура)
    - [Сценарии использования](#сценарии-использования)
    - [Пример запроса (Elasticsearch)](#пример-запроса-elasticsearch)
  - [4. Колоночные базы данных](#4-колоночные-базы-данных)
    - [Теоретические основы](#теоретические-основы)
    - [Архитектура](#архитектура)
    - [Сценарии использования](#сценарии-использования)
    - [Пример запроса (Cassandra CQL)](#пример-запроса-cassandra-cql)
  - [5. Графовые базы данных](#5-графовые-базы-данных)
    - [Теоретические основы](#теоретические-основы)
    - [Архитектура](#архитектура)
    - [Сценарии использования](#сценарии-использования)
    - [Пример запроса (Neo4j Cypher)](#пример-запроса-neo4j-cypher)
  - [6. Базы данных "Ключ-значение"](#6-базы-данных-ключ-значение)
    - [Теоретические основы](#теоретические-основы)
    - [Архитектура](#архитектура)
    - [Сценарии использования](#сценарии-использования)
    - [Пример запроса (Redis)](#пример-запроса-redis)
SET user:1000:session "{'user_id': 1000, 'last_login': '2025-11-11T12:00:00'}" EX 3600

# Инкремент счётчика
INCR article:123:views

# Pub/Sub: публикация сообщения
PUBLISH notifications "Новое сообщение для всех пользователей"
```

---
Сравнение типов баз данных


| Тип базы данных       | Теоретическая основа / Модель данных                                                                 | Архитектурные особенности                                                                                     | Сценарии использования                                                                                     | Примеры СУБД               |
|-----------------------|------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------|---------------------------|
| **Реляционные (SQL)** | Реляционная модель (таблицы, строки, столбцы). ACID-транзакции. Нормализация.                          | Ядро СУБД, оптимизатор запросов, менеджер буферов.                                                            | Финансовые системы, ERP, CRM.                                                                               | PostgreSQL, MySQL, Oracle |
| **NoSQL**             | CAP-теорема. Отсутствие строгой схемы. Горизонтальное масштабирование.                                | Шардинг, репликация, eventual consistency.                                                                    | Хранение неструктурированных данных, аналитика, кэширование.                                               | MongoDB, Cassandra        |
| **Поисковые**         | Инвертированные индексы. Full-Text Search. Фасетный поиск.                                            | Индексация, шардинг, репликация.                                                                               | Поисковые системы, логи, аналитика.                                                                        | Elasticsearch, Solr       |
| **Колоночные**        | Хранение данных в колонках. Оптимизация для аналитики.                                               | SSTables, MemTables, compaction.                                                                              | Аналитика больших данных, временные ряды.                                                                  | Cassandra, HBase          |
| **Графовые**          | Теория графов (узлы, рёбра, свойства).                                                               | Оптимизация для обхода графов. Языки запросов: Cypher, Gremlin.                                               | Социальные сети, детекция мошенничества, логистика.                                                        | Neo4j, ArangoDB           |
| **Ключ-значение**     | Простейшая модель: уникальный ключ → значение.                                                       | In-Memory Storage, Persistent Storage.                                                                         | Кэширование, сессии, очереди сообщений.                                                                    | Redis, DynamoDB           |