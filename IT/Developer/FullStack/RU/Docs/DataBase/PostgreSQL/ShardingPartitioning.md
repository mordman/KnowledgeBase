**sharding** и **partitioning** — это два подхода для распределения данных с целью улучшения производительности, масштабируемости и управления большими объемами информации. Давайте разберём каждый из них, их отличия, примеры создания и типичные сценарии использования.

---

## **1. Partitioning (Партиционирование)**
**Partitioning** — это разделение одной большой таблицы на более мелкие физические части (партиции), которые логически остаются одной таблицей. Все партиции хранятся на одном сервере.

### **Типы партиционирования в PostgreSQL**
- **Range Partitioning**: Разделение по диапазонам значений (например, по датам).
- **List Partitioning**: Разделение по списку значений (например, по регионам).
- **Hash Partitioning**: Разделение по хеш-функции (равномерное распределение).

---

### **Пример: Range Partitioning по дате**
```sql
-- Создаём партиционированную таблицу
CREATE TABLE sales (
    id SERIAL,
    sale_date DATE NOT NULL,
    amount DECIMAL(10, 2)
) PARTITION BY RANGE (sale_date);

-- Создаём партиции для каждого квартала
CREATE TABLE sales_q1 PARTITION OF sales
    FOR VALUES FROM ('2025-01-01') TO ('2025-04-01');

CREATE TABLE sales_q2 PARTITION OF sales
    FOR VALUES FROM ('2025-04-01') TO ('2025-07-01');

-- Вставляем данные
INSERT INTO sales (sale_date, amount) VALUES ('2025-03-15', 100.50);
INSERT INTO sales (sale_date, amount) VALUES ('2025-05-20', 200.75);
```
**Преимущества:**
- Ускорение запросов за счёт работы только с нужными партициями.
- Упрощение архивации и удаления старых данных.

---

## **2. Sharding (Шардинг)**
**Sharding** — это горизонтальное разделение данных на несколько независимых баз данных (шардов), которые могут находиться на разных серверах. Каждый шард содержит часть данных.

### **Сценарии использования шардинга**
- **Масштабирование**: Когда одна база не справляется с нагрузкой.
- **Географическая распределённость**: Данные хранятся ближе к пользователям.
- **Высокая доступность**: Шарды могут реплицироваться.

---

### **Пример: Шардинг с помощью Citus (расширение для PostgreSQL)**
```sql
-- Устанавливаем расширение Citus
CREATE EXTENSION citus;

-- Создаём распределённую таблицу
CREATE TABLE users (
    user_id BIGINT,
    username TEXT,
    email TEXT
);

-- Преобразуем таблицу в распределённую по user_id
SELECT create_distributed_table('users', 'user_id');

-- Вставляем данные (Citus автоматически распределит их по шардам)
INSERT INTO users (user_id, username, email)
VALUES (1, 'dima', 'dima@example.com');
```
**Преимущества:**
- Горизонтальное масштабирование.
- Параллельная обработка запросов на разных шардах.

---

## **Сравнение Partitioning и Sharding**

| **Критерий**       | **Partitioning**                     | **Sharding**                     |
|--------------------|--------------------------------------|----------------------------------|
| **Расположение**   | Один сервер                         | Несколько серверов              |
| **Сложность**      | Проще в настройке                   | Требует оркестрации шардов       |
| **Масштабирование**| Вертикальное (в рамках одного сервера) | Горизонтальное (добавление серверов) |
| **Использование**  | Оптимизация запросов на одном узле  | Распределённая нагрузка          |

---

## **Когда что использовать?**
- **Partitioning**: Если данные большие, но помещаются на одном сервере, и нужна оптимизация запросов.
- **Sharding**: Если нагрузка высокая, и требуется горизонтальное масштабирование на несколько серверов.

---