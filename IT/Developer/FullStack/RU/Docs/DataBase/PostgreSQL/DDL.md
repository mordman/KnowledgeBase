# **DDL (Data Definition Language)**



## Оглавление
  - [**1. Основные команды DDL**](#1-основные-команды-ddl)
    - [**1.1. Создание объектов (`CREATE`)**](#11-создание-объектов-create)
      - [**1.1.1. Создание базы данных**](#111-создание-базы-данных)
      - [**1.1.2. Создание схемы**](#112-создание-схемы)
      - [**1.1.3. Создание таблицы**](#113-создание-таблицы)
      - [**1.1.4. Создание индекса**](#114-создание-индекса)
      - [**1.1.5. Создание представления (View)**](#115-создание-представления-view)
      - [**1.1.6. Создание последовательности (Sequence)**](#116-создание-последовательности-sequence)
      - [**1.1.7. Создание функции**](#117-создание-функции)
      - [**1.1.8. Создание триггера**](#118-создание-триггера)
    - [**1.2. Изменение объектов (`ALTER`)**](#12-изменение-объектов-alter)
      - [**1.2.1. Изменение таблицы**](#121-изменение-таблицы)
      - [**1.2.2. Изменение индекса**](#122-изменение-индекса)
      - [**1.2.3. Изменение представления**](#123-изменение-представления)
      - [**1.2.4. Изменение последовательности**](#124-изменение-последовательности)
    - [**1.3. Удаление объектов (`DROP`)**](#13-удаление-объектов-drop)
      - [**1.3.1. Удаление базы данных**](#131-удаление-базы-данных)
      - [**1.3.2. Удаление схемы**](#132-удаление-схемы)
      - [**1.3.3. Удаление таблицы**](#133-удаление-таблицы)
      - [**1.3.4. Удаление индекса**](#134-удаление-индекса)
      - [**1.3.5. Удаление представления**](#135-удаление-представления)
      - [**1.3.6. Удаление последовательности**](#136-удаление-последовательности)
      - [**1.3.7. Удаление функции**](#137-удаление-функции)
      - [**1.3.8. Удаление триггера**](#138-удаление-триггера)
    - [**1.4. Переименование объектов (`RENAME`)**](#14-переименование-объектов-rename)
      - [**1.4.1. Переименование таблицы**](#141-переименование-таблицы)
      - [**1.4.2. Переименование столбца**](#142-переименование-столбца)
      - [**1.4.3. Переименование индекса**](#143-переименование-индекса)
    - [**1.5. Удаление данных (`TRUNCATE`)**](#15-удаление-данных-truncate)
  - [**2. Ограничения (Constraints)**](#2-ограничения-constraints)
    - [**2.1. Типы ограничений**](#21-типы-ограничений)
    - [**2.2. Добавление ограничений**](#22-добавление-ограничений)
    - [**2.3. Удаление ограничений**](#23-удаление-ограничений)
  - [**3. Работа с табличными пространствами (Tablespaces)**](#3-работа-с-табличными-пространствами-tablespaces)
    - [**3.1. Создание табличного пространства**](#31-создание-табличного-пространства)
    - [**3.2. Изменение табличного пространства**](#32-изменение-табличного-пространства)
    - [**3.3. Удаление табличного пространства**](#33-удаление-табличного-пространства)
    - [**3.4. Использование табличного пространства**](#34-использование-табличного-пространства)
  - [**4. Работа с доменами (Domains)**](#4-работа-с-доменами-domains)
    - [**4.1. Создание домена**](#41-создание-домена)
    - [**4.2. Использование домена**](#42-использование-домена)
    - [**4.3. Изменение домена**](#43-изменение-домена)
    - [**4.4. Удаление домена**](#44-удаление-домена)
  - [**5. Работа с типами данных**](#5-работа-с-типами-данных)
    - [**5.1. Создание пользовательского типа**](#51-создание-пользовательского-типа)
    - [**5.2. Использование пользовательского типа**](#52-использование-пользовательского-типа)
    - [**5.3. Изменение пользовательского типа**](#53-изменение-пользовательского-типа)
    - [**5.4. Удаление пользовательского типа**](#54-удаление-пользовательского-типа)
  - [**6. Работа с расширениями (Extensions)**](#6-работа-с-расширениями-extensions)
    - [**6.1. Создание расширения**](#61-создание-расширения)
    - [**6.2. Удаление расширения**](#62-удаление-расширения)
  - [**7. Работа с ролями и правами доступа**](#7-работа-с-ролями-и-правами-доступа)
    - [**7.1. Создание роли**](#71-создание-роли)
    - [**7.2. Изменение роли**](#72-изменение-роли)
    - [**7.3. Удаление роли**](#73-удаление-роли)
    - [**7.4. Предоставление прав доступа**](#74-предоставление-прав-доступа)
    - [**7.5. Отзыв прав доступа**](#75-отзыв-прав-доступа)
  - [**8. Работа с триггерами**](#8-работа-с-триггерами)
    - [**8.1. Создание триггерной функции**](#81-создание-триггерной-функции)
    - [**8.2. Создание триггера**](#82-создание-триггера)
    - [**8.3. Удаление триггера**](#83-удаление-триггера)
  - [**9. Работа с материализованными представлениями**](#9-работа-с-материализованными-представлениями)
    - [**9.1. Создание материализованного представления**](#91-создание-материализованного-представления)
    - [**9.2. Обновление материализованного представления**](#92-обновление-материализованного-представления)
    - [**9.3. Удаление материализованного представления**](#93-удаление-материализованного-представления)
  - [**10. Работа с событиями (Event Triggers)**](#10-работа-с-событиями-event-triggers)
    - [**10.1. Создание функции для событийного триггера**](#101-создание-функции-для-событийного-триггера)
    - [**10.2. Создание событийного триггера**](#102-создание-событийного-триггера)
    - [**10.3. Удаление событийного триггера**](#103-удаление-событийного-триггера)
  - [**11. Работа с разделами (Partitions)**](#11-работа-с-разделами-partitions)
    - [**11.1. Создание разделённой таблицы**](#111-создание-разделённой-таблицы)
    - [**11.2. Создание разделов**](#112-создание-разделов)
    - [**11.3. Добавление раздела**](#113-добавление-раздела)
    - [**11.4. Удаление раздела**](#114-удаление-раздела)
  - [**12. Работа с внешними таблицами (Foreign Data Wrappers)**](#12-работа-с-внешними-таблицами-foreign-data-wrappers)
    - [**12.1. Создание расширения для работы с внешними данными**](#121-создание-расширения-для-работы-с-внешними-данными)
    - [**12.2. Создание сервера для внешних данных**](#122-создание-сервера-для-внешних-данных)
    - [**12.3. Создание пользовательского отображения**](#123-создание-пользовательского-отображения)
    - [**12.4. Создание внешней таблицы**](#124-создание-внешней-таблицы)
    - [**12.5. Запрос к внешней таблице**](#125-запрос-к-внешней-таблице)
    - [**12.6. Удаление внешней таблицы**](#126-удаление-внешней-таблицы)
  - [**13. Работа с полнотекстовым поиском**](#13-работа-с-полнотекстовым-поиском)
    - [**13.1. Создание столбца для полнотекстового поиска**](#131-создание-столбца-для-полнотекстового-поиска)
    - [**13.2. Обновление столбца для полнотекстового поиска**](#132-обновление-столбца-для-полнотекстового-поиска)
    - [**13.3. Создание триггера для автоматического обновления**](#133-создание-триггера-для-автоматического-обновления)
    - [**13.4. Создание индекса для полнотекстового поиска**](#134-создание-индекса-для-полнотекстового-поиска)
    - [**13.5. Поиск с использованием полнотекстового индекса**](#135-поиск-с-использованием-полнотекстового-индекса)
    - [**13.6. Поиск с ранжированием**](#136-поиск-с-ранжированием)
  - [**14. Работа с JSON и JSONB**](#14-работа-с-json-и-jsonb)
    - [**14.1. Создание таблицы с JSON/JSONB**](#141-создание-таблицы-с-jsonjsonb)
    - [**14.2. Вставка данных в JSON/JSONB**](#142-вставка-данных-в-jsonjsonb)
    - [**13.3. Запрос данных из JSON/JSONB**](#133-запрос-данных-из-jsonjsonb)
    - [**14.4. Обновление данных в JSON/JSONB**](#144-обновление-данных-в-jsonjsonb)
    - [**14.5. Создание индекса для JSON/JSONB**](#145-создание-индекса-для-jsonjsonb)
  - [**15. Работа с временными таблицами**](#15-работа-с-временными-таблицами)
    - [**15.1. Создание временной таблицы**](#151-создание-временной-таблицы)
    - [**15.2. Использование временной таблицы**](#152-использование-временной-таблицы)
    - [**15.3. Удаление временной таблицы**](#153-удаление-временной-таблицы)
  - [**16. Работа с транзакциями**](#16-работа-с-транзакциями)
    - [**16.1. Начало транзакции**](#161-начало-транзакции)
    - [**16.2. Фиксация транзакции**](#162-фиксация-транзакции)
    - [**16.3. Откат транзакции**](#163-откат-транзакции)
    - [**16.4. Точки сохранения (Savepoints)**](#164-точки-сохранения-savepoints)
  - [**17. Работа с комментариями**](#17-работа-с-комментариями)
    - [**17.1. Добавление комментария к объекту**](#171-добавление-комментария-к-объекту)
    - [**17.2. Просмотр комментариев**](#172-просмотр-комментариев)
  - [**18. Работа с доменными ограничениями**](#18-работа-с-доменными-ограничениями)
    - [**18.1. Создание домена с ограничением**](#181-создание-домена-с-ограничением)
    - [**18.2. Использование домена**](#182-использование-домена)
  - [**19. Работа с типами данных**](#19-работа-с-типами-данных)
    - [**19.1. Основные типы данных**](#191-основные-типы-данных)
    - [**19.2. Примеры использования типов данных**](#192-примеры-использования-типов-данных)
      - [**Числовые типы**](#числовые-типы)
      - [**Строковые типы**](#строковые-типы)
      - [**Дата и время**](#дата-и-время)
      - [**JSON/JSONB**](#jsonjsonb)
      - [**Массивы**](#массивы)
  - [**20. Работа с ограничениями целостности**](#20-работа-с-ограничениями-целостности)
    - [**20.1. Первичный ключ (Primary Key)**](#201-первичный-ключ-primary-key)
    - [**20.2. Внешний ключ (Foreign Key)**](#202-внешний-ключ-foreign-key)
    - [**20.3. Уникальное ограничение (Unique)**](#203-уникальное-ограничение-unique)
    - [**20.4. Проверка (Check)**](#204-проверка-check)
    - [**20.5. Ограничение исключения (Exclusion)**](#205-ограничение-исключения-exclusion)
  - [**21. Работа с наследованием таблиц**](#21-работа-с-наследованием-таблиц)
    - [**21.1. Создание дочерней таблицы**](#211-создание-дочерней-таблицы)
    - [**21.2. Запрос данных из иерархии таблиц**](#212-запрос-данных-из-иерархии-таблиц)
  - [**22. Работа с разделами (Partitioning)**](#22-работа-с-разделами-partitioning)
    - [**22.1. Создание разделённой таблицы**](#221-создание-разделённой-таблицы)
    - [**22.2. Создание разделов**](#222-создание-разделов)
    - [**22.3. Добавление раздела**](#223-добавление-раздела)
    - [**22.4. Удаление раздела**](#224-удаление-раздела)
  - [**23. Работа с материализованными представлениями**](#23-работа-с-материализованными-представлениями)
    - [**23.1. Создание материализованного представления**](#231-создание-материализованного-представления)
    - [**23.2. Обновление материализованного представления**](#232-обновление-материализованного-представления)
    - [**23.3. Удаление материализованного представления**](#233-удаление-материализованного-представления)
  - [**24. Работа с внешними данными (Foreign Data Wrappers)**](#24-работа-с-внешними-данными-foreign-data-wrappers)
    - [**24.1. Создание расширения для работы с внешними данными**](#241-создание-расширения-для-работы-с-внешними-данными)
    - [**24.2. Создание сервера для внешних данных**](#242-создание-сервера-для-внешних-данных)
    - [**24.3. Создание пользовательского отображения**](#243-создание-пользовательского-отображения)
    - [**24.4. Создание внешней таблицы**](#244-создание-внешней-таблицы)
    - [**24.5. Запрос к внешней таблице**](#245-запрос-к-внешней-таблице)
    - [**24.6. Удаление внешней таблицы**](#246-удаление-внешней-таблицы)
  - [**25. Работа с событиями (Event Triggers)**](#25-работа-с-событиями-event-triggers)
    - [**25.1. Создание функции для событийного триггера**](#251-создание-функции-для-событийного-триггера)
    - [**25.2. Создание событийного триггера**](#252-создание-событийного-триггера)
    - [**25.3. Удаление событийного триггера**](#253-удаление-событийного-триггера)
  - [**26. Работа с транзакциями и блокировками**](#26-работа-с-транзакциями-и-блокировками)
    - [**26.1. Начало транзакции**](#261-начало-транзакции)
    - [**26.2. Фиксация транзакции**](#262-фиксация-транзакции)
    - [**26.3. Откат транзакции**](#263-откат-транзакции)
    - [**26.4. Точки сохранения (Savepoints)**](#264-точки-сохранения-savepoints)
    - [**26.5. Уровни изоляции транзакций**](#265-уровни-изоляции-транзакций)
    - [**26.6. Блокировки**](#266-блокировки)
  - [**27. Работа с комментариями**](#27-работа-с-комментариями)
    - [**27.1. Добавление комментария к объекту**](#271-добавление-комментария-к-объекту)
    - [**27.2. Просмотр комментариев**](#272-просмотр-комментариев)
  - [**28. Работа с последовательностями (Sequences)**](#28-работа-с-последовательностями-sequences)
    - [**28.1. Создание последовательности**](#281-создание-последовательности)
    - [**28.2. Использование последовательности**](#282-использование-последовательности)
    - [**28.3. Изменение последовательности**](#283-изменение-последовательности)
    - [**28.4. Удаление последовательности**](#284-удаление-последовательности)
  - [**29. Работа с триггерами**](#29-работа-с-триггерами)
    - [**29.1. Создание триггерной функции**](#291-создание-триггерной-функции)
    - [**29.2. Создание триггера**](#292-создание-триггера)
    - [**29.3. Удаление триггера**](#293-удаление-триггера)
  - [**30. Работа с функциями и процедурами**](#30-работа-с-функциями-и-процедурами)
    - [**30.1. Создание функции**](#301-создание-функции)
    - [**30.2. Вызов функции**](#302-вызов-функции)
    - [**30.3. Создание процедуры**](#303-создание-процедуры)
    - [**30.4. Вызов процедуры**](#304-вызов-процедуры)
    - [**30.5. Удаление функции или процедуры**](#305-удаление-функции-или-процедуры)
  - [**31. Работа с представлениями (Views)**](#31-работа-с-представлениями-views)
    - [**31.1. Создание представления**](#311-создание-представления)
    - [**31.2. Запрос к представлению**](#312-запрос-к-представлению)
    - [**31.3. Удаление представления**](#313-удаление-представления)
  - [**32. Работа с временными таблицами**](#32-работа-с-временными-таблицами)
    - [**32.1. Создание временной таблицы**](#321-создание-временной-таблицы)
    - [**32.2. Использование временной таблицы**](#322-использование-временной-таблицы)
  - [**33. Работа с ролями и правами доступа**](#33-работа-с-ролями-и-правами-доступа)
    - [**33.1. Создание роли**](#331-создание-роли)
    - [**33.2. Изменение роли**](#332-изменение-роли)
    - [**33.3. Удаление роли**](#333-удаление-роли)
    - [**33.4. Предоставление прав доступа**](#334-предоставление-прав-доступа)
    - [**33.5. Отзыв прав доступа**](#335-отзыв-прав-доступа)
  - [**34. Работа с табличными пространствами (Tablespaces)**](#34-работа-с-табличными-пространствами-tablespaces)
    - [**34.1. Создание табличного пространства**](#341-создание-табличного-пространства)
    - [**34.2. Изменение табличного пространства**](#342-изменение-табличного-пространства)
    - [**34.3. Удаление табличного пространства**](#343-удаление-табличного-пространства)
    - [**34.4. Использование табличного пространства**](#344-использование-табличного-пространства)
  - [**35. Работа с доменами (Domains)**](#35-работа-с-доменами-domains)
    - [**35.1. Создание домена**](#351-создание-домена)
    - [**35.2. Использование домена**](#352-использование-домена)
    - [**35.3. Изменение домена**](#353-изменение-домена)
    - [**35.4. Удаление домена**](#354-удаление-домена)
  - [**36. Работа с пользовательскими типами данных**](#36-работа-с-пользовательскими-типами-данных)
    - [**36.1. Создание пользовательского типа**](#361-создание-пользовательского-типа)
    - [**36.2. Использование пользовательского типа**](#362-использование-пользовательского-типа)
    - [**36.3. Изменение пользовательского типа**](#363-изменение-пользовательского-типа)
    - [**36.4. Удаление пользовательского типа**](#364-удаление-пользовательского-типа)
  - [**37. Работа с расширениями (Extensions)**](#37-работа-с-расширениями-extensions)
    - [**37.1. Создание расширения**](#371-создание-расширения)
    - [**37.2. Удаление расширения**](#372-удаление-расширения)
  - [**38. Работа с JSON и JSONB**](#38-работа-с-json-и-jsonb)
    - [**38.1. Создание таблицы с JSON/JSONB**](#381-создание-таблицы-с-jsonjsonb)
    - [**38.2. Вставка данных в JSON/JSONB**](#382-вставка-данных-в-jsonjsonb)
    - [**38.3. Запрос данных из JSON/JSONB**](#383-запрос-данных-из-jsonjsonb)
    - [**38.4. Обновление данных в JSON/JSONB**](#384-обновление-данных-в-jsonjsonb)
    - [**38.5. Создание индекса для JSON/JSONB**](#385-создание-индекса-для-jsonjsonb)
  - [**39. Работа с массивами**](#39-работа-с-массивами)
    - [**39.1. Создание таблицы с массивами**](#391-создание-таблицы-с-массивами)
    - [**39.2. Вставка данных в массив**](#392-вставка-данных-в-массив)
    - [**39.3. Запрос данных из массива**](#393-запрос-данных-из-массива)
    - [**39.4. Обновление данных в массиве**](#394-обновление-данных-в-массиве)
    - [**39.5. Создание индекса для массива**](#395-создание-индекса-для-массива)
  - [**40. Работа с геометрическими типами данных**](#40-работа-с-геометрическими-типами-данных)
    - [**40.1. Установка расширения PostGIS**](#401-установка-расширения-postgis)
    - [**40.2. Создание таблицы с геометрическими данными**](#402-создание-таблицы-с-геометрическими-данными)
    - [**40.3. Вставка геометрических данных**](#403-вставка-геометрических-данных)
    - [**40.4. Запрос геометрических данных**](#404-запрос-геометрических-данных)
    - [**40.5. Создание пространственного индекса**](#405-создание-пространственного-индекса)
  - [**41. Работа с временными зонами**](#41-работа-с-временными-зонами)
    - [**41.1. Установка временной зоны**](#411-установка-временной-зоны)
    - [**41.2. Работа с временными метками**](#412-работа-с-временными-метками)
  - [**42. Работа с транзакциями и блокировками**](#42-работа-с-транзакциями-и-блокировками)
    - [**42.1. Начало транзакции**](#421-начало-транзакции)
    - [**42.2. Фиксация транзакции**](#422-фиксация-транзакции)
    - [**42.3. Откат транзакции**](#423-откат-транзакции)
    - [**42.4. Точки сохранения (Savepoints)**](#424-точки-сохранения-savepoints)
    - [**42.5. Уровни изоляции транзакций**](#425-уровни-изоляции-транзакций)
    - [**42.6. Блокировки**](#426-блокировки)
  - [**43. Работа с репликацией**](#43-работа-с-репликацией)
    - [**43.1. Настройка потоковой репликации (Streaming Replication)**](#431-настройка-потоковой-репликации-streaming-replication)
    - [**43.2. Настройка логической репликации (Logical Replication)**](#432-настройка-логической-репликации-logical-replication)
  - [**44. Работа с резервным копированием и восстановлением**](#44-работа-с-резервным-копированием-и-восстановлением)
    - [**44.1. Создание резервной копии с помощью `pg_dump`**](#441-создание-резервной-копии-с-помощью-pg_dump)
    - [**44.2. Восстановление из резервной копии с помощью `psql`**](#442-восстановление-из-резервной-копии-с-помощью-psql)
    - [**44.3. Создание бинарной резервной копии с помощью `pg_basebackup`**](#443-создание-бинарной-резервной-копии-с-помощью-pg_basebackup)
    - [**44.4. Восстановление из бинарной резервной копии**](#444-восстановление-из-бинарной-резервной-копии)
  - [**45. Работа с мониторингом и производительностью**](#45-работа-с-мониторингом-и-производительностью)
    - [**45.1. Просмотр активных соединений**](#451-просмотр-активных-соединений)
    - [**45.2. Просмотр статистики таблиц**](#452-просмотр-статистики-таблиц)
    - [**45.3. Просмотр статистики индексов**](#453-просмотр-статистики-индексов)
    - [**45.4. Анализ производительности запросов**](#454-анализ-производительности-запросов)
    - [**45.5. Просмотр блокировок**](#455-просмотр-блокировок)
    - [**45.6. Просмотр настроек PostgreSQL**](#456-просмотр-настроек-postgresql)
    - [**45.7. Изменение настроек PostgreSQL**](#457-изменение-настроек-postgresql)
  - [**46. Работа с расширением `pg_partman` для управления разделами**](#46-работа-с-расширением-pg_partman-для-управления-разделами)
    - [**46.1. Установка расширения**](#461-установка-расширения)
    - [**46.2. Создание разделённой таблицы**](#462-создание-разделённой-таблицы)
    - [**46.3. Добавление нового раздела**](#463-добавление-нового-раздела)
    - [**46.4. Удаление старого раздела**](#464-удаление-старого-раздела)
    - [**46.5. Настройка автоматического управления разделами**](#465-настройка-автоматического-управления-разделами)
  - [**47. Работа с расширением `pg_stat_statements` для анализа запросов**](#47-работа-с-расширением-pg_stat_statements-для-анализа-запросов)
    - [**47.1. Установка расширения**](#471-установка-расширения)
    - [**47.2. Просмотр статистики запросов**](#472-просмотр-статистики-запросов)
    - [**47.3. Сброс статистики**](#473-сброс-статистики)
  - [**48. Работа с расширением `pg_repack` для дефрагментации таблиц**](#48-работа-с-расширением-pg_repack-для-дефрагментации-таблиц)
    - [**48.1. Установка расширения**](#481-установка-расширения)
    - [**48.2. Дефрагментация таблицы**](#482-дефрагментация-таблицы)
    - [**48.3. Дефрагментация всех таблиц в базе данных**](#483-дефрагментация-всех-таблиц-в-базе-данных)
  - [**49. Работа с расширением `pgAudit` для аудита**](#49-работа-с-расширением-pgaudit-для-аудита)
    - [**49.1. Установка расширения**](#491-установка-расширения)
    - [**49.2. Настройка аудита в `postgresql.conf`**](#492-настройка-аудита-в-postgresqlconf)
    - [**49.3. Просмотр журнала аудита**](#493-просмотр-журнала-аудита)
  - [**50. Работа с расширением `PostGIS` для геопространственных данных**](#50-работа-с-расширением-postgis-для-геопространственных-данных)
    - [**50.1. Установка расширения**](#501-установка-расширения)
    - [**50.2. Создание таблицы с геометрическими данными**](#502-создание-таблицы-с-геометрическими-данными)
    - [**50.3. Вставка геометрических данных**](#503-вставка-геометрических-данных)
    - [**50.4. Запрос геометрических данных**](#504-запрос-геометрических-данных)
    - [**50.5. Создание пространственного индекса**](#505-создание-пространственного-индекса)
  - [**51. Работа с расширением `pg_cron` для планирования задач**](#51-работа-с-расширением-pg_cron-для-планирования-задач)
    - [**51.1. Установка расширения**](#511-установка-расширения)
    - [**51.2. Добавление задачи в расписание**](#512-добавление-задачи-в-расписание)
    - [**51.3. Просмотр запланированных задач**](#513-просмотр-запланированных-задач)
    - [**51.4. Удаление задачи из расписания**](#514-удаление-задачи-из-расписания)
  - [**52. Работа с расширением `uuid-ossp` для генерации UUID**](#52-работа-с-расширением-uuid-ossp-для-генерации-uuid)
    - [**52.1. Установка расширения**](#521-установка-расширения)
    - [**52.2. Генерация UUID**](#522-генерация-uuid)
  - [**53. Работа с расширением `hstore` для хранения пар "ключ-значение"**](#53-работа-с-расширением-hstore-для-хранения-пар-ключ-значение)
    - [**53.1. Установка расширения**](#531-установка-расширения)
    - [**53.2. Создание таблицы с полем `hstore`**](#532-создание-таблицы-с-полем-hstore)
    - [**53.3. Вставка данных в `hstore`**](#533-вставка-данных-в-hstore)
    - [**53.4. Запрос данных из `hstore`**](#534-запрос-данных-из-hstore)
    - [**53.5. Обновление данных в `hstore`**](#535-обновление-данных-в-hstore)
    - [**53.6. Создание индекса для `hstore`**](#536-создание-индекса-для-hstore)
  - [**54. Работа с расширением `citext` для регистронезависимого сравнения строк**](#54-работа-с-расширением-citext-для-регистронезависимого-сравнения-строк)
    - [**54.1. Установка расширения**](#541-установка-расширения)
    - [**54.2. Создание таблицы с полем `citext`**](#542-создание-таблицы-с-полем-citext)
    - [**54.3. Вставка данных в `citext`**](#543-вставка-данных-в-citext)
    - [**54.4. Запрос данных из `citext`**](#544-запрос-данных-из-citext)
    - [**54.5. Создание индекса для `citext`**](#545-создание-индекса-для-citext)
  - [**55. Работа с расширением `pg_trgm` для нечёткого поиска**](#55-работа-с-расширением-pg_trgm-для-нечёткого-поиска)
    - [**55.1. Установка расширения**](#551-установка-расширения)
    - [**55.2. Создание индекса для нечёткого поиска**](#552-создание-индекса-для-нечёткого-поиска)
    - [**55.3. Поиск похожих строк**](#553-поиск-похожих-строк)
    - [**55.4. Оценка схожести строк**](#554-оценка-схожести-строк)
  - [**56. Работа с расширением `tablefunc` для работы с таблицами**](#56-работа-с-расширением-tablefunc-для-работы-с-таблицами)
    - [**56.1. Установка расширения**](#561-установка-расширения)
    - [**56.2. Использование функции `crosstab`**](#562-использование-функции-crosstab)
  - [**57. Работа с расширением `pg_buffercache` для анализа кэша**](#57-работа-с-расширением-pg_buffercache-для-анализа-кэша)
    - [**57.1. Установка расширения**](#571-установка-расширения)
    - [**57.2. Просмотр содержимого кэша**](#572-просмотр-содержимого-кэша)
  - [**58. Работа с расширением `pg_prewarm` для предварительной загрузки данных в кэш**](#58-работа-с-расширением-pg_prewarm-для-предварительной-загрузки-данных-в-кэш)
    - [**58.1. Установка расширения**](#581-установка-расширения)
    - [**58.2. Предварительная загрузка таблицы в кэш**](#582-предварительная-загрузка-таблицы-в-кэш)
  - [**59. Работа с расширением `pg_visibility` для анализа видимости строк**](#59-работа-с-расширением-pg_visibility-для-анализа-видимости-строк)
    - [**59.1. Установка расширения**](#591-установка-расширения)
    - [**59.2. Просмотр статистики видимости строк**](#592-просмотр-статистики-видимости-строк)
  - [**60. Работа с расширением `pg_freespacemap` для анализа свободного пространства**](#60-работа-с-расширением-pg_freespacemap-для-анализа-свободного-пространства)
    - [**60.1. Установка расширения**](#601-установка-расширения)
    - [**60.2. Просмотр информации о свободном пространстве**](#602-просмотр-информации-о-свободном-пространстве)
  - [**61. Работа с расширением `pgrowlocks` для анализа блокировок строк**](#61-работа-с-расширением-pgrowlocks-для-анализа-блокировок-строк)
    - [**61.1. Установка расширения**](#611-установка-расширения)
    - [**61.2. Просмотр блокировок строк**](#612-просмотр-блокировок-строк)
  - [**62. Работа с расширением `pg_stat_kcache` для анализа использования кэша ядра**](#62-работа-с-расширением-pg_stat_kcache-для-анализа-использования-кэша-ядра)
    - [**62.1. Установка расширения**](#621-установка-расширения)
    - [**62.2. Просмотр статистики использования кэша**](#622-просмотр-статистики-использования-кэша)
  - [**63. Работа с расширением `pg_wait_sampling` для анализа ожиданий**](#63-работа-с-расширением-pg_wait_sampling-для-анализа-ожиданий)
    - [**63.1. Установка расширения**](#631-установка-расширения)
    - [**63.2. Запуск сбора статистики ожиданий**](#632-запуск-сбора-статистики-ожиданий)
    - [**63.3. Просмотр статистики ожиданий**](#633-просмотр-статистики-ожиданий)
    - [**63.4. Остановка сбора статистики ожиданий**](#634-остановка-сбора-статистики-ожиданий)
  - [**64. Работа с расширением `hypopg` для гипотетических индексов**](#64-работа-с-расширением-hypopg-для-гипотетических-индексов)
    - [**64.1. Установка расширения**](#641-установка-расширения)
    - [**64.2. Создание гипотетического индекса**](#642-создание-гипотетического-индекса)
    - [**64.3. Проверка использования гипотетического индекса**](#643-проверка-использования-гипотетического-индекса)
    - [**64.4. Удаление гипотетического индекса**](#644-удаление-гипотетического-индекса)
  - [**65. Работа с расширением `pgqualstats` для анализа условий в запросах**](#65-работа-с-расширением-pgqualstats-для-анализа-условий-в-запросах)
    - [**65.1. Установка расширения**](#651-установка-расширения)
    - [**65.2. Просмотр статистики условий**](#652-просмотр-статистики-условий)
  - [**66. Работа с расширением `pg_track_settings` для отслеживания изменений настроек**](#66-работа-с-расширением-pg_track_settings-для-отслеживания-изменений-настроек)
    - [**66.1. Установка расширения**](#661-установка-расширения)
    - [**66.2. Просмотр истории изменений настроек**](#662-просмотр-истории-изменений-настроек)
  - [**67. Работа с расширением `wal2json` для логической репликации**](#67-работа-с-расширением-wal2json-для-логической-репликации)
    - [**67.1. Установка расширения**](#671-установка-расширения)
    - [**67.2. Настройка логической репликации с использованием `wal2json`**](#672-настройка-логической-репликации-с-использованием-wal2json)
- [В postgresql.conf](#в-postgresqlconf)
  - [**68. Работа с расширением `pg_jieba` для китайской сегментации текста**](#68-работа-с-расширением-pg_jieba-для-китайской-сегментации-текста)
    - [**68.1. Установка расширения**](#681-установка-расширения)
    - [**68.2. Сегментация китайского текста**](#682-сегментация-китайского-текста)
  - [**69. Работа с расширением `pg_similarity` для сравнения строк**](#69-работа-с-расширением-pg_similarity-для-сравнения-строк)
    - [**69.1. Установка расширения**](#691-установка-расширения)
    - [**69.2. Сравнение строк**](#692-сравнение-строк)
  - [**70. Работа с расширением `pgTAP` для тестирования**](#70-работа-с-расширением-pgtap-для-тестирования)
    - [**70.1. Установка расширения**](#701-установка-расширения)
    - [**70.2. Написание тестов**](#702-написание-тестов)
  - [**71. Работа с расширением `pgMemCache` для кэширования**](#71-работа-с-расширением-pgmemcache-для-кэширования)
    - [**71.1. Установка расширения**](#711-установка-расширения)
    - [**71.2. Использование кэша**](#712-использование-кэша)
  - [**72. Работа с расширением `pg_bigm` для полнотекстового поиска на японском языке**](#72-работа-с-расширением-pg_bigm-для-полнотекстового-поиска-на-японском-языке)
    - [**72.1. Установка расширения**](#721-установка-расширения)
    - [**72.2. Создание индекса для японского текста**](#722-создание-индекса-для-японского-текста)
  - [**73. Работа с расширением `pg_roaringbitmap` для работы с битовыми картами**](#73-работа-с-расширением-pg_roaringbitmap-для-работы-с-битовыми-картами)
    - [**73.1. Установка расширения**](#731-установка-расширения)
    - [**73.2. Использование битовых карт**](#732-использование-битовых-карт)
  - [**74. Работа с расширением `pg_partman` для управления разделами**](#74-работа-с-расширением-pg_partman-для-управления-разделами)
    - [**74.1. Установка расширения**](#741-установка-расширения)
    - [**74.2. Создание разделённой таблицы**](#742-создание-разделённой-таблицы)
    - [**74.3. Добавление нового раздела**](#743-добавление-нового-раздела)
    - [**74.4. Удаление старого раздела**](#744-удаление-старого-раздела)
    - [**74.5. Настройка автоматического управления разделами**](#745-настройка-автоматического-управления-разделами)
  - [**75. Работа с расширением `timescaledb` для временных рядов**](#75-работа-с-расширением-timescaledb-для-временных-рядов)
    - [**75.1. Установка расширения**](#751-установка-расширения)
    - [**75.2. Создание гипертаблицы**](#752-создание-гипертаблицы)
    - [**75.3. Добавление данных в гипертаблицу**](#753-добавление-данных-в-гипертаблицу)
    - [**75.4. Запрос данных из гипертаблицы**](#754-запрос-данных-из-гипертаблицы)
    - [**75.5. Создание непрерывных агрегатов**](#755-создание-непрерывных-агрегатов)
    - [**75.6. Обновление непрерывных агрегатов**](#756-обновление-непрерывных-агрегатов)
  - [**76. Работа с расширением `pg_graphql` для GraphQL**](#76-работа-с-расширением-pg_graphql-для-graphql)
    - [**76.1. Установка расширения**](#761-установка-расширения)
    - [**76.2. Выполнение GraphQL-запросов**](#762-выполнение-graphql-запросов)
  - [**77. Работа с расширением `pg_net` для работы с сетями**](#77-работа-с-расширением-pg_net-для-работы-с-сетями)
    - [**77.1. Установка расширения**](#771-установка-расширения)
    - [**77.2. Использование сетевых функций**](#772-использование-сетевых-функций)
  - [**78. Работа с расширением `pg_qualstats` для анализа условий в запросах**](#78-работа-с-расширением-pg_qualstats-для-анализа-условий-в-запросах)
    - [**78.1. Установка расширения**](#781-установка-расширения)
    - [**78.2. Просмотр статистики условий**](#782-просмотр-статистики-условий)
  - [**79. Работа с расширением `pg_stat_monitor` для мониторинга запросов**](#79-работа-с-расширением-pg_stat_monitor-для-мониторинга-запросов)
    - [**79.1. Установка расширения**](#791-установка-расширения)
    - [**79.2. Просмотр статистики запросов**](#792-просмотр-статистики-запросов)
  - [**80. Работа с расширением `pg_walinspect` для анализа WAL**](#80-работа-с-расширением-pg_walinspect-для-анализа-wal)
    - [**80.1. Установка расширения**](#801-установка-расширения)
    - [**80.2. Просмотр информации из WAL**](#802-просмотр-информации-из-wal)
  - [**81. Работа с расширением `pg_hint_plan` для управления планами выполнения**](#81-работа-с-расширением-pg_hint_plan-для-управления-планами-выполнения)
    - [**81.1. Установка расширения**](#811-установка-расширения)
    - [**81.2. Использование hint-ов в запросах**](#812-использование-hint-ов-в-запросах)
    - [**81.3. Настройка hint-ов на уровне базы данных**](#813-настройка-hint-ов-на-уровне-базы-данных)
  - [**82. Работа с расширением `pg_visibility` для анализа видимости строк**](#82-работа-с-расширением-pg_visibility-для-анализа-видимости-строк)
    - [**82.1. Установка расширения**](#821-установка-расширения)
    - [**82.2. Просмотр статистики видимости строк**](#822-просмотр-статистики-видимости-строк)
  - [**83. Работа с расширением `pg_freespacemap` для анализа свободного пространства**](#83-работа-с-расширением-pg_freespacemap-для-анализа-свободного-пространства)
    - [**83.1. Установка расширения**](#831-установка-расширения)
    - [**83.2. Просмотр информации о свободном пространстве**](#832-просмотр-информации-о-свободном-пространстве)
  - [**84. Работа с расширением `pgrowlocks` для анализа блокировок строк**](#84-работа-с-расширением-pgrowlocks-для-анализа-блокировок-строк)
    - [**84.1. Установка расширения**](#841-установка-расширения)
    - [**84.2. Просмотр блокировок строк**](#842-просмотр-блокировок-строк)
  - [**85. Работа с расширением `pg_stat_kcache` для анализа использования кэша ядра**](#85-работа-с-расширением-pg_stat_kcache-для-анализа-использования-кэша-ядра)
    - [**85.1. Установка расширения**](#851-установка-расширения)
    - [**85.2. Просмотр статистики использования кэша**](#852-просмотр-статистики-использования-кэша)
  - [**86. Работа с расширением `pg_wait_sampling` для анализа ожиданий**](#86-работа-с-расширением-pg_wait_sampling-для-анализа-ожиданий)
    - [**86.1. Установка расширения**](#861-установка-расширения)
    - [**86.2. Запуск сбора статистики ожиданий**](#862-запуск-сбора-статистики-ожиданий)
    - [**86.3. Просмотр статистики ожиданий**](#863-просмотр-статистики-ожиданий)
    - [**86.4. Остановка сбора статистики ожиданий**](#864-остановка-сбора-статистики-ожиданий)
  - [**87. Работа с расширением `hypopg` для гипотетических индексов**](#87-работа-с-расширением-hypopg-для-гипотетических-индексов)
    - [**87.1. Установка расширения**](#871-установка-расширения)
    - [**87.2. Создание гипотетического индекса**](#872-создание-гипотетического-индекса)
    - [**87.3. Проверка использования гипотетического индекса**](#873-проверка-использования-гипотетического-индекса)
    - [**87.4. Удаление гипотетического индекса**](#874-удаление-гипотетического-индекса)
  - [**88. Работа с расширением `pgqualstats` для анализа условий в запросах**](#88-работа-с-расширением-pgqualstats-для-анализа-условий-в-запросах)
    - [**88.1. Установка расширения**](#881-установка-расширения)
    - [**88.2. Просмотр статистики условий**](#882-просмотр-статистики-условий)
  - [**89. Работа с расширением `pg_track_settings` для отслеживания изменений настроек**](#89-работа-с-расширением-pg_track_settings-для-отслеживания-изменений-настроек)
    - [**89.1. Установка расширения**](#891-установка-расширения)
    - [**89.2. Просмотр истории изменений настроек**](#892-просмотр-истории-изменений-настроек)
  - [**90. Работа с расширением `wal2json` для логической репликации**](#90-работа-с-расширением-wal2json-для-логической-репликации)
    - [**90.1. Установка расширения**](#901-установка-расширения)
    - [**90.2. Настройка логической репликации с использованием `wal2json`**](#902-настройка-логической-репликации-с-использованием-wal2json)
- [В postgresql.conf](#в-postgresqlconf)
  - [**91. Работа с расширением `pg_jieba` для китайской сегментации текста**](#91-работа-с-расширением-pg_jieba-для-китайской-сегментации-текста)
    - [**91.1. Установка расширения**](#911-установка-расширения)
    - [**91.2. Сегментация китайского текста**](#912-сегментация-китайского-текста)
  - [**92. Работа с расширением `pg_similarity` для сравнения строк**](#92-работа-с-расширением-pg_similarity-для-сравнения-строк)
    - [**92.1. Установка расширения**](#921-установка-расширения)
    - [**92.2. Сравнение строк**](#922-сравнение-строк)
  - [**93. Работа с расширением `pgTAP` для тестирования**](#93-работа-с-расширением-pgtap-для-тестирования)
    - [**93.1. Установка расширения**](#931-установка-расширения)
    - [**93.2. Написание тестов**](#932-написание-тестов)
  - [**94. Работа с расширением `pgMemCache` для кэширования**](#94-работа-с-расширением-pgmemcache-для-кэширования)
    - [**94.1. Установка расширения**](#941-установка-расширения)
    - [**94.2. Использование кэша**](#942-использование-кэша)
  - [**95. Работа с расширением `pg_bigm` для полнотекстового поиска на японском языке**](#95-работа-с-расширением-pg_bigm-для-полнотекстового-поиска-на-японском-языке)
    - [**95.1. Установка расширения**](#951-установка-расширения)
    - [**95.2. Создание индекса для японского текста**](#952-создание-индекса-для-японского-текста)
  - [**96. Работа с расширением `pg_roaringbitmap` для работы с битовыми картами**](#96-работа-с-расширением-pg_roaringbitmap-для-работы-с-битовыми-картами)
    - [**96.1. Установка расширения**](#961-установка-расширения)
    - [**96.2. Использование битовых карт**](#962-использование-битовых-карт)
  - [**97. Работа с расширением `pg_partman` для управления разделами**](#97-работа-с-расширением-pg_partman-для-управления-разделами)
    - [**97.1. Установка расширения**](#971-установка-расширения)
    - [**97.2. Создание разделённой таблицы**](#972-создание-разделённой-таблицы)
    - [**97.3. Добавление нового раздела**](#973-добавление-нового-раздела)
    - [**97.4. Удаление старого раздела**](#974-удаление-старого-раздела)
    - [**97.5. Настройка автоматического управления разделами**](#975-настройка-автоматического-управления-разделами)
  - [**98. Работа с расширением `timescaledb` для временных рядов**](#98-работа-с-расширением-timescaledb-для-временных-рядов)
    - [**98.1. Установка расширения**](#981-установка-расширения)
    - [**98.2. Создание гипертаблицы**](#982-создание-гипертаблицы)
    - [**98.3. Добавление данных в гипертаблицу**](#983-добавление-данных-в-гипертаблицу)
    - [**98.4. Запрос данных из гипертаблицы**](#984-запрос-данных-из-гипертаблицы)
    - [**98.5. Создание непрерывных агрегатов**](#985-создание-непрерывных-агрегатов)
    - [**98.6. Обновление непрерывных агрегатов**](#986-обновление-непрерывных-агрегатов)
  - [**99. Работа с расширением `pg_graphql` для GraphQL**](#99-работа-с-расширением-pg_graphql-для-graphql)
    - [**99.1. Установка расширения**](#991-установка-расширения)
    - [**99.2. Выполнение GraphQL-запросов**](#992-выполнение-graphql-запросов)
  - [**100. Работа с расширением `pg_net` для работы с сетями**](#100-работа-с-расширением-pg_net-для-работы-с-сетями)
    - [**100.1. Установка расширения**](#1001-установка-расширения)
    - [**100.2. Использование сетевых функций**](#1002-использование-сетевых-функций)

  - [**1. Основные команды DDL**](#1-основные-команды-ddl)
    - [**1.1. Создание объектов (`CREATE`)**](#11-создание-объектов-create)
      - [**1.1.1. Создание базы данных**](#111-создание-базы-данных)
      - [**1.1.2. Создание схемы**](#112-создание-схемы)
      - [**1.1.3. Создание таблицы**](#113-создание-таблицы)
      - [**1.1.4. Создание индекса**](#114-создание-индекса)
      - [**1.1.5. Создание представления (View)**](#115-создание-представления-view)
      - [**1.1.6. Создание последовательности (Sequence)**](#116-создание-последовательности-sequence)
      - [**1.1.7. Создание функции**](#117-создание-функции)
      - [**1.1.8. Создание триггера**](#118-создание-триггера)
    - [**1.2. Изменение объектов (`ALTER`)**](#12-изменение-объектов-alter)
      - [**1.2.1. Изменение таблицы**](#121-изменение-таблицы)
      - [**1.2.2. Изменение индекса**](#122-изменение-индекса)
      - [**1.2.3. Изменение представления**](#123-изменение-представления)
      - [**1.2.4. Изменение последовательности**](#124-изменение-последовательности)
    - [**1.3. Удаление объектов (`DROP`)**](#13-удаление-объектов-drop)
      - [**1.3.1. Удаление базы данных**](#131-удаление-базы-данных)
      - [**1.3.2. Удаление схемы**](#132-удаление-схемы)
      - [**1.3.3. Удаление таблицы**](#133-удаление-таблицы)
      - [**1.3.4. Удаление индекса**](#134-удаление-индекса)
      - [**1.3.5. Удаление представления**](#135-удаление-представления)
      - [**1.3.6. Удаление последовательности**](#136-удаление-последовательности)
      - [**1.3.7. Удаление функции**](#137-удаление-функции)
      - [**1.3.8. Удаление триггера**](#138-удаление-триггера)
    - [**1.4. Переименование объектов (`RENAME`)**](#14-переименование-объектов-rename)
      - [**1.4.1. Переименование таблицы**](#141-переименование-таблицы)
      - [**1.4.2. Переименование столбца**](#142-переименование-столбца)
      - [**1.4.3. Переименование индекса**](#143-переименование-индекса)
    - [**1.5. Удаление данных (`TRUNCATE`)**](#15-удаление-данных-truncate)
  - [**2. Ограничения (Constraints)**](#2-ограничения-constraints)
    - [**2.1. Типы ограничений**](#21-типы-ограничений)
    - [**2.2. Добавление ограничений**](#22-добавление-ограничений)
    - [**2.3. Удаление ограничений**](#23-удаление-ограничений)
  - [**3. Работа с табличными пространствами (Tablespaces)**](#3-работа-с-табличными-пространствами-tablespaces)
    - [**3.1. Создание табличного пространства**](#31-создание-табличного-пространства)
    - [**3.2. Изменение табличного пространства**](#32-изменение-табличного-пространства)
    - [**3.3. Удаление табличного пространства**](#33-удаление-табличного-пространства)
    - [**3.4. Использование табличного пространства**](#34-использование-табличного-пространства)
  - [**4. Работа с доменами (Domains)**](#4-работа-с-доменами-domains)
    - [**4.1. Создание домена**](#41-создание-домена)
    - [**4.2. Использование домена**](#42-использование-домена)
    - [**4.3. Изменение домена**](#43-изменение-домена)
    - [**4.4. Удаление домена**](#44-удаление-домена)
  - [**5. Работа с типами данных**](#5-работа-с-типами-данных)
    - [**5.1. Создание пользовательского типа**](#51-создание-пользовательского-типа)
    - [**5.2. Использование пользовательского типа**](#52-использование-пользовательского-типа)
    - [**5.3. Изменение пользовательского типа**](#53-изменение-пользовательского-типа)
    - [**5.4. Удаление пользовательского типа**](#54-удаление-пользовательского-типа)
  - [**6. Работа с расширениями (Extensions)**](#6-работа-с-расширениями-extensions)
    - [**6.1. Создание расширения**](#61-создание-расширения)
    - [**6.2. Удаление расширения**](#62-удаление-расширения)
  - [**7. Работа с ролями и правами доступа**](#7-работа-с-ролями-и-правами-доступа)
    - [**7.1. Создание роли**](#71-создание-роли)
    - [**7.2. Изменение роли**](#72-изменение-роли)
    - [**7.3. Удаление роли**](#73-удаление-роли)
    - [**7.4. Предоставление прав доступа**](#74-предоставление-прав-доступа)
    - [**7.5. Отзыв прав доступа**](#75-отзыв-прав-доступа)
  - [**8. Работа с триггерами**](#8-работа-с-триггерами)
    - [**8.1. Создание триггерной функции**](#81-создание-триггерной-функции)
    - [**8.2. Создание триггера**](#82-создание-триггера)
    - [**8.3. Удаление триггера**](#83-удаление-триггера)
  - [**9. Работа с материализованными представлениями**](#9-работа-с-материализованными-представлениями)
    - [**9.1. Создание материализованного представления**](#91-создание-материализованного-представления)
    - [**9.2. Обновление материализованного представления**](#92-обновление-материализованного-представления)
    - [**9.3. Удаление материализованного представления**](#93-удаление-материализованного-представления)
  - [**10. Работа с событиями (Event Triggers)**](#10-работа-с-событиями-event-triggers)
    - [**10.1. Создание функции для событийного триггера**](#101-создание-функции-для-событийного-триггера)
    - [**10.2. Создание событийного триггера**](#102-создание-событийного-триггера)
    - [**10.3. Удаление событийного триггера**](#103-удаление-событийного-триггера)
  - [**11. Работа с разделами (Partitions)**](#11-работа-с-разделами-partitions)
    - [**11.1. Создание разделённой таблицы**](#111-создание-разделённой-таблицы)
    - [**11.2. Создание разделов**](#112-создание-разделов)
    - [**11.3. Добавление раздела**](#113-добавление-раздела)
    - [**11.4. Удаление раздела**](#114-удаление-раздела)
  - [**12. Работа с внешними таблицами (Foreign Data Wrappers)**](#12-работа-с-внешними-таблицами-foreign-data-wrappers)
    - [**12.1. Создание расширения для работы с внешними данными**](#121-создание-расширения-для-работы-с-внешними-данными)
    - [**12.2. Создание сервера для внешних данных**](#122-создание-сервера-для-внешних-данных)
    - [**12.3. Создание пользовательского отображения**](#123-создание-пользовательского-отображения)
    - [**12.4. Создание внешней таблицы**](#124-создание-внешней-таблицы)
    - [**12.5. Запрос к внешней таблице**](#125-запрос-к-внешней-таблице)
    - [**12.6. Удаление внешней таблицы**](#126-удаление-внешней-таблицы)
  - [**13. Работа с полнотекстовым поиском**](#13-работа-с-полнотекстовым-поиском)
    - [**13.1. Создание столбца для полнотекстового поиска**](#131-создание-столбца-для-полнотекстового-поиска)
    - [**13.2. Обновление столбца для полнотекстового поиска**](#132-обновление-столбца-для-полнотекстового-поиска)
    - [**13.3. Создание триггера для автоматического обновления**](#133-создание-триггера-для-автоматического-обновления)
    - [**13.4. Создание индекса для полнотекстового поиска**](#134-создание-индекса-для-полнотекстового-поиска)
    - [**13.5. Поиск с использованием полнотекстового индекса**](#135-поиск-с-использованием-полнотекстового-индекса)
    - [**13.6. Поиск с ранжированием**](#136-поиск-с-ранжированием)
  - [**14. Работа с JSON и JSONB**](#14-работа-с-json-и-jsonb)
    - [**14.1. Создание таблицы с JSON/JSONB**](#141-создание-таблицы-с-jsonjsonb)
    - [**14.2. Вставка данных в JSON/JSONB**](#142-вставка-данных-в-jsonjsonb)
    - [**13.3. Запрос данных из JSON/JSONB**](#133-запрос-данных-из-jsonjsonb)
    - [**14.4. Обновление данных в JSON/JSONB**](#144-обновление-данных-в-jsonjsonb)
    - [**14.5. Создание индекса для JSON/JSONB**](#145-создание-индекса-для-jsonjsonb)
  - [**15. Работа с временными таблицами**](#15-работа-с-временными-таблицами)
    - [**15.1. Создание временной таблицы**](#151-создание-временной-таблицы)
    - [**15.2. Использование временной таблицы**](#152-использование-временной-таблицы)
    - [**15.3. Удаление временной таблицы**](#153-удаление-временной-таблицы)
  - [**16. Работа с транзакциями**](#16-работа-с-транзакциями)
    - [**16.1. Начало транзакции**](#161-начало-транзакции)
    - [**16.2. Фиксация транзакции**](#162-фиксация-транзакции)
    - [**16.3. Откат транзакции**](#163-откат-транзакции)
    - [**16.4. Точки сохранения (Savepoints)**](#164-точки-сохранения-savepoints)
  - [**17. Работа с комментариями**](#17-работа-с-комментариями)
    - [**17.1. Добавление комментария к объекту**](#171-добавление-комментария-к-объекту)
    - [**17.2. Просмотр комментариев**](#172-просмотр-комментариев)
  - [**18. Работа с доменными ограничениями**](#18-работа-с-доменными-ограничениями)
    - [**18.1. Создание домена с ограничением**](#181-создание-домена-с-ограничением)
    - [**18.2. Использование домена**](#182-использование-домена)
  - [**19. Работа с типами данных**](#19-работа-с-типами-данных)
    - [**19.1. Основные типы данных**](#191-основные-типы-данных)
    - [**19.2. Примеры использования типов данных**](#192-примеры-использования-типов-данных)
      - [**Числовые типы**](#числовые-типы)
      - [**Строковые типы**](#строковые-типы)
      - [**Дата и время**](#дата-и-время)
      - [**JSON/JSONB**](#jsonjsonb)
      - [**Массивы**](#массивы)
  - [**20. Работа с ограничениями целостности**](#20-работа-с-ограничениями-целостности)
    - [**20.1. Первичный ключ (Primary Key)**](#201-первичный-ключ-primary-key)
    - [**20.2. Внешний ключ (Foreign Key)**](#202-внешний-ключ-foreign-key)
    - [**20.3. Уникальное ограничение (Unique)**](#203-уникальное-ограничение-unique)
    - [**20.4. Проверка (Check)**](#204-проверка-check)
    - [**20.5. Ограничение исключения (Exclusion)**](#205-ограничение-исключения-exclusion)
  - [**21. Работа с наследованием таблиц**](#21-работа-с-наследованием-таблиц)
    - [**21.1. Создание дочерней таблицы**](#211-создание-дочерней-таблицы)
    - [**21.2. Запрос данных из иерархии таблиц**](#212-запрос-данных-из-иерархии-таблиц)
  - [**22. Работа с разделами (Partitioning)**](#22-работа-с-разделами-partitioning)
    - [**22.1. Создание разделённой таблицы**](#221-создание-разделённой-таблицы)
    - [**22.2. Создание разделов**](#222-создание-разделов)
    - [**22.3. Добавление раздела**](#223-добавление-раздела)
    - [**22.4. Удаление раздела**](#224-удаление-раздела)
  - [**23. Работа с материализованными представлениями**](#23-работа-с-материализованными-представлениями)
    - [**23.1. Создание материализованного представления**](#231-создание-материализованного-представления)
    - [**23.2. Обновление материализованного представления**](#232-обновление-материализованного-представления)
    - [**23.3. Удаление материализованного представления**](#233-удаление-материализованного-представления)
  - [**24. Работа с внешними данными (Foreign Data Wrappers)**](#24-работа-с-внешними-данными-foreign-data-wrappers)
    - [**24.1. Создание расширения для работы с внешними данными**](#241-создание-расширения-для-работы-с-внешними-данными)
    - [**24.2. Создание сервера для внешних данных**](#242-создание-сервера-для-внешних-данных)
    - [**24.3. Создание пользовательского отображения**](#243-создание-пользовательского-отображения)
    - [**24.4. Создание внешней таблицы**](#244-создание-внешней-таблицы)
    - [**24.5. Запрос к внешней таблице**](#245-запрос-к-внешней-таблице)
    - [**24.6. Удаление внешней таблицы**](#246-удаление-внешней-таблицы)
  - [**25. Работа с событиями (Event Triggers)**](#25-работа-с-событиями-event-triggers)
    - [**25.1. Создание функции для событийного триггера**](#251-создание-функции-для-событийного-триггера)
    - [**25.2. Создание событийного триггера**](#252-создание-событийного-триггера)
    - [**25.3. Удаление событийного триггера**](#253-удаление-событийного-триггера)
  - [**26. Работа с транзакциями и блокировками**](#26-работа-с-транзакциями-и-блокировками)
    - [**26.1. Начало транзакции**](#261-начало-транзакции)
    - [**26.2. Фиксация транзакции**](#262-фиксация-транзакции)
    - [**26.3. Откат транзакции**](#263-откат-транзакции)
    - [**26.4. Точки сохранения (Savepoints)**](#264-точки-сохранения-savepoints)
    - [**26.5. Уровни изоляции транзакций**](#265-уровни-изоляции-транзакций)
    - [**26.6. Блокировки**](#266-блокировки)
  - [**27. Работа с комментариями**](#27-работа-с-комментариями)
    - [**27.1. Добавление комментария к объекту**](#271-добавление-комментария-к-объекту)
    - [**27.2. Просмотр комментариев**](#272-просмотр-комментариев)
  - [**28. Работа с последовательностями (Sequences)**](#28-работа-с-последовательностями-sequences)
    - [**28.1. Создание последовательности**](#281-создание-последовательности)
    - [**28.2. Использование последовательности**](#282-использование-последовательности)
    - [**28.3. Изменение последовательности**](#283-изменение-последовательности)
    - [**28.4. Удаление последовательности**](#284-удаление-последовательности)
  - [**29. Работа с триггерами**](#29-работа-с-триггерами)
    - [**29.1. Создание триггерной функции**](#291-создание-триггерной-функции)
    - [**29.2. Создание триггера**](#292-создание-триггера)
    - [**29.3. Удаление триггера**](#293-удаление-триггера)
  - [**30. Работа с функциями и процедурами**](#30-работа-с-функциями-и-процедурами)
    - [**30.1. Создание функции**](#301-создание-функции)
    - [**30.2. Вызов функции**](#302-вызов-функции)
    - [**30.3. Создание процедуры**](#303-создание-процедуры)
    - [**30.4. Вызов процедуры**](#304-вызов-процедуры)
    - [**30.5. Удаление функции или процедуры**](#305-удаление-функции-или-процедуры)
  - [**31. Работа с представлениями (Views)**](#31-работа-с-представлениями-views)
    - [**31.1. Создание представления**](#311-создание-представления)
    - [**31.2. Запрос к представлению**](#312-запрос-к-представлению)
    - [**31.3. Удаление представления**](#313-удаление-представления)
  - [**32. Работа с временными таблицами**](#32-работа-с-временными-таблицами)
    - [**32.1. Создание временной таблицы**](#321-создание-временной-таблицы)
    - [**32.2. Использование временной таблицы**](#322-использование-временной-таблицы)
  - [**33. Работа с ролями и правами доступа**](#33-работа-с-ролями-и-правами-доступа)
    - [**33.1. Создание роли**](#331-создание-роли)
    - [**33.2. Изменение роли**](#332-изменение-роли)
    - [**33.3. Удаление роли**](#333-удаление-роли)
    - [**33.4. Предоставление прав доступа**](#334-предоставление-прав-доступа)
    - [**33.5. Отзыв прав доступа**](#335-отзыв-прав-доступа)
  - [**34. Работа с табличными пространствами (Tablespaces)**](#34-работа-с-табличными-пространствами-tablespaces)
    - [**34.1. Создание табличного пространства**](#341-создание-табличного-пространства)
    - [**34.2. Изменение табличного пространства**](#342-изменение-табличного-пространства)
    - [**34.3. Удаление табличного пространства**](#343-удаление-табличного-пространства)
    - [**34.4. Использование табличного пространства**](#344-использование-табличного-пространства)
  - [**35. Работа с доменами (Domains)**](#35-работа-с-доменами-domains)
    - [**35.1. Создание домена**](#351-создание-домена)
    - [**35.2. Использование домена**](#352-использование-домена)
    - [**35.3. Изменение домена**](#353-изменение-домена)
    - [**35.4. Удаление домена**](#354-удаление-домена)
  - [**36. Работа с пользовательскими типами данных**](#36-работа-с-пользовательскими-типами-данных)
    - [**36.1. Создание пользовательского типа**](#361-создание-пользовательского-типа)
    - [**36.2. Использование пользовательского типа**](#362-использование-пользовательского-типа)
    - [**36.3. Изменение пользовательского типа**](#363-изменение-пользовательского-типа)
    - [**36.4. Удаление пользовательского типа**](#364-удаление-пользовательского-типа)
  - [**37. Работа с расширениями (Extensions)**](#37-работа-с-расширениями-extensions)
    - [**37.1. Создание расширения**](#371-создание-расширения)
    - [**37.2. Удаление расширения**](#372-удаление-расширения)
  - [**38. Работа с JSON и JSONB**](#38-работа-с-json-и-jsonb)
    - [**38.1. Создание таблицы с JSON/JSONB**](#381-создание-таблицы-с-jsonjsonb)
    - [**38.2. Вставка данных в JSON/JSONB**](#382-вставка-данных-в-jsonjsonb)
    - [**38.3. Запрос данных из JSON/JSONB**](#383-запрос-данных-из-jsonjsonb)
    - [**38.4. Обновление данных в JSON/JSONB**](#384-обновление-данных-в-jsonjsonb)
    - [**38.5. Создание индекса для JSON/JSONB**](#385-создание-индекса-для-jsonjsonb)
  - [**39. Работа с массивами**](#39-работа-с-массивами)
    - [**39.1. Создание таблицы с массивами**](#391-создание-таблицы-с-массивами)
    - [**39.2. Вставка данных в массив**](#392-вставка-данных-в-массив)
    - [**39.3. Запрос данных из массива**](#393-запрос-данных-из-массива)
    - [**39.4. Обновление данных в массиве**](#394-обновление-данных-в-массиве)
    - [**39.5. Создание индекса для массива**](#395-создание-индекса-для-массива)
  - [**40. Работа с геометрическими типами данных**](#40-работа-с-геометрическими-типами-данных)
    - [**40.1. Установка расширения PostGIS**](#401-установка-расширения-postgis)
    - [**40.2. Создание таблицы с геометрическими данными**](#402-создание-таблицы-с-геометрическими-данными)
    - [**40.3. Вставка геометрических данных**](#403-вставка-геометрических-данных)
    - [**40.4. Запрос геометрических данных**](#404-запрос-геометрических-данных)
    - [**40.5. Создание пространственного индекса**](#405-создание-пространственного-индекса)
  - [**41. Работа с временными зонами**](#41-работа-с-временными-зонами)
    - [**41.1. Установка временной зоны**](#411-установка-временной-зоны)
    - [**41.2. Работа с временными метками**](#412-работа-с-временными-метками)
  - [**42. Работа с транзакциями и блокировками**](#42-работа-с-транзакциями-и-блокировками)
    - [**42.1. Начало транзакции**](#421-начало-транзакции)
    - [**42.2. Фиксация транзакции**](#422-фиксация-транзакции)
    - [**42.3. Откат транзакции**](#423-откат-транзакции)
    - [**42.4. Точки сохранения (Savepoints)**](#424-точки-сохранения-savepoints)
    - [**42.5. Уровни изоляции транзакций**](#425-уровни-изоляции-транзакций)
    - [**42.6. Блокировки**](#426-блокировки)
  - [**43. Работа с репликацией**](#43-работа-с-репликацией)
    - [**43.1. Настройка потоковой репликации (Streaming Replication)**](#431-настройка-потоковой-репликации-streaming-replication)
    - [**43.2. Настройка логической репликации (Logical Replication)**](#432-настройка-логической-репликации-logical-replication)
  - [**44. Работа с резервным копированием и восстановлением**](#44-работа-с-резервным-копированием-и-восстановлением)
    - [**44.1. Создание резервной копии с помощью `pg_dump`**](#441-создание-резервной-копии-с-помощью-pg_dump)
    - [**44.2. Восстановление из резервной копии с помощью `psql`**](#442-восстановление-из-резервной-копии-с-помощью-psql)
    - [**44.3. Создание бинарной резервной копии с помощью `pg_basebackup`**](#443-создание-бинарной-резервной-копии-с-помощью-pg_basebackup)
    - [**44.4. Восстановление из бинарной резервной копии**](#444-восстановление-из-бинарной-резервной-копии)
  - [**45. Работа с мониторингом и производительностью**](#45-работа-с-мониторингом-и-производительностью)
    - [**45.1. Просмотр активных соединений**](#451-просмотр-активных-соединений)
    - [**45.2. Просмотр статистики таблиц**](#452-просмотр-статистики-таблиц)
    - [**45.3. Просмотр статистики индексов**](#453-просмотр-статистики-индексов)
    - [**45.4. Анализ производительности запросов**](#454-анализ-производительности-запросов)
    - [**45.5. Просмотр блокировок**](#455-просмотр-блокировок)
    - [**45.6. Просмотр настроек PostgreSQL**](#456-просмотр-настроек-postgresql)
    - [**45.7. Изменение настроек PostgreSQL**](#457-изменение-настроек-postgresql)
  - [**46. Работа с расширением `pg_partman` для управления разделами**](#46-работа-с-расширением-pg_partman-для-управления-разделами)
    - [**46.1. Установка расширения**](#461-установка-расширения)
    - [**46.2. Создание разделённой таблицы**](#462-создание-разделённой-таблицы)
    - [**46.3. Добавление нового раздела**](#463-добавление-нового-раздела)
    - [**46.4. Удаление старого раздела**](#464-удаление-старого-раздела)
    - [**46.5. Настройка автоматического управления разделами**](#465-настройка-автоматического-управления-разделами)
  - [**47. Работа с расширением `pg_stat_statements` для анализа запросов**](#47-работа-с-расширением-pg_stat_statements-для-анализа-запросов)
    - [**47.1. Установка расширения**](#471-установка-расширения)
    - [**47.2. Просмотр статистики запросов**](#472-просмотр-статистики-запросов)
    - [**47.3. Сброс статистики**](#473-сброс-статистики)
  - [**48. Работа с расширением `pg_repack` для дефрагментации таблиц**](#48-работа-с-расширением-pg_repack-для-дефрагментации-таблиц)
    - [**48.1. Установка расширения**](#481-установка-расширения)
    - [**48.2. Дефрагментация таблицы**](#482-дефрагментация-таблицы)
    - [**48.3. Дефрагментация всех таблиц в базе данных**](#483-дефрагментация-всех-таблиц-в-базе-данных)
  - [**49. Работа с расширением `pgAudit` для аудита**](#49-работа-с-расширением-pgaudit-для-аудита)
    - [**49.1. Установка расширения**](#491-установка-расширения)
    - [**49.2. Настройка аудита в `postgresql.conf`**](#492-настройка-аудита-в-postgresqlconf)
    - [**49.3. Просмотр журнала аудита**](#493-просмотр-журнала-аудита)
  - [**50. Работа с расширением `PostGIS` для геопространственных данных**](#50-работа-с-расширением-postgis-для-геопространственных-данных)
    - [**50.1. Установка расширения**](#501-установка-расширения)
    - [**50.2. Создание таблицы с геометрическими данными**](#502-создание-таблицы-с-геометрическими-данными)
    - [**50.3. Вставка геометрических данных**](#503-вставка-геометрических-данных)
    - [**50.4. Запрос геометрических данных**](#504-запрос-геометрических-данных)
    - [**50.5. Создание пространственного индекса**](#505-создание-пространственного-индекса)
  - [**51. Работа с расширением `pg_cron` для планирования задач**](#51-работа-с-расширением-pg_cron-для-планирования-задач)
    - [**51.1. Установка расширения**](#511-установка-расширения)
    - [**51.2. Добавление задачи в расписание**](#512-добавление-задачи-в-расписание)
    - [**51.3. Просмотр запланированных задач**](#513-просмотр-запланированных-задач)
    - [**51.4. Удаление задачи из расписания**](#514-удаление-задачи-из-расписания)
  - [**52. Работа с расширением `uuid-ossp` для генерации UUID**](#52-работа-с-расширением-uuid-ossp-для-генерации-uuid)
    - [**52.1. Установка расширения**](#521-установка-расширения)
    - [**52.2. Генерация UUID**](#522-генерация-uuid)
  - [**53. Работа с расширением `hstore` для хранения пар "ключ-значение"**](#53-работа-с-расширением-hstore-для-хранения-пар-ключ-значение)
    - [**53.1. Установка расширения**](#531-установка-расширения)
    - [**53.2. Создание таблицы с полем `hstore`**](#532-создание-таблицы-с-полем-hstore)
    - [**53.3. Вставка данных в `hstore`**](#533-вставка-данных-в-hstore)
    - [**53.4. Запрос данных из `hstore`**](#534-запрос-данных-из-hstore)
    - [**53.5. Обновление данных в `hstore`**](#535-обновление-данных-в-hstore)
    - [**53.6. Создание индекса для `hstore`**](#536-создание-индекса-для-hstore)
  - [**54. Работа с расширением `citext` для регистронезависимого сравнения строк**](#54-работа-с-расширением-citext-для-регистронезависимого-сравнения-строк)
    - [**54.1. Установка расширения**](#541-установка-расширения)
    - [**54.2. Создание таблицы с полем `citext`**](#542-создание-таблицы-с-полем-citext)
    - [**54.3. Вставка данных в `citext`**](#543-вставка-данных-в-citext)
    - [**54.4. Запрос данных из `citext`**](#544-запрос-данных-из-citext)
    - [**54.5. Создание индекса для `citext`**](#545-создание-индекса-для-citext)
  - [**55. Работа с расширением `pg_trgm` для нечёткого поиска**](#55-работа-с-расширением-pg_trgm-для-нечёткого-поиска)
    - [**55.1. Установка расширения**](#551-установка-расширения)
    - [**55.2. Создание индекса для нечёткого поиска**](#552-создание-индекса-для-нечёткого-поиска)
    - [**55.3. Поиск похожих строк**](#553-поиск-похожих-строк)
    - [**55.4. Оценка схожести строк**](#554-оценка-схожести-строк)
  - [**56. Работа с расширением `tablefunc` для работы с таблицами**](#56-работа-с-расширением-tablefunc-для-работы-с-таблицами)
    - [**56.1. Установка расширения**](#561-установка-расширения)
    - [**56.2. Использование функции `crosstab`**](#562-использование-функции-crosstab)
  - [**57. Работа с расширением `pg_buffercache` для анализа кэша**](#57-работа-с-расширением-pg_buffercache-для-анализа-кэша)
    - [**57.1. Установка расширения**](#571-установка-расширения)
    - [**57.2. Просмотр содержимого кэша**](#572-просмотр-содержимого-кэша)
  - [**58. Работа с расширением `pg_prewarm` для предварительной загрузки данных в кэш**](#58-работа-с-расширением-pg_prewarm-для-предварительной-загрузки-данных-в-кэш)
    - [**58.1. Установка расширения**](#581-установка-расширения)
    - [**58.2. Предварительная загрузка таблицы в кэш**](#582-предварительная-загрузка-таблицы-в-кэш)
  - [**59. Работа с расширением `pg_visibility` для анализа видимости строк**](#59-работа-с-расширением-pg_visibility-для-анализа-видимости-строк)
    - [**59.1. Установка расширения**](#591-установка-расширения)
    - [**59.2. Просмотр статистики видимости строк**](#592-просмотр-статистики-видимости-строк)
  - [**60. Работа с расширением `pg_freespacemap` для анализа свободного пространства**](#60-работа-с-расширением-pg_freespacemap-для-анализа-свободного-пространства)
    - [**60.1. Установка расширения**](#601-установка-расширения)
    - [**60.2. Просмотр информации о свободном пространстве**](#602-просмотр-информации-о-свободном-пространстве)
  - [**61. Работа с расширением `pgrowlocks` для анализа блокировок строк**](#61-работа-с-расширением-pgrowlocks-для-анализа-блокировок-строк)
    - [**61.1. Установка расширения**](#611-установка-расширения)
    - [**61.2. Просмотр блокировок строк**](#612-просмотр-блокировок-строк)
  - [**62. Работа с расширением `pg_stat_kcache` для анализа использования кэша ядра**](#62-работа-с-расширением-pg_stat_kcache-для-анализа-использования-кэша-ядра)
    - [**62.1. Установка расширения**](#621-установка-расширения)
    - [**62.2. Просмотр статистики использования кэша**](#622-просмотр-статистики-использования-кэша)
  - [**63. Работа с расширением `pg_wait_sampling` для анализа ожиданий**](#63-работа-с-расширением-pg_wait_sampling-для-анализа-ожиданий)
    - [**63.1. Установка расширения**](#631-установка-расширения)
    - [**63.2. Запуск сбора статистики ожиданий**](#632-запуск-сбора-статистики-ожиданий)
    - [**63.3. Просмотр статистики ожиданий**](#633-просмотр-статистики-ожиданий)
    - [**63.4. Остановка сбора статистики ожиданий**](#634-остановка-сбора-статистики-ожиданий)
  - [**64. Работа с расширением `hypopg` для гипотетических индексов**](#64-работа-с-расширением-hypopg-для-гипотетических-индексов)
    - [**64.1. Установка расширения**](#641-установка-расширения)
    - [**64.2. Создание гипотетического индекса**](#642-создание-гипотетического-индекса)
    - [**64.3. Проверка использования гипотетического индекса**](#643-проверка-использования-гипотетического-индекса)
    - [**64.4. Удаление гипотетического индекса**](#644-удаление-гипотетического-индекса)
  - [**65. Работа с расширением `pgqualstats` для анализа условий в запросах**](#65-работа-с-расширением-pgqualstats-для-анализа-условий-в-запросах)
    - [**65.1. Установка расширения**](#651-установка-расширения)
    - [**65.2. Просмотр статистики условий**](#652-просмотр-статистики-условий)
  - [**66. Работа с расширением `pg_track_settings` для отслеживания изменений настроек**](#66-работа-с-расширением-pg_track_settings-для-отслеживания-изменений-настроек)
    - [**66.1. Установка расширения**](#661-установка-расширения)
    - [**66.2. Просмотр истории изменений настроек**](#662-просмотр-истории-изменений-настроек)
  - [**67. Работа с расширением `wal2json` для логической репликации**](#67-работа-с-расширением-wal2json-для-логической-репликации)
    - [**67.1. Установка расширения**](#671-установка-расширения)
    - [**67.2. Настройка логической репликации с использованием `wal2json`**](#672-настройка-логической-репликации-с-использованием-wal2json)
  - [**68. Работа с расширением `pg_jieba` для китайской сегментации текста**](#68-работа-с-расширением-pg_jieba-для-китайской-сегментации-текста)
    - [**68.1. Установка расширения**](#681-установка-расширения)
    - [**68.2. Сегментация китайского текста**](#682-сегментация-китайского-текста)
  - [**69. Работа с расширением `pg_similarity` для сравнения строк**](#69-работа-с-расширением-pg_similarity-для-сравнения-строк)
    - [**69.1. Установка расширения**](#691-установка-расширения)
    - [**69.2. Сравнение строк**](#692-сравнение-строк)
  - [**70. Работа с расширением `pgTAP` для тестирования**](#70-работа-с-расширением-pgtap-для-тестирования)
    - [**70.1. Установка расширения**](#701-установка-расширения)
    - [**70.2. Написание тестов**](#702-написание-тестов)
  - [**71. Работа с расширением `pgMemCache` для кэширования**](#71-работа-с-расширением-pgmemcache-для-кэширования)
    - [**71.1. Установка расширения**](#711-установка-расширения)
    - [**71.2. Использование кэша**](#712-использование-кэша)
  - [**72. Работа с расширением `pg_bigm` для полнотекстового поиска на японском языке**](#72-работа-с-расширением-pg_bigm-для-полнотекстового-поиска-на-японском-языке)
    - [**72.1. Установка расширения**](#721-установка-расширения)
    - [**72.2. Создание индекса для японского текста**](#722-создание-индекса-для-японского-текста)
  - [**73. Работа с расширением `pg_roaringbitmap` для работы с битовыми картами**](#73-работа-с-расширением-pg_roaringbitmap-для-работы-с-битовыми-картами)
    - [**73.1. Установка расширения**](#731-установка-расширения)
    - [**73.2. Использование битовых карт**](#732-использование-битовых-карт)
  - [**74. Работа с расширением `pg_partman` для управления разделами**](#74-работа-с-расширением-pg_partman-для-управления-разделами)
    - [**74.1. Установка расширения**](#741-установка-расширения)
    - [**74.2. Создание разделённой таблицы**](#742-создание-разделённой-таблицы)
    - [**74.3. Добавление нового раздела**](#743-добавление-нового-раздела)
    - [**74.4. Удаление старого раздела**](#744-удаление-старого-раздела)
    - [**74.5. Настройка автоматического управления разделами**](#745-настройка-автоматического-управления-разделами)
  - [**75. Работа с расширением `timescaledb` для временных рядов**](#75-работа-с-расширением-timescaledb-для-временных-рядов)
    - [**75.1. Установка расширения**](#751-установка-расширения)
    - [**75.2. Создание гипертаблицы**](#752-создание-гипертаблицы)
    - [**75.3. Добавление данных в гипертаблицу**](#753-добавление-данных-в-гипертаблицу)
    - [**75.4. Запрос данных из гипертаблицы**](#754-запрос-данных-из-гипертаблицы)
    - [**75.5. Создание непрерывных агрегатов**](#755-создание-непрерывных-агрегатов)
    - [**75.6. Обновление непрерывных агрегатов**](#756-обновление-непрерывных-агрегатов)
  - [**76. Работа с расширением `pg_graphql` для GraphQL**](#76-работа-с-расширением-pg_graphql-для-graphql)
    - [**76.1. Установка расширения**](#761-установка-расширения)
    - [**76.2. Выполнение GraphQL-запросов**](#762-выполнение-graphql-запросов)
  - [**77. Работа с расширением `pg_net` для работы с сетями**](#77-работа-с-расширением-pg_net-для-работы-с-сетями)
    - [**77.1. Установка расширения**](#771-установка-расширения)
    - [**77.2. Использование сетевых функций**](#772-использование-сетевых-функций)
  - [**78. Работа с расширением `pg_qualstats` для анализа условий в запросах**](#78-работа-с-расширением-pg_qualstats-для-анализа-условий-в-запросах)
    - [**78.1. Установка расширения**](#781-установка-расширения)
    - [**78.2. Просмотр статистики условий**](#782-просмотр-статистики-условий)
  - [**79. Работа с расширением `pg_stat_monitor` для мониторинга запросов**](#79-работа-с-расширением-pg_stat_monitor-для-мониторинга-запросов)
    - [**79.1. Установка расширения**](#791-установка-расширения)
    - [**79.2. Просмотр статистики запросов**](#792-просмотр-статистики-запросов)
  - [**80. Работа с расширением `pg_walinspect` для анализа WAL**](#80-работа-с-расширением-pg_walinspect-для-анализа-wal)
    - [**80.1. Установка расширения**](#801-установка-расширения)
    - [**80.2. Просмотр информации из WAL**](#802-просмотр-информации-из-wal)
  - [**81. Работа с расширением `pg_hint_plan` для управления планами выполнения**](#81-работа-с-расширением-pg_hint_plan-для-управления-планами-выполнения)
    - [**81.1. Установка расширения**](#811-установка-расширения)
    - [**81.2. Использование hint-ов в запросах**](#812-использование-hint-ов-в-запросах)
    - [**81.3. Настройка hint-ов на уровне базы данных**](#813-настройка-hint-ов-на-уровне-базы-данных)
  - [**82. Работа с расширением `pg_visibility` для анализа видимости строк**](#82-работа-с-расширением-pg_visibility-для-анализа-видимости-строк)
    - [**82.1. Установка расширения**](#821-установка-расширения)
    - [**82.2. Просмотр статистики видимости строк**](#822-просмотр-статистики-видимости-строк)
  - [**83. Работа с расширением `pg_freespacemap` для анализа свободного пространства**](#83-работа-с-расширением-pg_freespacemap-для-анализа-свободного-пространства)
    - [**83.1. Установка расширения**](#831-установка-расширения)
    - [**83.2. Просмотр информации о свободном пространстве**](#832-просмотр-информации-о-свободном-пространстве)
  - [**84. Работа с расширением `pgrowlocks` для анализа блокировок строк**](#84-работа-с-расширением-pgrowlocks-для-анализа-блокировок-строк)
    - [**84.1. Установка расширения**](#841-установка-расширения)
    - [**84.2. Просмотр блокировок строк**](#842-просмотр-блокировок-строк)
  - [**85. Работа с расширением `pg_stat_kcache` для анализа использования кэша ядра**](#85-работа-с-расширением-pg_stat_kcache-для-анализа-использования-кэша-ядра)
    - [**85.1. Установка расширения**](#851-установка-расширения)
    - [**85.2. Просмотр статистики использования кэша**](#852-просмотр-статистики-использования-кэша)
  - [**86. Работа с расширением `pg_wait_sampling` для анализа ожиданий**](#86-работа-с-расширением-pg_wait_sampling-для-анализа-ожиданий)
    - [**86.1. Установка расширения**](#861-установка-расширения)
    - [**86.2. Запуск сбора статистики ожиданий**](#862-запуск-сбора-статистики-ожиданий)
    - [**86.3. Просмотр статистики ожиданий**](#863-просмотр-статистики-ожиданий)
    - [**86.4. Остановка сбора статистики ожиданий**](#864-остановка-сбора-статистики-ожиданий)
  - [**87. Работа с расширением `hypopg` для гипотетических индексов**](#87-работа-с-расширением-hypopg-для-гипотетических-индексов)
    - [**87.1. Установка расширения**](#871-установка-расширения)
    - [**87.2. Создание гипотетического индекса**](#872-создание-гипотетического-индекса)
    - [**87.3. Проверка использования гипотетического индекса**](#873-проверка-использования-гипотетического-индекса)
    - [**87.4. Удаление гипотетического индекса**](#874-удаление-гипотетического-индекса)
  - [**88. Работа с расширением `pgqualstats` для анализа условий в запросах**](#88-работа-с-расширением-pgqualstats-для-анализа-условий-в-запросах)
    - [**88.1. Установка расширения**](#881-установка-расширения)
    - [**88.2. Просмотр статистики условий**](#882-просмотр-статистики-условий)
  - [**89. Работа с расширением `pg_track_settings` для отслеживания изменений настроек**](#89-работа-с-расширением-pg_track_settings-для-отслеживания-изменений-настроек)
    - [**89.1. Установка расширения**](#891-установка-расширения)
    - [**89.2. Просмотр истории изменений настроек**](#892-просмотр-истории-изменений-настроек)
  - [**90. Работа с расширением `wal2json` для логической репликации**](#90-работа-с-расширением-wal2json-для-логической-репликации)
    - [**90.1. Установка расширения**](#901-установка-расширения)
    - [**90.2. Настройка логической репликации с использованием `wal2json`**](#902-настройка-логической-репликации-с-использованием-wal2json)
  - [**91. Работа с расширением `pg_jieba` для китайской сегментации текста**](#91-работа-с-расширением-pg_jieba-для-китайской-сегментации-текста)
    - [**91.1. Установка расширения**](#911-установка-расширения)
    - [**91.2. Сегментация китайского текста**](#912-сегментация-китайского-текста)
  - [**92. Работа с расширением `pg_similarity` для сравнения строк**](#92-работа-с-расширением-pg_similarity-для-сравнения-строк)
    - [**92.1. Установка расширения**](#921-установка-расширения)
    - [**92.2. Сравнение строк**](#922-сравнение-строк)
  - [**93. Работа с расширением `pgTAP` для тестирования**](#93-работа-с-расширением-pgtap-для-тестирования)
    - [**93.1. Установка расширения**](#931-установка-расширения)
    - [**93.2. Написание тестов**](#932-написание-тестов)
  - [**94. Работа с расширением `pgMemCache` для кэширования**](#94-работа-с-расширением-pgmemcache-для-кэширования)
    - [**94.1. Установка расширения**](#941-установка-расширения)
    - [**94.2. Использование кэша**](#942-использование-кэша)
  - [**95. Работа с расширением `pg_bigm` для полнотекстового поиска на японском языке**](#95-работа-с-расширением-pg_bigm-для-полнотекстового-поиска-на-японском-языке)
    - [**95.1. Установка расширения**](#951-установка-расширения)
    - [**95.2. Создание индекса для японского текста**](#952-создание-индекса-для-японского-текста)
  - [**96. Работа с расширением `pg_roaringbitmap` для работы с битовыми картами**](#96-работа-с-расширением-pg_roaringbitmap-для-работы-с-битовыми-картами)
    - [**96.1. Установка расширения**](#961-установка-расширения)
    - [**96.2. Использование битовых карт**](#962-использование-битовых-карт)
  - [**97. Работа с расширением `pg_partman` для управления разделами**](#97-работа-с-расширением-pg_partman-для-управления-разделами)
    - [**97.1. Установка расширения**](#971-установка-расширения)
    - [**97.2. Создание разделённой таблицы**](#972-создание-разделённой-таблицы)
    - [**97.3. Добавление нового раздела**](#973-добавление-нового-раздела)
    - [**97.4. Удаление старого раздела**](#974-удаление-старого-раздела)
    - [**97.5. Настройка автоматического управления разделами**](#975-настройка-автоматического-управления-разделами)
  - [**98. Работа с расширением `timescaledb` для временных рядов**](#98-работа-с-расширением-timescaledb-для-временных-рядов)
    - [**98.1. Установка расширения**](#981-установка-расширения)
    - [**98.2. Создание гипертаблицы**](#982-создание-гипертаблицы)
    - [**98.3. Добавление данных в гипертаблицу**](#983-добавление-данных-в-гипертаблицу)
    - [**98.4. Запрос данных из гипертаблицы**](#984-запрос-данных-из-гипертаблицы)
    - [**98.5. Создание непрерывных агрегатов**](#985-создание-непрерывных-агрегатов)
    - [**98.6. Обновление непрерывных агрегатов**](#986-обновление-непрерывных-агрегатов)
  - [**99. Работа с расширением `pg_graphql` для GraphQL**](#99-работа-с-расширением-pg_graphql-для-graphql)
    - [**99.1. Установка расширения**](#991-установка-расширения)
    - [**99.2. Выполнение GraphQL-запросов**](#992-выполнение-graphql-запросов)
  - [**100. Работа с расширением `pg_net` для работы с сетями**](#100-работа-с-расширением-pg_net-для-работы-с-сетями)
    - [**100.1. Установка расширения**](#1001-установка-расширения)
    - [**100.2. Использование сетевых функций**](#1002-использование-сетевых-функций)
**DDL (Data Definition Language)** — это набор команд для **определения и управления структурой базы данных**. В PostgreSQL DDL используется для создания, изменения и удаления объектов базы данных, таких как таблицы, индексы, представления, функции, триггеры и другие.

---

## **1. Основные команды DDL**

### **1.1. Создание объектов (`CREATE`)**
Команда `CREATE` используется для создания новых объектов в базе данных.

---

#### **1.1.1. Создание базы данных**
```sql
CREATE DATABASE database_name
[WITH
    OWNER = user_name
    ENCODING = 'encoding'
    LC_COLLATE = 'locale'
    LC_CTYPE = 'locale'
    TABLESPACE = tablespace_name
    CONNECTION LIMIT = max_concurrent_connection];
```

**Пример:**
```sql
CREATE DATABASE my_database
WITH
    OWNER = postgres
    ENCODING = 'UTF8'
    LC_COLLATE = 'ru_RU.UTF-8'
    LC_CTYPE = 'ru_RU.UTF-8'
    TABLESPACE = pg_default
    CONNECTION LIMIT = 100;
```

---

#### **1.1.2. Создание схемы**
Схемы используются для организации объектов базы данных.

```sql
CREATE SCHEMA schema_name [AUTHORIZATION user_name];
```

**Пример:**
```sql
CREATE SCHEMA hr AUTHORIZATION postgres;
```

---

#### **1.1.3. Создание таблицы**
```sql
CREATE TABLE table_name (
    column1 data_type [constraints],
    column2 data_type [constraints],
    ...
    [table_constraints]
);
```

**Пример:**
```sql
CREATE TABLE employees (
    employee_id SERIAL PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE,
    hire_date DATE NOT NULL,
    salary DECIMAL(10, 2) CHECK (salary > 0),
    department_id INTEGER REFERENCES departments(department_id)
);
```

---

#### **1.1.4. Создание индекса**
```sql
CREATE [UNIQUE] INDEX index_name
ON table_name (column1, column2, ...)
[USING method]
[TABLESPACE tablespace_name];
```

**Пример:**
```sql
CREATE INDEX idx_employees_last_name ON employees(last_name);
CREATE UNIQUE INDEX idx_employees_email ON employees(email);
```

---

#### **1.1.5. Создание представления (View)**
```sql
CREATE [OR REPLACE] VIEW view_name AS
SELECT column1, column2, ...
FROM table_name
[WHERE condition];
```

**Пример:**
```sql
CREATE VIEW high_salary_employees AS
SELECT first_name, last_name, salary
FROM employees
WHERE salary > 100000;
```

---

#### **1.1.6. Создание последовательности (Sequence)**
```sql
CREATE SEQUENCE sequence_name
[INCREMENT BY increment]
[MINVALUE minvalue | NO MINVALUE]
[MAXVALUE maxvalue | NO MAXVALUE]
[START WITH start]
[CACHE cache]
[CYCLE | NO CYCLE];
```

**Пример:**
```sql
CREATE SEQUENCE employee_id_seq
INCREMENT BY 1
MINVALUE 1
START WITH 1
CACHE 20;
```

---

#### **1.1.7. Создание функции**
```sql
CREATE [OR REPLACE] FUNCTION function_name (parameter1 type1, parameter2 type2, ...)
RETURNS return_type AS $$
DECLARE
    -- переменные
BEGIN
    -- тело функции
END;
$$ LANGUAGE plpgsql;
```

**Пример:**
```sql
CREATE OR REPLACE FUNCTION calculate_bonus(salary DECIMAL)
RETURNS DECIMAL AS $$
BEGIN
    RETURN salary * 0.1;
END;
$$ LANGUAGE plpgsql;
```

---

#### **1.1.8. Создание триггера**
```sql
CREATE TRIGGER trigger_name
[BEFORE | AFTER | INSTEAD OF] [INSERT | UPDATE | DELETE | TRUNCATE]
ON table_name
[FOR EACH ROW | FOR EACH STATEMENT]
EXECUTE FUNCTION trigger_function();
```

**Пример:**
```sql
CREATE OR REPLACE FUNCTION log_employee_change()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO employee_audit (employee_id, old_salary, new_salary, change_date)
    VALUES (OLD.employee_id, OLD.salary, NEW.salary, NOW());
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_employee_update
AFTER UPDATE OF salary ON employees
FOR EACH ROW
EXECUTE FUNCTION log_employee_change();
```

---

### **1.2. Изменение объектов (`ALTER`)**
Команда `ALTER` используется для изменения существующих объектов.

---

#### **1.2.1. Изменение таблицы**
```sql
ALTER TABLE table_name
[ADD COLUMN column_name data_type [constraints]]
[DROP COLUMN column_name]
[ALTER COLUMN column_name [SET DATA TYPE data_type] [SET DEFAULT value] [DROP DEFAULT]]
[RENAME COLUMN old_column_name TO new_column_name]
[RENAME TO new_table_name]
[ADD CONSTRAINT constraint_name constraint_definition]
[DROP CONSTRAINT constraint_name];
```

**Примеры:**
```sql
-- Добавление нового столбца
ALTER TABLE employees ADD COLUMN phone_number VARCHAR(20);

-- Удаление столбца
ALTER TABLE employees DROP COLUMN phone_number;

-- Изменение типа данных столбца
ALTER TABLE employees ALTER COLUMN salary TYPE NUMERIC(12, 2);

-- Переименование столбца
ALTER TABLE employees RENAME COLUMN first_name TO given_name;

-- Переименование таблицы
ALTER TABLE employees RENAME TO staff;

-- Добавление ограничения
ALTER TABLE employees ADD CONSTRAINT chk_salary CHECK (salary > 0);

-- Удаление ограничения
ALTER TABLE employees DROP CONSTRAINT chk_salary;
```

---

#### **1.2.2. Изменение индекса**
```sql
ALTER INDEX index_name RENAME TO new_index_name;
```

**Пример:**
```sql
ALTER INDEX idx_employees_last_name RENAME TO idx_staff_last_name;
```

---

#### **1.2.3. Изменение представления**
```sql
CREATE OR REPLACE VIEW view_name AS
SELECT column1, column2, ...
FROM table_name
[WHERE condition];
```

---

#### **1.2.4. Изменение последовательности**
```sql
ALTER SEQUENCE sequence_name
[INCREMENT BY increment]
[MINVALUE minvalue | NO MINVALUE]
[MAXVALUE maxvalue | NO MAXVALUE]
[START WITH start]
[RESTART [WITH start]]
[CACHE cache | NO CACHE]
[CYCLE | NO CYCLE];
```

**Пример:**
```sql
ALTER SEQUENCE employee_id_seq INCREMENT BY 2;
```

---

### **1.3. Удаление объектов (`DROP`)**
Команда `DROP` используется для удаления объектов из базы данных.

---

#### **1.3.1. Удаление базы данных**
```sql
DROP DATABASE [IF EXISTS] database_name;
```

**Пример:**
```sql
DROP DATABASE IF EXISTS my_database;
```

---

#### **1.3.2. Удаление схемы**
```sql
DROP SCHEMA [IF EXISTS] schema_name [CASCADE | RESTRICT];
```

**Пример:**
```sql
DROP SCHEMA IF EXISTS hr CASCADE;
```

---

#### **1.3.3. Удаление таблицы**
```sql
DROP TABLE [IF EXISTS] table_name [CASCADE | RESTRICT];
```

**Пример:**
```sql
DROP TABLE IF EXISTS employees CASCADE;
```

---

#### **1.3.4. Удаление индекса**
```sql
DROP INDEX [IF EXISTS] index_name [CASCADE | RESTRICT];
```

**Пример:**
```sql
DROP INDEX IF EXISTS idx_employees_last_name;
```

---

#### **1.3.5. Удаление представления**
```sql
DROP VIEW [IF EXISTS] view_name [CASCADE | RESTRICT];
```

**Пример:**
```sql
DROP VIEW IF EXISTS high_salary_employees;
```

---

#### **1.3.6. Удаление последовательности**
```sql
DROP SEQUENCE [IF EXISTS] sequence_name [CASCADE | RESTRICT];
```

**Пример:**
```sql
DROP SEQUENCE IF EXISTS employee_id_seq;
```

---

#### **1.3.7. Удаление функции**
```sql
DROP FUNCTION [IF EXISTS] function_name (parameter1 type1, parameter2 type2, ...) [CASCADE | RESTRICT];
```

**Пример:**
```sql
DROP FUNCTION IF EXISTS calculate_bonus(DECIMAL);
```

---

#### **1.3.8. Удаление триггера**
```sql
DROP TRIGGER [IF EXISTS] trigger_name ON table_name [CASCADE | RESTRICT];
```

**Пример:**
```sql
DROP TRIGGER IF EXISTS trg_employee_update ON employees;
```

---

### **1.4. Переименование объектов (`RENAME`)**
Команда `RENAME` используется для переименования объектов.

---

#### **1.4.1. Переименование таблицы**
```sql
ALTER TABLE table_name RENAME TO new_table_name;
```

**Пример:**
```sql
ALTER TABLE employees RENAME TO staff;
```

---

#### **1.4.2. Переименование столбца**
```sql
ALTER TABLE table_name RENAME COLUMN old_column_name TO new_column_name;
```

**Пример:**
```sql
ALTER TABLE staff RENAME COLUMN first_name TO given_name;
```

---

#### **1.4.3. Переименование индекса**
```sql
ALTER INDEX index_name RENAME TO new_index_name;
```

**Пример:**
```sql
ALTER INDEX idx_employees_last_name RENAME TO idx_staff_last_name;
```

---

### **1.5. Удаление данных (`TRUNCATE`)**
Команда `TRUNCATE` используется для быстрого удаления всех данных из таблицы.

```sql
TRUNCATE [TABLE] table_name [RESTART IDENTITY | CONTINUE IDENTITY] [CASCADE | RESTRICT];
```

**Пример:**
```sql
TRUNCATE TABLE employees RESTART IDENTITY;
```

---

## **2. Ограничения (Constraints)**

Ограничения используются для обеспечения целостности данных.

---

### **2.1. Типы ограничений**



| Ограничение          | Описание                                                                                     | Пример                                                                                     |
|----------------------|----------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------|
| **PRIMARY KEY**      | Уникальный идентификатор строки.                                                            | `CREATE TABLE employees (employee_id SERIAL PRIMARY KEY, ...);`                            |
| **FOREIGN KEY**      | Обеспечивает ссылочную целостность между таблицами.                                         | `CREATE TABLE employees (..., department_id INTEGER REFERENCES departments(department_id));` |
| **UNIQUE**           | Гарантирует уникальность значений в столбце или группе столбцов.                            | `CREATE TABLE employees (..., email VARCHAR(100) UNIQUE);`                                  |
| **CHECK**            | Ограничивает значения в столбце на основе условия.                                           | `CREATE TABLE employees (..., salary DECIMAL(10, 2) CHECK (salary > 0));`                     |
| **NOT NULL**         | Запрещает значения `NULL` в столбце.                                                        | `CREATE TABLE employees (..., first_name VARCHAR(50) NOT NULL);`                            |
| **EXCLUDE**          | Исключает пересекающиеся значения (например, для временных интервалов).                     | `CREATE TABLE events (..., EXCLUDE USING gist (tsrange FROM start_time TO end_time WITH &&));` |

---

### **2.2. Добавление ограничений**
```sql
ALTER TABLE table_name
ADD CONSTRAINT constraint_name constraint_type (column_name);
```

**Пример:**
```sql
ALTER TABLE employees
ADD CONSTRAINT fk_department
FOREIGN KEY (department_id) REFERENCES departments(department_id);
```

---

### **2.3. Удаление ограничений**
```sql
ALTER TABLE table_name
DROP CONSTRAINT constraint_name;
```

**Пример:**
```sql
ALTER TABLE employees
DROP CONSTRAINT fk_department;
```

---

## **3. Работа с табличными пространствами (Tablespaces)**

Табличные пространства позволяют управлять физическим размещением данных.

---

### **3.1. Создание табличного пространства**
```sql
CREATE TABLESPACE tablespace_name
[OWNER user_name]
LOCATION '/path/to/directory';
```

**Пример:**
```sql
CREATE TABLESPACE my_tablespace
OWNER postgres
LOCATION '/var/lib/postgresql/data/my_tablespace';
```

---

### **3.2. Изменение табличного пространства**
```sql
ALTER TABLESPACE tablespace_name
[RENAME TO new_tablespace_name]
[OWNER TO new_owner];
```

**Пример:**
```sql
ALTER TABLESPACE my_tablespace RENAME TO new_tablespace;
```

---

### **3.3. Удаление табличного пространства**
```sql
DROP TABLESPACE [IF EXISTS] tablespace_name;
```

**Пример:**
```sql
DROP TABLESPACE IF EXISTS new_tablespace;
```

---

### **3.4. Использование табличного пространства**
```sql
CREATE TABLE table_name (
    ...
) TABLESPACE tablespace_name;

CREATE INDEX index_name ON table_name (column_name)
TABLESPACE tablespace_name;
```

**Пример:**
```sql
CREATE TABLE employees (
    employee_id SERIAL PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL
) TABLESPACE new_tablespace;
```

---

## **4. Работа с доменами (Domains)**

Домены позволяют создавать пользовательские типы данных с ограничениями.

---

### **4.1. Создание домена**
```sql
CREATE DOMAIN domain_name [AS] data_type
[DEFAULT default_value]
[constraints];
```

**Пример:**
```sql
CREATE DOMAIN positive_numeric AS NUMERIC
CHECK (VALUE > 0);
```

---

### **4.2. Использование домена**
```sql
CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    price positive_numeric
);
```

---

### **4.3. Изменение домена**
```sql
ALTER DOMAIN domain_name
[ADD CONSTRAINT constraint_name constraint_definition]
[DROP CONSTRAINT constraint_name];
```

**Пример:**
```sql
ALTER DOMAIN positive_numeric
ADD CONSTRAINT positive_check CHECK (VALUE > 0);
```

---

### **4.4. Удаление домена**
```sql
DROP DOMAIN [IF EXISTS] domain_name [CASCADE | RESTRICT];
```

**Пример:**
```sql
DROP DOMAIN IF EXISTS positive_numeric;
```

---

## **5. Работа с типами данных**

PostgreSQL поддерживает множество встроенных типов данных, а также позволяет создавать пользовательские типы.

---

### **5.1. Создание пользовательского типа**
```sql
CREATE TYPE type_name AS (
    attribute1 data_type,
    attribute2 data_type,
    ...
);
```

**Пример:**
```sql
CREATE TYPE address AS (
    street VARCHAR(100),
    city VARCHAR(50),
    postal_code VARCHAR(20)
);
```

---

### **5.2. Использование пользовательского типа**
```sql
CREATE TABLE customers (
    customer_id SERIAL PRIMARY KEY,
    customer_name VARCHAR(100),
    customer_address address
);
```

---

### **5.3. Изменение пользовательского типа**
```sql
ALTER TYPE type_name
[RENAME TO new_type_name]
[RENAME ATTRIBUTE attribute_name TO new_attribute_name]
[ADD ATTRIBUTE attribute_name data_type]
[DROP ATTRIBUTE [IF EXISTS] attribute_name [CASCADE | RESTRICT]];
```

**Пример:**
```sql
ALTER TYPE address
ADD ATTRIBUTE country VARCHAR(50);
```

---

### **5.4. Удаление пользовательского типа**
```sql
DROP TYPE [IF EXISTS] type_name [CASCADE | RESTRICT];
```

**Пример:**
```sql
DROP TYPE IF EXISTS address;
```

---

## **6. Работа с расширениями (Extensions)**

Расширения позволяют добавлять новые функции и типы данных в PostgreSQL.

---

### **6.1. Создание расширения**
```sql
CREATE EXTENSION [IF NOT EXISTS] extension_name [WITH] [SCHEMA schema_name];
```

**Пример:**
```sql
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
```

---

### **6.2. Удаление расширения**
```sql
DROP EXTENSION [IF EXISTS] extension_name [CASCADE | RESTRICT];
```

**Пример:**
```sql
DROP EXTENSION IF EXISTS "uuid-ossp";
```

---

## **7. Работа с ролями и правами доступа**

### **7.1. Создание роли**
```sql
CREATE ROLE role_name [WITH option_list];

option_list:
    SUPERUSER | NOSUPERUSER
    | CREATEDB | NOCREATEDB
    | CREATEROLE | NOCREATEROLE
    | INHERIT | NOINHERIT
    | LOGIN | NOLOGIN
    | REPLICATION | NOREPLICATION
    | BYPASSRLS | NOBYPASSRLS
    | CONNECTION LIMIT connlimit
    | [ENCRYPTED | UNENCRYPTED] PASSWORD 'password'
    | VALID UNTIL 'timestamp'
```

**Пример:**
```sql
CREATE ROLE app_user WITH LOGIN PASSWORD 'secure_password' CONNECTION LIMIT 10;
```

---

### **7.2. Изменение роли**
```sql
ALTER ROLE role_name [WITH option_list];
```

**Пример:**
```sql
ALTER ROLE app_user WITH PASSWORD 'new_secure_password';
```

---

### **7.3. Удаление роли**
```sql
DROP ROLE [IF EXISTS] role_name;
```

**Пример:**
```sql
DROP ROLE IF EXISTS app_user;
```

---

### **7.4. Предоставление прав доступа**
```sql
GRANT privilege [, ...]
ON object_type object_name [, ...]
TO role_name [, ...]
[WITH GRANT OPTION];
```

**Примеры:**
```sql
-- Предоставить права на SELECT для таблицы
GRANT SELECT ON employees TO app_user;

-- Предоставить все права на таблицу
GRANT ALL PRIVILEGES ON employees TO app_user;

-- Предоставить права на схему
GRANT USAGE ON SCHEMA hr TO app_user;

-- Предоставить права на создание объектов в схеме
GRANT CREATE ON SCHEMA hr TO app_user;
```

---

### **7.5. Отзыв прав доступа**
```sql
REVOKE [GRANT OPTION FOR] privilege [, ...]
ON object_type object_name [, ...]
FROM role_name [, ...]
[CASCADE | RESTRICT];
```

**Пример:**
```sql
REVOKE SELECT ON employees FROM app_user;
```

---

## **8. Работа с триггерами**

### **8.1. Создание триггерной функции**
```sql
CREATE OR REPLACE FUNCTION trigger_function()
RETURNS TRIGGER AS $$
BEGIN
    -- Логика триггера
    RETURN NEW; -- или RETURN OLD;
END;
$$ LANGUAGE plpgsql;
```

**Пример:**
```sql
CREATE OR REPLACE FUNCTION log_employee_change()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO employee_audit (employee_id, old_salary, new_salary, change_date)
    VALUES (OLD.employee_id, OLD.salary, NEW.salary, NOW());
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

---

### **8.2. Создание триггера**
```sql
CREATE TRIGGER trigger_name
[BEFORE | AFTER | INSTEAD OF] [INSERT | UPDATE | DELETE | TRUNCATE]
ON table_name
[FOR EACH ROW | FOR EACH STATEMENT]
EXECUTE FUNCTION trigger_function();
```

**Пример:**
```sql
CREATE TRIGGER trg_employee_update
AFTER UPDATE OF salary ON employees
FOR EACH ROW
EXECUTE FUNCTION log_employee_change();
```

---

### **8.3. Удаление триггера**
```sql
DROP TRIGGER [IF EXISTS] trigger_name ON table_name [CASCADE | RESTRICT];
```

**Пример:**
```sql
DROP TRIGGER IF EXISTS trg_employee_update ON employees;
```

---

## **9. Работа с материализованными представлениями**

Материализованные представления хранят результаты запроса и обновляются вручную или по расписанию.

---

### **9.1. Создание материализованного представления**
```sql
CREATE MATERIALIZED VIEW view_name AS
SELECT column1, column2, ...
FROM table_name
[WHERE condition]
[WITH [NO] DATA];
```

**Пример:**
```sql
CREATE MATERIALIZED VIEW high_salary_employees_mv AS
SELECT first_name, last_name, salary
FROM employees
WHERE salary > 100000;
```

---

### **9.2. Обновление материализованного представления**
```sql
REFRESH MATERIALIZED VIEW [CONCURRENTLY] view_name;
```

**Пример:**
```sql
REFRESH MATERIALIZED VIEW high_salary_employees_mv;
```

---

### **9.3. Удаление материализованного представления**
```sql
DROP MATERIALIZED VIEW [IF EXISTS] view_name [CASCADE | RESTRICT];
```

**Пример:**
```sql
DROP MATERIALIZED VIEW IF EXISTS high_salary_employees_mv;
```

---

## **10. Работа с событиями (Event Triggers)**

Событийные триггеры позволяют выполнять действия при выполнении определённых DDL-команд.

---

### **10.1. Создание функции для событийного триггера**
```sql
CREATE OR REPLACE FUNCTION event_trigger_function()
RETURNS event_trigger LANGUAGE plpgsql AS $$
BEGIN
    -- Логика триггера
END;
$$;
```

**Пример:**
```sql
CREATE OR REPLACE FUNCTION log_ddl_commands()
RETURNS event_trigger LANGUAGE plpgsql AS $$
BEGIN
    INSERT INTO ddl_audit (command_tag, object_type, object_identity)
    VALUES (tg_tag, pg_event_trigger_ddl_commands().object_type,
            pg_event_trigger_ddl_commands().object_identity);
END;
$$;
```

---

### **10.2. Создание событийного триггера**
```sql
CREATE EVENT TRIGGER trigger_name
ON ddl_command
EXECUTE FUNCTION event_trigger_function();
```

**Пример:**
```sql
CREATE EVENT TRIGGER trg_log_ddl
ON ddl_command_start
EXECUTE FUNCTION log_ddl_commands();
```

---

### **10.3. Удаление событийного триггера**
```sql
DROP EVENT TRIGGER [IF EXISTS] trigger_name;
```

**Пример:**
```sql
DROP EVENT TRIGGER IF EXISTS trg_log_ddl;
```

---

## **11. Работа с разделами (Partitions)**

Разделы позволяют разбивать большие таблицы на более мелкие части для улучшения производительности.

---

### **11.1. Создание разделённой таблицы**
```sql
CREATE TABLE table_name (
    column1 data_type,
    column2 data_type,
    ...
) PARTITION BY RANGE (column_name);
```

**Пример:**
```sql
CREATE TABLE sales (
    sale_id SERIAL,
    sale_date DATE NOT NULL,
    amount DECIMAL(10, 2)
) PARTITION BY RANGE (sale_date);
```

---

### **11.2. Создание разделов**
```sql
CREATE TABLE partition_name PARTITION OF table_name
FOR VALUES FROM (start_value) TO (end_value);
```

**Пример:**
```sql
CREATE TABLE sales_2023 PARTITION OF sales
FOR VALUES FROM ('2023-01-01') TO ('2024-01-01');

CREATE TABLE sales_2024 PARTITION OF sales
FOR VALUES FROM ('2024-01-01') TO ('2025-01-01');
```

---

### **11.3. Добавление раздела**
```sql
CREATE TABLE partition_name PARTITION OF table_name
FOR VALUES FROM (start_value) TO (end_value);
```

---

### **11.4. Удаление раздела**
```sql
DROP TABLE partition_name;
```

**Пример:**
```sql
DROP TABLE sales_2023;
```

---

## **12. Работа с внешними таблицами (Foreign Data Wrappers)**

Внешние таблицы позволяют работать с данными из других источников (например, CSV, другие базы данных).

---

### **12.1. Создание расширения для работы с внешними данными**
```sql
CREATE EXTENSION [IF NOT EXISTS] extension_name;
```

**Пример:**
```sql
CREATE EXTENSION IF NOT EXISTS file_fdw;
```

---

### **12.2. Создание сервера для внешних данных**
```sql
CREATE SERVER server_name FOREIGN DATA WRAPPER wrapper_name;
```

**Пример:**
```sql
CREATE SERVER csv_server FOREIGN DATA WRAPPER file_fdw;
```

---

### **12.3. Создание пользовательского отображения**
```sql
CREATE USER MAPPING FOR user_name
SERVER server_name
OPTIONS (option 'value');
```

**Пример:**
```sql
CREATE USER MAPPING FOR postgres
SERVER csv_server
OPTIONS (user 'postgres');
```

---

### **12.4. Создание внешней таблицы**
```sql
CREATE FOREIGN TABLE foreign_table_name (
    column1 data_type,
    column2 data_type,
    ...
) SERVER server_name
OPTIONS (option 'value');
```

**Пример:**
```sql
CREATE FOREIGN TABLE csv_employees (
    employee_id INTEGER,
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    email VARCHAR(100)
) SERVER csv_server
OPTIONS (filename '/path/to/employees.csv', format 'csv', header 'true');
```

---

### **12.5. Запрос к внешней таблице**
```sql
SELECT * FROM csv_employees;
```

---

### **12.6. Удаление внешней таблицы**
```sql
DROP FOREIGN TABLE [IF EXISTS] foreign_table_name;
```

**Пример:**
```sql
DROP FOREIGN TABLE IF EXISTS csv_employees;
```

---

## **13. Работа с полнотекстовым поиском**

PostgreSQL предоставляет мощные инструменты для полнотекстового поиска.

---

### **13.1. Создание столбца для полнотекстового поиска**
```sql
ALTER TABLE table_name ADD COLUMN search_vector TSVECTOR;
```

**Пример:**
```sql
ALTER TABLE articles ADD COLUMN search_vector TSVECTOR;
```

---

### **13.2. Обновление столбца для полнотекстового поиска**
```sql
UPDATE table_name SET search_vector = TO_TSVECTOR('language', column_name);
```

**Пример:**
```sql
UPDATE articles SET search_vector = TO_TSVECTOR('russian', title || ' ' || content);
```

---

### **13.3. Создание триггера для автоматического обновления**
```sql
CREATE TRIGGER trigger_name
BEFORE INSERT OR UPDATE ON table_name
FOR EACH ROW
EXECUTE FUNCTION tsvector_update_trigger(search_vector, 'pg_catalog.russian', title, content);
```

**Пример:**
```sql
CREATE TRIGGER trg_articles_search_vector
BEFORE INSERT OR UPDATE ON articles
FOR EACH ROW
EXECUTE FUNCTION tsvector_update_trigger(search_vector, 'pg_catalog.russian', title, content);
```

---

### **13.4. Создание индекса для полнотекстового поиска**
```sql
CREATE INDEX index_name ON table_name USING GIN (search_vector);
```

**Пример:**
```sql
CREATE INDEX idx_articles_search ON articles USING GIN (search_vector);
```

---

### **13.5. Поиск с использованием полнотекстового индекса**
```sql
SELECT * FROM table_name
WHERE search_vector @@ TO_TSQUERY('language', 'search_query');
```

**Пример:**
```sql
SELECT * FROM articles
WHERE search_vector @@ TO_TSQUERY('russian', 'PostgreSQL & индексы');
```

---

### **13.6. Поиск с ранжированием**
```sql
SELECT *, TS_RANK(search_vector, TO_TSQUERY('language', 'search_query')) AS rank
FROM table_name
WHERE search_vector @@ TO_TSQUERY('language', 'search_query')
ORDER BY rank DESC;
```

**Пример:**
```sql
SELECT *, TS_RANK(search_vector, TO_TSQUERY('russian', 'PostgreSQL & индексы')) AS rank
FROM articles
WHERE search_vector @@ TO_TSQUERY('russian', 'PostgreSQL & индексы')
ORDER BY rank DESC;
```

---

## **14. Работа с JSON и JSONB**

PostgreSQL поддерживает типы данных `JSON` и `JSONB` для работы с данными в формате JSON.

---

### **14.1. Создание таблицы с JSON/JSONB**
```sql
CREATE TABLE table_name (
    id SERIAL PRIMARY KEY,
    data JSONB
);
```

**Пример:**
```sql
CREATE TABLE user_profiles (
    id SERIAL PRIMARY KEY,
    profile_data JSONB
);
```

---

### **14.2. Вставка данных в JSON/JSONB**
```sql
INSERT INTO table_name (data) VALUES ('{"key": "value"}');
```

**Пример:**
```sql
INSERT INTO user_profiles (profile_data)
VALUES ('{"name": "Иван", "age": 30, "interests": ["программирование", "чтение"]}');
```

---

### **13.3. Запрос данных из JSON/JSONB**
```sql
SELECT data->>'key' FROM table_name;
SELECT data->'key' FROM table_name;
SELECT data#>>'{nested,key}' FROM table_name;
```

**Примеры:**
```sql
-- Получение значения по ключу
SELECT profile_data->>'name' FROM user_profiles;

-- Получение JSON-объекта по ключу
SELECT profile_data->'interests' FROM user_profiles;

-- Поиск по значению в JSON
SELECT * FROM user_profiles
WHERE profile_data @> '{"interests": ["программирование"]}';
```

---

### **14.4. Обновление данных в JSON/JSONB**
```sql
UPDATE table_name
SET data = jsonb_set(data, '{key}', '"new_value"')
WHERE condition;
```

**Пример:**
```sql
UPDATE user_profiles
SET profile_data = jsonb_set(profile_data, '{age}', '31')
WHERE profile_data->>'name' = 'Иван';
```

---

### **14.5. Создание индекса для JSON/JSONB**
```sql
CREATE INDEX index_name ON table_name USING GIN (data jsonb_path_ops);
```

**Пример:**
```sql
CREATE INDEX idx_user_profiles_interests ON user_profiles USING GIN (profile_data jsonb_path_ops);
```

---

## **15. Работа с временными таблицами**

Временные таблицы существуют только в течение сессии или транзакции.

---

### **15.1. Создание временной таблицы**
```sql
CREATE [GLOBAL | LOCAL] TEMPORARY TABLE table_name (
    column1 data_type,
    column2 data_type,
    ...
) [ON COMMIT {PRESERVE ROWS | DELETE ROWS | DROP}];
```

**Пример:**
```sql
CREATE TEMPORARY TABLE temp_employees (
    employee_id INTEGER,
    first_name VARCHAR(50),
    last_name VARCHAR(50)
) ON COMMIT DROP;
```

---

### **15.2. Использование временной таблицы**
```sql
INSERT INTO temp_employees VALUES (1, 'Иван', 'Иванов');
SELECT * FROM temp_employees;
```

---

### **15.3. Удаление временной таблицы**
Временные таблицы автоматически удаляются в конце сессии или транзакции (в зависимости от параметров).

---

## **16. Работа с транзакциями**

Транзакции позволяют группировать несколько операций в одну атомарную единицу.

---

### **16.1. Начало транзакции**
```sql
BEGIN;
-- или
START TRANSACTION;
```

---

### **16.2. Фиксация транзакции**
```sql
COMMIT;
```

---

### **16.3. Откат транзакции**
```sql
ROLLBACK;
```

---

### **16.4. Точки сохранения (Savepoints)**
```sql
SAVEPOINT savepoint_name;
-- ...
ROLLBACK TO SAVEPOINT savepoint_name;
```

**Пример:**
```sql
BEGIN;
    INSERT INTO employees (first_name, last_name) VALUES ('Иван', 'Иванов');
    SAVEPOINT before_update;
    UPDATE employees SET first_name = 'Петр' WHERE last_name = 'Иванов';
    -- Откат к точке сохранения
    ROLLBACK TO SAVEPOINT before_update;
COMMIT;
```

---

## **17. Работа с комментариями**

Комментарии помогают документировать объекты базы данных.

---

### **17.1. Добавление комментария к объекту**
```sql
COMMENT ON {TABLE | COLUMN | INDEX | ...} object_name IS 'comment_text';
```

**Примеры:**
```sql
COMMENT ON TABLE employees IS 'Таблица сотрудников компании';
COMMENT ON COLUMN employees.salary IS 'Зарплата сотрудника в рублях';
```

---

### **17.2. Просмотр комментариев**
```sql
SELECT obj_description('schema_name.table_name'::regclass);
-- или
SELECT col_description('schema_name.table_name'::regclass, column_number);
```

**Пример:**
```sql
SELECT obj_description('public.employees'::regclass);
```

---

## **18. Работа с доменными ограничениями**

Доменные ограничения позволяют создавать пользовательские типы данных с проверками.

---

### **18.1. Создание домена с ограничением**
```sql
CREATE DOMAIN domain_name AS data_type
[DEFAULT default_value]
[constraint [constraint_name] CHECK (condition)];
```

**Пример:**
```sql
CREATE DOMAIN positive_integer AS INTEGER
CHECK (VALUE > 0);
```

---

### **18.2. Использование домена**
```sql
CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    quantity positive_integer
);
```

---

## **19. Работа с типами данных**

PostgreSQL поддерживает множество встроенных типов данных.

---

### **19.1. Основные типы данных**



| Категория               | Типы данных                                                                                     |
|-------------------------|------------------------------------------------------------------------------------------------|
| **Числовые**           | `SMALLINT`, `INTEGER`, `BIGINT`, `DECIMAL(p,s)`, `NUMERIC(p,s)`, `REAL`, `DOUBLE PRECISION`, `SERIAL` |
| **Строковые**          | `CHAR(n)`, `VARCHAR(n)`, `TEXT`                                                                |
| **Бинарные**            | `BYTEA`                                                                                         |
| **Дата и время**        | `DATE`, `TIME`, `TIMESTAMP`, `INTERVAL`                                                       |
| **Логический**          | `BOOLEAN`                                                                                       |
| **Геометрические**     | `POINT`, `LINE`, `LSEG`, `BOX`, `PATH`, `POLYGON`, `CIRCLE`                                    |
| **Сетевые адреса**      | `INET`, `CIDR`, `MACADDR`                                                                      |
| **JSON**                | `JSON`, `JSONB`                                                                                |
| **XML**                 | `XML`                                                                                          |
| **Массивы**             | `type[]` (например, `INTEGER[]`, `TEXT[]`)                                                     |
| **UUID**                | `UUID`                                                                                         |
| **Специальные**         | `TSVECTOR`, `TSQUERY` (для полнотекстового поиска)                                            |

---

### **19.2. Примеры использования типов данных**

#### **Числовые типы**
```sql
CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    price DECIMAL(10, 2),
    quantity INTEGER
);
```

#### **Строковые типы**
```sql
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE,
    bio TEXT
);
```

#### **Дата и время**
```sql
CREATE TABLE events (
    event_id SERIAL PRIMARY KEY,
    event_name VARCHAR(100),
    start_time TIMESTAMP,
    duration INTERVAL
);
```

#### **JSON/JSONB**
```sql
CREATE TABLE user_profiles (
    user_id SERIAL PRIMARY KEY,
    profile_data JSONB
);
```

#### **Массивы**
```sql
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    product_ids INTEGER[],
    quantities INTEGER[]
);
```

---

## **20. Работа с ограничениями целостности**

Ограничения целостности обеспечивают корректность данных.

---

### **20.1. Первичный ключ (Primary Key)**
```sql
CREATE TABLE employees (
    employee_id SERIAL PRIMARY KEY,
    ...
);
```

---

### **20.2. Внешний ключ (Foreign Key)**
```sql
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    customer_id INTEGER REFERENCES customers(customer_id),
    ...
);
```

---

### **20.3. Уникальное ограничение (Unique)**
```sql
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    email VARCHAR(100) UNIQUE,
    ...
);
```

---

### **20.4. Проверка (Check)**
```sql
CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    price DECIMAL(10, 2) CHECK (price > 0),
    ...
);
```

---

### **20.5. Ограничение исключения (Exclusion)**
```sql
CREATE TABLE bookings (
    booking_id SERIAL PRIMARY KEY,
    room_id INTEGER,
    during TSRange,
    EXCLUDE USING gist (room_id WITH =, during WITH &&)
);
```

---

## **21. Работа с наследованием таблиц**

PostgreSQL поддерживает наследование таблиц.

---

### **21.1. Создание дочерней таблицы**
```sql
CREATE TABLE child_table (
    ...
) INHERITS (parent_table);
```

**Пример:**
```sql
CREATE TABLE employees (
    employee_id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    hire_date DATE
);

CREATE TABLE managers (
    department VARCHAR(50),
    bonus DECIMAL(10, 2)
) INHERITS (employees);
```

---

### **21.2. Запрос данных из иерархии таблиц**
```sql
SELECT * FROM parent_table;
```

---

## **22. Работа с разделами (Partitioning)**

Разделы позволяют разбивать большие таблицы на более мелкие части.

---

### **22.1. Создание разделённой таблицы**
```sql
CREATE TABLE table_name (
    ...
) PARTITION BY {RANGE | LIST | HASH} (column_name);
```

**Пример:**
```sql
CREATE TABLE sales (
    sale_id SERIAL,
    sale_date DATE NOT NULL,
    amount DECIMAL(10, 2)
) PARTITION BY RANGE (sale_date);
```

---

### **22.2. Создание разделов**
```sql
CREATE TABLE partition_name PARTITION OF table_name
FOR VALUES FROM (start_value) TO (end_value);
```

**Пример:**
```sql
CREATE TABLE sales_2023 PARTITION OF sales
FOR VALUES FROM ('2023-01-01') TO ('2024-01-01');

CREATE TABLE sales_2024 PARTITION OF sales
FOR VALUES FROM ('2024-01-01') TO ('2025-01-01');
```

---

### **22.3. Добавление раздела**
```sql
CREATE TABLE partition_name PARTITION OF table_name
FOR VALUES FROM (start_value) TO (end_value);
```

---

### **22.4. Удаление раздела**
```sql
DROP TABLE partition_name;
```

**Пример:**
```sql
DROP TABLE sales_2023;
```

---

## **23. Работа с материализованными представлениями**

Материализованные представления хранят результаты запроса и обновляются вручную или по расписанию.

---

### **23.1. Создание материализованного представления**
```sql
CREATE MATERIALIZED VIEW view_name AS
SELECT ...
[WITH [NO] DATA];
```

**Пример:**
```sql
CREATE MATERIALIZED VIEW monthly_sales AS
SELECT
    DATE_TRUNC('month', sale_date) AS month,
    SUM(amount) AS total_amount
FROM sales
GROUP BY DATE_TRUNC('month', sale_date);
```

---

### **23.2. Обновление материализованного представления**
```sql
REFRESH MATERIALIZED VIEW [CONCURRENTLY] view_name;
```

**Пример:**
```sql
REFRESH MATERIALIZED VIEW monthly_sales;
```

---

### **23.3. Удаление материализованного представления**
```sql
DROP MATERIALIZED VIEW [IF EXISTS] view_name;
```

**Пример:**
```sql
DROP MATERIALIZED VIEW IF EXISTS monthly_sales;
```

---

## **24. Работа с внешними данными (Foreign Data Wrappers)**

Внешние таблицы позволяют работать с данными из других источников.

---

### **24.1. Создание расширения для работы с внешними данными**
```sql
CREATE EXTENSION [IF NOT EXISTS] extension_name;
```

**Пример:**
```sql
CREATE EXTENSION IF NOT EXISTS file_fdw;
```

---

### **24.2. Создание сервера для внешних данных**
```sql
CREATE SERVER server_name FOREIGN DATA WRAPPER wrapper_name;
```

**Пример:**
```sql
CREATE SERVER csv_server FOREIGN DATA WRAPPER file_fdw;
```

---

### **24.3. Создание пользовательского отображения**
```sql
CREATE USER MAPPING FOR user_name
SERVER server_name
OPTIONS (option 'value');
```

**Пример:**
```sql
CREATE USER MAPPING FOR postgres
SERVER csv_server
OPTIONS (user 'postgres');
```

---

### **24.4. Создание внешней таблицы**
```sql
CREATE FOREIGN TABLE foreign_table_name (
    ...
) SERVER server_name
OPTIONS (option 'value');
```

**Пример:**
```sql
CREATE FOREIGN TABLE csv_employees (
    employee_id INTEGER,
    first_name VARCHAR(50),
    last_name VARCHAR(50)
) SERVER csv_server
OPTIONS (filename '/path/to/employees.csv', format 'csv', header 'true');
```

---

### **24.5. Запрос к внешней таблице**
```sql
SELECT * FROM csv_employees;
```

---

### **24.6. Удаление внешней таблицы**
```sql
DROP FOREIGN TABLE [IF EXISTS] foreign_table_name;
```

**Пример:**
```sql
DROP FOREIGN TABLE IF EXISTS csv_employees;
```

---

## **25. Работа с событиями (Event Triggers)**

Событийные триггеры позволяют выполнять действия при выполнении DDL-команд.

---

### **25.1. Создание функции для событийного триггера**
```sql
CREATE OR REPLACE FUNCTION event_trigger_function()
RETURNS event_trigger LANGUAGE plpgsql AS $$
BEGIN
    -- Логика триггера
END;
$$;
```

**Пример:**
```sql
CREATE OR REPLACE FUNCTION log_ddl_commands()
RETURNS event_trigger LANGUAGE plpgsql AS $$
BEGIN
    INSERT INTO ddl_audit (command_tag, object_type, object_identity)
    VALUES (tg_tag, pg_event_trigger_ddl_commands().object_type,
            pg_event_trigger_ddl_commands().object_identity);
END;
$$;
```

---

### **25.2. Создание событийного триггера**
```sql
CREATE EVENT TRIGGER trigger_name
ON ddl_command
EXECUTE FUNCTION event_trigger_function();
```

**Пример:**
```sql
CREATE EVENT TRIGGER trg_log_ddl
ON ddl_command_start
EXECUTE FUNCTION log_ddl_commands();
```

---

### **25.3. Удаление событийного триггера**
```sql
DROP EVENT TRIGGER [IF EXISTS] trigger_name;
```

**Пример:**
```sql
DROP EVENT TRIGGER IF EXISTS trg_log_ddl;
```

---

## **26. Работа с транзакциями и блокировками**

---

### **26.1. Начало транзакции**
```sql
BEGIN;
-- или
START TRANSACTION;
```

---

### **26.2. Фиксация транзакции**
```sql
COMMIT;
```

---

### **26.3. Откат транзакции**
```sql
ROLLBACK;
```

---

### **26.4. Точки сохранения (Savepoints)**
```sql
SAVEPOINT savepoint_name;
-- ...
ROLLBACK TO SAVEPOINT savepoint_name;
```

**Пример:**
```sql
BEGIN;
    INSERT INTO employees (first_name, last_name) VALUES ('Иван', 'Иванов');
    SAVEPOINT before_update;
    UPDATE employees SET first_name = 'Петр' WHERE last_name = 'Иванов';
    -- Откат к точке сохранения
    ROLLBACK TO SAVEPOINT before_update;
COMMIT;
```

---

### **26.5. Уровни изоляции транзакций**
```sql
SET TRANSACTION ISOLATION LEVEL {READ COMMITTED | REPEATABLE READ | SERIALIZABLE};
```

**Пример:**
```sql
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
BEGIN;
-- ...
COMMIT;
```

---

### **26.6. Блокировки**
```sql
-- Блокировка строки для обновления
SELECT * FROM table_name WHERE condition FOR UPDATE;

-- Блокировка строки для совместного доступа
SELECT * FROM table_name WHERE condition FOR SHARE;
```

**Пример:**
```sql
BEGIN;
SELECT * FROM accounts WHERE account_id = 1 FOR UPDATE;
-- ...
COMMIT;
```

---

## **27. Работа с комментариями**

Комментарии помогают документировать объекты базы данных.

---

### **27.1. Добавление комментария к объекту**
```sql
COMMENT ON {TABLE | COLUMN | INDEX | ...} object_name IS 'comment_text';
```

**Примеры:**
```sql
COMMENT ON TABLE employees IS 'Таблица сотрудников компании';
COMMENT ON COLUMN employees.salary IS 'Зарплата сотрудника в рублях';
```

---

### **27.2. Просмотр комментариев**
```sql
SELECT obj_description('schema_name.table_name'::regclass);
-- или
SELECT col_description('schema_name.table_name'::regclass, column_number);
```

**Пример:**
```sql
SELECT obj_description('public.employees'::regclass);
```

---

## **28. Работа с последовательностями (Sequences)**

Последовательности используются для генерации уникальных числовых значений.

---

### **28.1. Создание последовательности**
```sql
CREATE SEQUENCE sequence_name
[INCREMENT BY increment]
[MINVALUE minvalue | NO MINVALUE]
[MAXVALUE maxvalue | NO MAXVALUE]
[START WITH start]
[CACHE cache]
[CYCLE | NO CYCLE];
```

**Пример:**
```sql
CREATE SEQUENCE employee_id_seq
INCREMENT BY 1
MINVALUE 1
START WITH 1
CACHE 20;
```

---

### **28.2. Использование последовательности**
```sql
INSERT INTO table_name (id, ...) VALUES (NEXTVAL('sequence_name'), ...);
-- или
INSERT INTO table_name (id, ...) VALUES (DEFAULT, ...);
```

**Пример:**
```sql
INSERT INTO employees (employee_id, first_name, last_name)
VALUES (NEXTVAL('employee_id_seq'), 'Иван', 'Иванов');
```

---

### **28.3. Изменение последовательности**
```sql
ALTER SEQUENCE sequence_name
[INCREMENT BY increment]
[MINVALUE minvalue | NO MINVALUE]
[MAXVALUE maxvalue | NO MAXVALUE]
[START WITH start]
[RESTART [WITH start]]
[CACHE cache | NO CACHE]
[CYCLE | NO CYCLE];
```

**Пример:**
```sql
ALTER SEQUENCE employee_id_seq INCREMENT BY 2;
```

---

### **28.4. Удаление последовательности**
```sql
DROP SEQUENCE [IF EXISTS] sequence_name;
```

**Пример:**
```sql
DROP SEQUENCE IF EXISTS employee_id_seq;
```

---

## **29. Работа с триггерами**

Триггеры позволяют автоматически выполнять действия при изменении данных.

---

### **29.1. Создание триггерной функции**
```sql
CREATE OR REPLACE FUNCTION trigger_function()
RETURNS TRIGGER AS $$
BEGIN
    -- Логика триггера
    RETURN NEW; -- или RETURN OLD;
END;
$$ LANGUAGE plpgsql;
```

**Пример:**
```sql
CREATE OR REPLACE FUNCTION log_employee_change()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO employee_audit (employee_id, old_salary, new_salary, change_date)
    VALUES (OLD.employee_id, OLD.salary, NEW.salary, NOW());
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

---

### **29.2. Создание триггера**
```sql
CREATE TRIGGER trigger_name
[BEFORE | AFTER | INSTEAD OF] [INSERT | UPDATE | DELETE | TRUNCATE]
ON table_name
[FOR EACH ROW | FOR EACH STATEMENT]
EXECUTE FUNCTION trigger_function();
```

**Пример:**
```sql
CREATE TRIGGER trg_employee_update
AFTER UPDATE OF salary ON employees
FOR EACH ROW
EXECUTE FUNCTION log_employee_change();
```

---

### **29.3. Удаление триггера**
```sql
DROP TRIGGER [IF EXISTS] trigger_name ON table_name;
```

**Пример:**
```sql
DROP TRIGGER IF EXISTS trg_employee_update ON employees;
```

---

## **30. Работа с функциями и процедурами**

---

### **30.1. Создание функции**
```sql
CREATE [OR REPLACE] FUNCTION function_name (parameter1 type1, parameter2 type2, ...)
RETURNS return_type AS $$
DECLARE
    -- переменные
BEGIN
    -- тело функции
END;
$$ LANGUAGE plpgsql;
```

**Пример:**
```sql
CREATE OR REPLACE FUNCTION calculate_bonus(salary DECIMAL)
RETURNS DECIMAL AS $$
BEGIN
    RETURN salary * 0.1;
END;
$$ LANGUAGE plpgsql;
```

---

### **30.2. Вызов функции**
```sql
SELECT function_name(parameter1, parameter2, ...);
```

**Пример:**
```sql
SELECT calculate_bonus(100000);
```

---

### **30.3. Создание процедуры**
```sql
CREATE [OR REPLACE] PROCEDURE procedure_name (parameter1 type1, parameter2 type2, ...)
LANGUAGE plpgsql AS $$
BEGIN
    -- тело процедуры
END;
$$;
```

**Пример:**
```sql
CREATE OR REPLACE PROCEDURE update_employee_salary(employee_id INTEGER, new_salary DECIMAL)
LANGUAGE plpgsql AS $$
BEGIN
    UPDATE employees SET salary = new_salary WHERE employee_id = employee_id;
END;
$$;
```

---

### **30.4. Вызов процедуры**
```sql
CALL procedure_name(parameter1, parameter2, ...);
```

**Пример:**
```sql
CALL update_employee_salary(1, 120000);
```

---

### **30.5. Удаление функции или процедуры**
```sql
DROP FUNCTION [IF EXISTS] function_name (parameter1 type1, parameter2 type2, ...);
DROP PROCEDURE [IF EXISTS] procedure_name (parameter1 type1, parameter2 type2, ...);
```

**Пример:**
```sql
DROP FUNCTION IF EXISTS calculate_bonus(DECIMAL);
DROP PROCEDURE IF EXISTS update_employee_salary(INTEGER, DECIMAL);
```

---

## **31. Работа с представлениями (Views)**

Представления позволяют создавать виртуальные таблицы на основе запросов.

---

### **31.1. Создание представления**
```sql
CREATE [OR REPLACE] VIEW view_name AS
SELECT column1, column2, ...
FROM table_name
[WHERE condition];
```

**Пример:**
```sql
CREATE VIEW high_salary_employees AS
SELECT first_name, last_name, salary
FROM employees
WHERE salary > 100000;
```

---

### **31.2. Запрос к представлению**
```sql
SELECT * FROM view_name;
```

**Пример:**
```sql
SELECT * FROM high_salary_employees;
```

---

### **31.3. Удаление представления**
```sql
DROP VIEW [IF EXISTS] view_name;
```

**Пример:**
```sql
DROP VIEW IF EXISTS high_salary_employees;
```

---

## **32. Работа с временными таблицами**

Временные таблицы существуют только в течение сессии или транзакции.

---

### **32.1. Создание временной таблицы**
```sql
CREATE [GLOBAL | LOCAL] TEMPORARY TABLE table_name (
    column1 data_type,
    column2 data_type,
    ...
) [ON COMMIT {PRESERVE ROWS | DELETE ROWS | DROP}];
```

**Пример:**
```sql
CREATE TEMPORARY TABLE temp_employees (
    employee_id INTEGER,
    first_name VARCHAR(50),
    last_name VARCHAR(50)
) ON COMMIT DROP;
```

---

### **32.2. Использование временной таблицы**
```sql
INSERT INTO temp_employees VALUES (1, 'Иван', 'Иванов');
SELECT * FROM temp_employees;
```

---

## **33. Работа с ролями и правами доступа**

---

### **33.1. Создание роли**
```sql
CREATE ROLE role_name [WITH option_list];
```

**Пример:**
```sql
CREATE ROLE app_user WITH LOGIN PASSWORD 'secure_password' CONNECTION LIMIT 10;
```

---

### **33.2. Изменение роли**
```sql
ALTER ROLE role_name [WITH option_list];
```

**Пример:**
```sql
ALTER ROLE app_user WITH PASSWORD 'new_secure_password';
```

---

### **33.3. Удаление роли**
```sql
DROP ROLE [IF EXISTS] role_name;
```

**Пример:**
```sql
DROP ROLE IF EXISTS app_user;
```

---

### **33.4. Предоставление прав доступа**
```sql
GRANT privilege [, ...]
ON object_type object_name [, ...]
TO role_name [, ...]
[WITH GRANT OPTION];
```

**Примеры:**
```sql
GRANT SELECT ON employees TO app_user;
GRANT ALL PRIVILEGES ON employees TO app_user;
GRANT USAGE ON SCHEMA hr TO app_user;
GRANT CREATE ON SCHEMA hr TO app_user;
```

---

### **33.5. Отзыв прав доступа**
```sql
REVOKE [GRANT OPTION FOR] privilege [, ...]
ON object_type object_name [, ...]
FROM role_name [, ...]
[CASCADE | RESTRICT];
```

**Пример:**
```sql
REVOKE SELECT ON employees FROM app_user;
```

---

## **34. Работа с табличными пространствами (Tablespaces)**

Табличные пространства позволяют управлять физическим размещением данных.

---

### **34.1. Создание табличного пространства**
```sql
CREATE TABLESPACE tablespace_name
[OWNER user_name]
LOCATION '/path/to/directory';
```

**Пример:**
```sql
CREATE TABLESPACE my_tablespace
OWNER postgres
LOCATION '/var/lib/postgresql/data/my_tablespace';
```

---

### **34.2. Изменение табличного пространства**
```sql
ALTER TABLESPACE tablespace_name
[RENAME TO new_tablespace_name]
[OWNER TO new_owner];
```

**Пример:**
```sql
ALTER TABLESPACE my_tablespace RENAME TO new_tablespace;
```

---

### **34.3. Удаление табличного пространства**
```sql
DROP TABLESPACE [IF EXISTS] tablespace_name;
```

**Пример:**
```sql
DROP TABLESPACE IF EXISTS new_tablespace;
```

---

### **34.4. Использование табличного пространства**
```sql
CREATE TABLE table_name (
    ...
) TABLESPACE tablespace_name;

CREATE INDEX index_name ON table_name (column_name)
TABLESPACE tablespace_name;
```

**Пример:**
```sql
CREATE TABLE employees (
    employee_id SERIAL PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL
) TABLESPACE new_tablespace;
```

---

## **35. Работа с доменами (Domains)**

Домены позволяют создавать пользовательские типы данных с ограничениями.

---

### **35.1. Создание домена**
```sql
CREATE DOMAIN domain_name AS data_type
[DEFAULT default_value]
[constraint [constraint_name] CHECK (condition)];
```

**Пример:**
```sql
CREATE DOMAIN positive_numeric AS NUMERIC
CHECK (VALUE > 0);
```

---

### **35.2. Использование домена**
```sql
CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    price positive_numeric
);
```

---

### **35.3. Изменение домена**
```sql
ALTER DOMAIN domain_name
[ADD CONSTRAINT constraint_name constraint_definition]
[DROP CONSTRAINT constraint_name];
```

**Пример:**
```sql
ALTER DOMAIN positive_numeric
ADD CONSTRAINT positive_check CHECK (VALUE > 0);
```

---

### **35.4. Удаление домена**
```sql
DROP DOMAIN [IF EXISTS] domain_name;
```

**Пример:**
```sql
DROP DOMAIN IF EXISTS positive_numeric;
```

---

## **36. Работа с пользовательскими типами данных**

PostgreSQL позволяет создавать пользовательские типы данных.

---

### **36.1. Создание пользовательского типа**
```sql
CREATE TYPE type_name AS (
    attribute1 data_type,
    attribute2 data_type,
    ...
);
```

**Пример:**
```sql
CREATE TYPE address AS (
    street VARCHAR(100),
    city VARCHAR(50),
    postal_code VARCHAR(20)
);
```

---

### **36.2. Использование пользовательского типа**
```sql
CREATE TABLE customers (
    customer_id SERIAL PRIMARY KEY,
    customer_name VARCHAR(100),
    customer_address address
);
```

---

### **36.3. Изменение пользовательского типа**
```sql
ALTER TYPE type_name
[RENAME TO new_type_name]
[RENAME ATTRIBUTE attribute_name TO new_attribute_name]
[ADD ATTRIBUTE attribute_name data_type]
[DROP ATTRIBUTE [IF EXISTS] attribute_name [CASCADE | RESTRICT]];
```

**Пример:**
```sql
ALTER TYPE address
ADD ATTRIBUTE country VARCHAR(50);
```

---

### **36.4. Удаление пользовательского типа**
```sql
DROP TYPE [IF EXISTS] type_name;
```

**Пример:**
```sql
DROP TYPE IF EXISTS address;
```

---

## **37. Работа с расширениями (Extensions)**

Расширения позволяют добавлять новые функции и типы данных в PostgreSQL.

---

### **37.1. Создание расширения**
```sql
CREATE EXTENSION [IF NOT EXISTS] extension_name [WITH] [SCHEMA schema_name];
```

**Пример:**
```sql
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
```

---

### **37.2. Удаление расширения**
```sql
DROP EXTENSION [IF EXISTS] extension_name;
```

**Пример:**
```sql
DROP EXTENSION IF EXISTS "uuid-ossp";
```

---

## **38. Работа с JSON и JSONB**

PostgreSQL поддерживает типы данных `JSON` и `JSONB` для работы с данными в формате JSON.

---

### **38.1. Создание таблицы с JSON/JSONB**
```sql
CREATE TABLE table_name (
    id SERIAL PRIMARY KEY,
    data JSONB
);
```

**Пример:**
```sql
CREATE TABLE user_profiles (
    user_id SERIAL PRIMARY KEY,
    profile_data JSONB
);
```

---

### **38.2. Вставка данных в JSON/JSONB**
```sql
INSERT INTO table_name (data) VALUES ('{"key": "value"}');
```

**Пример:**
```sql
INSERT INTO user_profiles (profile_data)
VALUES ('{"name": "Иван", "age": 30, "interests": ["программирование", "чтение"]}');
```

---

### **38.3. Запрос данных из JSON/JSONB**
```sql
SELECT data->>'key' FROM table_name;
SELECT data->'key' FROM table_name;
SELECT data#>>'{nested,key}' FROM table_name;
```

**Примеры:**
```sql
-- Получение значения по ключу
SELECT profile_data->>'name' FROM user_profiles;

-- Получение JSON-объекта по ключу
SELECT profile_data->'interests' FROM user_profiles;

-- Поиск по значению в JSON
SELECT * FROM user_profiles
WHERE profile_data @> '{"interests": ["программирование"]}';
```

---

### **38.4. Обновление данных в JSON/JSONB**
```sql
UPDATE table_name
SET data = jsonb_set(data, '{key}', '"new_value"')
WHERE condition;
```

**Пример:**
```sql
UPDATE user_profiles
SET profile_data = jsonb_set(profile_data, '{age}', '31')
WHERE profile_data->>'name' = 'Иван';
```

---

### **38.5. Создание индекса для JSON/JSONB**
```sql
CREATE INDEX index_name ON table_name USING GIN (data jsonb_path_ops);
```

**Пример:**
```sql
CREATE INDEX idx_user_profiles_interests ON user_profiles USING GIN (profile_data jsonb_path_ops);
```

---

## **39. Работа с массивами**

PostgreSQL поддерживает массивы для хранения списков значений.

---

### **39.1. Создание таблицы с массивами**
```sql
CREATE TABLE table_name (
    id SERIAL PRIMARY KEY,
    array_column data_type[]
);
```

**Пример:**
```sql
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    product_ids INTEGER[],
    quantities INTEGER[]
);
```

---

### **39.2. Вставка данных в массив**
```sql
INSERT INTO table_name (array_column) VALUES (ARRAY[value1, value2, ...]);
```

**Пример:**
```sql
INSERT INTO orders (product_ids, quantities)
VALUES (ARRAY[1, 2, 3], ARRAY[2, 1, 3]);
```

---

### **39.3. Запрос данных из массива**
```sql
SELECT array_column[1] FROM table_name;
SELECT unnest(array_column) FROM table_name;
```

**Примеры:**
```sql
-- Получение первого элемента массива
SELECT product_ids[1] FROM orders;

-- Разворачивание массива в строки
SELECT unnest(product_ids) FROM orders;
```

---

### **39.4. Обновление данных в массиве**
```sql
UPDATE table_name
SET array_column[1] = new_value
WHERE condition;
```

**Пример:**
```sql
UPDATE orders
SET quantities[1] = 5
WHERE order_id = 1;
```

---

### **39.5. Создание индекса для массива**
```sql
CREATE INDEX index_name ON table_name USING GIN (array_column);
```

**Пример:**
```sql
CREATE INDEX idx_orders_product_ids ON orders USING GIN (product_ids);
```

---

## **40. Работа с геометрическими типами данных**

PostgreSQL поддерживает геометрические типы данных для работы с пространственными данными.

---

### **40.1. Установка расширения PostGIS**
```sql
CREATE EXTENSION postgis;
```

---

### **40.2. Создание таблицы с геометрическими данными**
```sql
CREATE TABLE locations (
    location_id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    geom GEOMETRY(Point, 4326)
);
```

---

### **40.3. Вставка геометрических данных**
```sql
INSERT INTO locations (name, geom)
VALUES ('Москва', ST_GeomFromText('POINT(37.6176 55.7558)', 4326));
```

---

### **40.4. Запрос геометрических данных**
```sql
SELECT ST_AsText(geom) FROM locations;
SELECT ST_Distance(geom1, geom2) FROM locations;
```

**Пример:**
```sql
-- Поиск объектов в радиусе 10 км от Москвы
SELECT name FROM locations
WHERE ST_DWithin(
    geom,
    ST_GeomFromText('POINT(37.6176 55.7558)', 4326),
    10000
);
```

---

### **40.5. Создание пространственного индекса**
```sql
CREATE INDEX index_name ON table_name USING GIST (geom);
```

**Пример:**
```sql
CREATE INDEX idx_locations_geom ON locations USING GIST (geom);
```

---

## **41. Работа с временными зонами**

PostgreSQL поддерживает работу с временными зонами.

---

### **41.1. Установка временной зоны**
```sql
SET TIME ZONE 'timezone';
```

**Пример:**
```sql
SET TIME ZONE 'Europe/Moscow';
```

---

### **41.2. Работа с временными метками**
```sql
SELECT NOW(); -- Текущая временная метка
SELECT NOW() AT TIME ZONE 'UTC'; -- Преобразование в UTC
```

**Пример:**
```sql
SELECT
    NOW() AS local_time,
    NOW() AT TIME ZONE 'UTC' AS utc_time;
```

---

## **42. Работа с транзакциями и блокировками**

---

### **42.1. Начало транзакции**
```sql
BEGIN;
-- или
START TRANSACTION;
```

---

### **42.2. Фиксация транзакции**
```sql
COMMIT;
```

---

### **42.3. Откат транзакции**
```sql
ROLLBACK;
```

---

### **42.4. Точки сохранения (Savepoints)**
```sql
SAVEPOINT savepoint_name;
-- ...
ROLLBACK TO SAVEPOINT savepoint_name;
```

**Пример:**
```sql
BEGIN;
    INSERT INTO employees (first_name, last_name) VALUES ('Иван', 'Иванов');
    SAVEPOINT before_update;
    UPDATE employees SET first_name = 'Петр' WHERE last_name = 'Иванов';
    -- Откат к точке сохранения
    ROLLBACK TO SAVEPOINT before_update;
COMMIT;
```

---

### **42.5. Уровни изоляции транзакций**
```sql
SET TRANSACTION ISOLATION LEVEL {READ COMMITTED | REPEATABLE READ | SERIALIZABLE};
```

**Пример:**
```sql
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
BEGIN;
-- ...
COMMIT;
```

---

### **42.6. Блокировки**
```sql
-- Блокировка строки для обновления
SELECT * FROM table_name WHERE condition FOR UPDATE;

-- Блокировка строки для совместного доступа
SELECT * FROM table_name WHERE condition FOR SHARE;
```

**Пример:**
```sql
BEGIN;
SELECT * FROM accounts WHERE account_id = 1 FOR UPDATE;
-- ...
COMMIT;
```

---

## **43. Работа с репликацией**

PostgreSQL поддерживает различные виды репликации для обеспечения отказоустойчивости.

---

### **43.1. Настройка потоковой репликации (Streaming Replication)**

1. **Настройка основного сервера (`postgresql.conf`)**:
   ```ini
   wal_level = replica
   max_wal_senders = 3
   wal_keep_segments = 8
   ```

2. **Настройка аутентификации (`pg_hba.conf`)**:
   ```ini
   host    replication     replica_user     192.168.1.0/24    md5
   ```

3. **Создание пользователя для репликации**:
   ```sql
   CREATE ROLE replica_user WITH REPLICATION LOGIN PASSWORD 'replica_password';
   ```

4. **Настройка резервного сервера (`recovery.conf`)**:
   ```ini
   standby_mode = 'on'
   primary_conninfo = 'host=primary_server port=5432 user=replica_user password=replica_password'
   trigger_file = '/tmp/postgresql.trigger'
   ```

---

### **43.2. Настройка логической репликации (Logical Replication)**

1. **Настройка основного сервера (`postgresql.conf`)**:
   ```ini
   wal_level = logical
   ```

2. **Создание публикации**:
   ```sql
   CREATE PUBLICATION my_publication FOR TABLE table1, table2;
   ```

3. **Настройка резервного сервера**:
   ```sql
   CREATE SUBSCRIPTION my_subscription
   CONNECTION 'host=primary_server port=5432 dbname=db_name user=replica_user password=replica_password'
   PUBLICATION my_publication;
   ```

---

## **44. Работа с резервным копированием и восстановлением**

---

### **44.1. Создание резервной копии с помощью `pg_dump`**
```bash
pg_dump -U username -d dbname -f backup.sql
```

**Пример:**
```bash
pg_dump -U postgres -d my_database -f my_database_backup.sql
```

---

### **44.2. Восстановление из резервной копии с помощью `psql`**
```bash
psql -U username -d dbname -f backup.sql
```

**Пример:**
```bash
psql -U postgres -d my_database -f my_database_backup.sql
```

---

### **44.3. Создание бинарной резервной копии с помощью `pg_basebackup`**
```bash
pg_basebackup -D /path/to/backup -U replica_user -P -v -Ft -z -Xs
```

---

### **44.4. Восстановление из бинарной резервной копии**
1. Остановите PostgreSQL.
2. Скопируйте данные из резервной копии в каталог данных PostgreSQL.
3. Запустите PostgreSQL.

---

## **45. Работа с мониторингом и производительностью**

---

### **45.1. Просмотр активных соединений**
```sql
SELECT * FROM pg_stat_activity;
```

---

### **45.2. Просмотр статистики таблиц**
```sql
SELECT * FROM pg_stat_user_tables;
```

---

### **45.3. Просмотр статистики индексов**
```sql
SELECT * FROM pg_stat_user_indexes;
```

---

### **45.4. Анализ производительности запросов**
```sql
EXPLAIN ANALYZE SELECT * FROM table_name WHERE condition;
```

---

### **45.5. Просмотр блокировок**
```sql
SELECT * FROM pg_locks;
```

---

### **45.6. Просмотр настроек PostgreSQL**
```sql
SHOW parameter_name;
```

**Пример:**
```sql
SHOW shared_buffers;
SHOW work_mem;
```

---

### **45.7. Изменение настроек PostgreSQL**
```sql
ALTER SYSTEM SET parameter_name = value;
```

**Пример:**
```sql
ALTER SYSTEM SET shared_buffers = '4GB';
ALTER SYSTEM SET work_mem = '16MB';
```

---

## **46. Работа с расширением `pg_partman` для управления разделами**

`pg_partman` — это расширение для автоматического управления разделами.

---

### **46.1. Установка расширения**
```sql
CREATE EXTENSION pg_partman;
```

---

### **46.2. Создание разделённой таблицы**
```sql
CREATE TABLE table_name (
    ...
) PARTITION BY RANGE (column_name);

SELECT create_parent('schema_name.table_name', 'column_name', 'prefix', 'interval');
```

**Пример:**
```sql
CREATE TABLE sales (
    sale_id SERIAL,
    sale_date DATE NOT NULL,
    amount DECIMAL(10, 2)
) PARTITION BY RANGE (sale_date);

SELECT create_parent('public.sales', 'sale_date', 'sales_', 'monthly');
```

---

### **46.3. Добавление нового раздела**
```sql
SELECT create_time_partition('interval', 'timestamp');
```

**Пример:**
```sql
SELECT create_time_partition('2023-01-01', '2023-02-01');
```

---

### **46.4. Удаление старого раздела**
```sql
SELECT drop_partition_time('timestamp');
```

**Пример:**
```sql
SELECT drop_partition_time('2022-01-01');
```

---

### **46.5. Настройка автоматического управления разделами**
```sql
SELECT run_maintenance();
```

---

## **47. Работа с расширением `pg_stat_statements` для анализа запросов**

`pg_stat_statements` позволяет собирать статистику по выполняемым запросам.

---

### **47.1. Установка расширения**
```sql
CREATE EXTENSION pg_stat_statements;
```

---

### **47.2. Просмотр статистики запросов**
```sql
SELECT * FROM pg_stat_statements;
```

**Пример:**
```sql
SELECT query, calls, total_time, mean_time
FROM pg_stat_statements
ORDER BY total_time DESC
LIMIT 10;
```

---

### **47.3. Сброс статистики**
```sql
SELECT pg_stat_statements_reset();
```

---

## **48. Работа с расширением `pg_repack` для дефрагментации таблиц**

`pg_repack` позволяет дефрагментировать таблицы и индексы без блокировки.

---

### **48.1. Установка расширения**
```bash
sudo apt-get install postgresql-14-repack
```

---

### **48.2. Дефрагментация таблицы**
```bash
pg_repack -d dbname -t table_name
```

**Пример:**
```bash
pg_repack -d my_database -t employees
```

---

### **48.3. Дефрагментация всех таблиц в базе данных**
```bash
pg_repack -d dbname
```

---

## **49. Работа с расширением `pgAudit` для аудита**

`pgAudit` позволяет вести журнал аудита для отслеживания изменений в базе данных.

---

### **49.1. Установка расширения**
```sql
CREATE EXTENSION pgaudit;
```

---

### **49.2. Настройка аудита в `postgresql.conf`**
```ini
pgaudit.log = 'all'
pgaudit.log_catalog = on
```

---

### **49.3. Просмотр журнала аудита**
```sql
SELECT * FROM pgaudit.log;
```

---

## **50. Работа с расширением `PostGIS` для геопространственных данных**

`PostGIS` добавляет поддержку геопространственных данных.

---

### **50.1. Установка расширения**
```sql
CREATE EXTENSION postgis;
```

---

### **50.2. Создание таблицы с геометрическими данными**
```sql
CREATE TABLE locations (
    location_id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    geom GEOMETRY(Point, 4326)
);
```

---

### **50.3. Вставка геометрических данных**
```sql
INSERT INTO locations (name, geom)
VALUES ('Москва', ST_GeomFromText('POINT(37.6176 55.7558)', 4326));
```

---

### **50.4. Запрос геометрических данных**
```sql
SELECT ST_AsText(geom) FROM locations;
SELECT ST_Distance(geom1, geom2) FROM locations;
```

**Пример:**
```sql
-- Поиск объектов в радиусе 10 км от Москвы
SELECT name FROM locations
WHERE ST_DWithin(
    geom,
    ST_GeomFromText('POINT(37.6176 55.7558)', 4326),
    10000
);
```

---

### **50.5. Создание пространственного индекса**
```sql
CREATE INDEX index_name ON table_name USING GIST (geom);
```

**Пример:**
```sql
CREATE INDEX idx_locations_geom ON locations USING GIST (geom);
```

---

## **51. Работа с расширением `pg_cron` для планирования задач**

`pg_cron` позволяет запускать SQL-запросы по расписанию.

---

### **51.1. Установка расширения**
```sql
CREATE EXTENSION pg_cron;
```

---

### **51.2. Добавление задачи в расписание**
```sql
SELECT cron.schedule('job_name', 'schedule', 'SQL_command');
```

**Пример:**
```sql
SELECT cron.schedule('nightly-vacuum', '0 3 * * *', 'VACUUM ANALYZE');
```

---

### **51.3. Просмотр запланированных задач**
```sql
SELECT * FROM cron.job;
```

---

### **51.4. Удаление задачи из расписания**
```sql
SELECT cron.unschedule(job_name);
```

**Пример:**
```sql
SELECT cron.unschedule('nightly-vacuum');
```

---

## **52. Работа с расширением `uuid-ossp` для генерации UUID**

`uuid-ossp` предоставляет функции для генерации UUID.

---

### **52.1. Установка расширения**
```sql
CREATE EXTENSION "uuid-ossp";
```

---

### **52.2. Генерация UUID**
```sql
SELECT uuid_generate_v4();
```

**Пример:**
```sql
INSERT INTO users (user_id, name)
VALUES (uuid_generate_v4(), 'Иван');
```

---

## **53. Работа с расширением `hstore` для хранения пар "ключ-значение"**

`hstore` позволяет хранить пары "ключ-значение" в одном поле.

---

### **53.1. Установка расширения**
```sql
CREATE EXTENSION hstore;
```

---

### **53.2. Создание таблицы с полем `hstore`**
```sql
CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    attributes HSTORE
);
```

---

### **53.3. Вставка данных в `hstore`**
```sql
INSERT INTO products (attributes)
VALUES ('color => "red", size => "large"');
```

---

### **53.4. Запрос данных из `hstore`**
```sql
SELECT attributes->'color' FROM products;
SELECT * FROM products WHERE attributes->'color' = 'red';
```

---

### **53.5. Обновление данных в `hstore`**
```sql
UPDATE products
SET attributes = attributes || 'weight => "1kg"'
WHERE product_id = 1;
```

---

### **53.6. Создание индекса для `hstore`**
```sql
CREATE INDEX index_name ON table_name USING GIN (hstore_column);
```

**Пример:**
```sql
CREATE INDEX idx_products_attributes ON products USING GIN (attributes);
```

---

## **54. Работа с расширением `citext` для регистронезависимого сравнения строк**

`citext` позволяет сравнивать строки без учёта регистра.

---

### **54.1. Установка расширения**
```sql
CREATE EXTENSION citext;
```

---

### **54.2. Создание таблицы с полем `citext`**
```sql
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    email CITEXT UNIQUE
);
```

---

### **54.3. Вставка данных в `citext`**
```sql
INSERT INTO users (email) VALUES ('User@example.com');
```

---

### **54.4. Запрос данных из `citext`**
```sql
SELECT * FROM users WHERE email = 'user@example.com';
```

---

### **54.5. Создание индекса для `citext`**
```sql
CREATE INDEX index_name ON table_name (citext_column);
```

**Пример:**
```sql
CREATE INDEX idx_users_email ON users (email);
```

---

## **55. Работа с расширением `pg_trgm` для нечёткого поиска**

`pg_trgm` позволяет выполнять нечёткий поиск и сравнение строк на основе триграмм.

---

### **55.1. Установка расширения**
```sql
CREATE EXTENSION pg_trgm;
```

---

### **55.2. Создание индекса для нечёткого поиска**
```sql
CREATE INDEX index_name ON table_name USING GIN (column_name gin_trgm_ops);
```

**Пример:**
```sql
CREATE INDEX idx_products_name_trgm ON products USING GIN (name gin_trgm_ops);
```

---

### **55.3. Поиск похожих строк**
```sql
SELECT * FROM table_name
WHERE column_name % 'search_string';
```

**Пример:**
```sql
SELECT * FROM products
WHERE name % 'ноутбук';
```

---

### **55.4. Оценка схожести строк**
```sql
SELECT similarity(column_name, 'search_string') FROM table_name;
```

**Пример:**
```sql
SELECT name, similarity(name, 'ноутбук') AS similarity
FROM products
ORDER BY similarity DESC;
```

---

## **56. Работа с расширением `tablefunc` для работы с таблицами**

`tablefunc` предоставляет функции для работы с таблицами.

---

### **56.1. Установка расширения**
```sql
CREATE EXTENSION tablefunc;
```

---

### **56.2. Использование функции `crosstab`**
```sql
SELECT * FROM crosstab(
    'SQL_query',
    'SQL_query_for_categories'
) AS ct (row_name type, category1 type, category2 type, ...);
```

**Пример:**
```sql
SELECT * FROM crosstab(
    'SELECT department_id, job_title, COUNT(*)
     FROM employees
     GROUP BY 1, 2
     ORDER BY 1, 2',
    'SELECT DISTINCT job_title FROM employees ORDER BY 1'
) AS ct (department_id INTEGER, "Manager" INTEGER, "Developer" INTEGER, "Analyst" INTEGER);
```

---

## **57. Работа с расширением `pg_buffercache` для анализа кэша**

`pg_buffercache` позволяет анализировать содержимое кэша PostgreSQL.

---

### **57.1. Установка расширения**
```sql
CREATE EXTENSION pg_buffercache;
```

---

### **57.2. Просмотр содержимого кэша**
```sql
SELECT * FROM pg_buffercache;
```

**Пример:**
```sql
SELECT c.relname, count(*) AS buffers
FROM pg_class c
JOIN pg_buffercache b ON b.relfilenode = c.relfilenode
GROUP BY c.relname
ORDER BY buffers DESC;
```

---

## **58. Работа с расширением `pg_prewarm` для предварительной загрузки данных в кэш**

`pg_prewarm` позволяет загружать данные в кэш заранее.

---

### **58.1. Установка расширения**
```sql
CREATE EXTENSION pg_prewarm;
```

---

### **58.2. Предварительная загрузка таблицы в кэш**
```sql
SELECT pg_prewarm('schema_name.table_name');
```

**Пример:**
```sql
SELECT pg_prewarm('public.employees');
```

---

## **59. Работа с расширением `pg_visibility` для анализа видимости строк**

`pg_visibility` позволяет анализировать видимость строк в таблицах.

---

### **59.1. Установка расширения**
```sql
CREATE EXTENSION pg_visibility;
```

---

### **59.2. Просмотр статистики видимости строк**
```sql
SELECT * FROM pg_visibility('schema_name.table_name');
```

**Пример:**
```sql
SELECT * FROM pg_visibility('public.employees');
```

---

## **60. Работа с расширением `pg_freespacemap` для анализа свободного пространства**

`pg_freespacemap` позволяет анализировать свободное пространство в таблицах.

---

### **60.1. Установка расширения**
```sql
CREATE EXTENSION pg_freespacemap;
```

---

### **60.2. Просмотр информации о свободном пространстве**
```sql
SELECT * FROM pg_freespace('schema_name.table_name');
```

**Пример:**
```sql
SELECT * FROM pg_freespace('public.employees');
```

---

## **61. Работа с расширением `pgrowlocks` для анализа блокировок строк**

`pgrowlocks` позволяет анализировать блокировки на уровне строк.

---

### **61.1. Установка расширения**
```sql
CREATE EXTENSION pgrowlocks;
```

---

### **61.2. Просмотр блокировок строк**
```sql
SELECT * FROM pgrowlocks('schema_name.table_name');
```

**Пример:**
```sql
SELECT * FROM pgrowlocks('public.employees');
```

---

## **62. Работа с расширением `pg_stat_kcache` для анализа использования кэша ядра**

`pg_stat_kcache` позволяет анализировать использование кэша ядра.

---

### **62.1. Установка расширения**
```sql
CREATE EXTENSION pg_stat_kcache;
```

---

### **62.2. Просмотр статистики использования кэша**
```sql
SELECT * FROM pg_stat_kcache;
```

---

## **63. Работа с расширением `pg_wait_sampling` для анализа ожиданий**

`pg_wait_sampling` позволяет анализировать, на чем тратится время ожидания в PostgreSQL.

---

### **63.1. Установка расширения**
```sql
CREATE EXTENSION pg_wait_sampling;
```

---

### **63.2. Запуск сбора статистики ожиданий**
```sql
SELECT pg_wait_sampling_start();
```

---

### **63.3. Просмотр статистики ожиданий**
```sql
SELECT * FROM pg_wait_sampling_get_samples();
```

---

### **63.4. Остановка сбора статистики ожиданий**
```sql
SELECT pg_wait_sampling_stop();
```

---

## **64. Работа с расширением `hypopg` для гипотетических индексов**

`hypopg` позволяет создавать гипотетические индексы для оценки их эффективности без реального создания.

---

### **64.1. Установка расширения**
```sql
CREATE EXTENSION hypopg;
```

---

### **64.2. Создание гипотетического индекса**
```sql
SELECT * FROM hypopg_create_index('CREATE INDEX ON table_name (column_name)');
```

**Пример:**
```sql
SELECT * FROM hypopg_create_index('CREATE INDEX ON employees (last_name)');
```

---

### **64.3. Проверка использования гипотетического индекса**
```sql
EXPLAIN SELECT * FROM table_name WHERE condition;
```

---

### **64.4. Удаление гипотетического индекса**
```sql
SELECT * FROM hypopg_drop_index(index_oid);
```

---

## **65. Работа с расширением `pgqualstats` для анализа условий в запросах**

`pgqualstats` собирает статистику по условиям в запросах.

---

### **65.1. Установка расширения**
```sql
CREATE EXTENSION pgqualstats;
```

---

### **65.2. Просмотр статистики условий**
```sql
SELECT * FROM pgqualstats.pg_qualstats;
```

---

## **66. Работа с расширением `pg_track_settings` для отслеживания изменений настроек**

`pg_track_settings` позволяет отслеживать изменения настроек PostgreSQL.

---

### **66.1. Установка расширения**
```sql
CREATE EXTENSION pg_track_settings;
```

---

### **66.2. Просмотр истории изменений настроек**
```sql
SELECT * FROM pg_track_settings_history;
```

---

## **67. Работа с расширением `wal2json` для логической репликации**

`wal2json` позволяет преобразовывать WAL (Write-Ahead Log) в формат JSON для логической репликации.

---

### **67.1. Установка расширения**
```sql
CREATE EXTENSION wal2json;
```

---

### **67.2. Настройка логической репликации с использованием `wal2json`**
```ini
# В postgresql.conf
wal_level = logical
```

---

## **68. Работа с расширением `pg_jieba` для китайской сегментации текста**

`pg_jieba` предоставляет функции для сегментации китайского текста.

---

### **68.1. Установка расширения**
```sql
CREATE EXTENSION pg_jieba;
```

---

### **68.2. Сегментация китайского текста**
```sql
SELECT jieba_segment('中文文本');
```

---

## **69. Работа с расширением `pg_similarity` для сравнения строк**

`pg_similarity` предоставляет функции для сравнения строк на основе различных алгоритмов.

---

### **69.1. Установка расширения**
```sql
CREATE EXTENSION pg_similarity;
```

---

### **69.2. Сравнение строк**
```sql
SELECT similarity('string1', 'string2');
SELECT levenshtein('string1', 'string2');
```

**Пример:**
```sql
SELECT similarity('PostgreSQL', 'Postgres');
```

---

## **70. Работа с расширением `pgTAP` для тестирования**

`pgTAP` позволяет писать тесты для PostgreSQL на языке TAP.

---

### **70.1. Установка расширения**
```sql
CREATE EXTENSION pgtap;
```

---

### **70.2. Написание тестов**
```sql
BEGIN;
SELECT plan(1);
SELECT is(1, 1, '1 equals 1');
SELECT * FROM finish();
ROLLBACK;
```

---

## **71. Работа с расширением `pgMemCache` для кэширования**

`pgMemCache` позволяет кэшировать данные в памяти.

---

### **71.1. Установка расширения**
```sql
CREATE EXTENSION pgmemcache;
```

---

### **71.2. Использование кэша**
```sql
SELECT memcache_set('key', 'value');
SELECT memcache_get('key');
```

**Пример:**
```sql
SELECT memcache_set('user_1', 'Иван');
SELECT memcache_get('user_1');
```

---

## **72. Работа с расширением `pg_bigm` для полнотекстового поиска на японском языке**

`pg_bigm` предоставляет функции для полнотекстового поиска на японском языке.

---

### **72.1. Установка расширения**
```sql
CREATE EXTENSION pg_bigm;
```

---

### **72.2. Создание индекса для японского текста**
```sql
CREATE INDEX index_name ON table_name USING GIN (column_name pg_bigm_ops);
```

---

## **73. Работа с расширением `pg_roaringbitmap` для работы с битовыми картами**

`pg_roaringbitmap` предоставляет функции для работы с битовыми картами.

---

### **73.1. Установка расширения**
```sql
CREATE EXTENSION pg_roaringbitmap;
```

---

### **73.2. Использование битовых карт**
```sql
SELECT bitmap_create(ARRAY[1, 2, 3]);
```

---

## **74. Работа с расширением `pg_partman` для управления разделами**

`pg_partman` автоматизирует управление разделами.

---

### **74.1. Установка расширения**
```sql
CREATE EXTENSION pg_partman;
```

---

### **74.2. Создание разделённой таблицы**
```sql
CREATE TABLE table_name (
    ...
) PARTITION BY RANGE (column_name);

SELECT create_parent('schema_name.table_name', 'column_name', 'prefix', 'interval');
```

**Пример:**
```sql
CREATE TABLE sales (
    sale_id SERIAL,
    sale_date DATE NOT NULL,
    amount DECIMAL(10, 2)
) PARTITION BY RANGE (sale_date);

SELECT create_parent('public.sales', 'sale_date', 'sales_', 'monthly');
```

---

### **74.3. Добавление нового раздела**
```sql
SELECT create_time_partition('interval', 'timestamp');
```

**Пример:**
```sql
SELECT create_time_partition('2023-01-01', '2023-02-01');
```

---

### **74.4. Удаление старого раздела**
```sql
SELECT drop_partition_time('timestamp');
```

**Пример:**
```sql
SELECT drop_partition_time('2022-01-01');
```

---

### **74.5. Настройка автоматического управления разделами**
```sql
SELECT run_maintenance();
```

---

## **75. Работа с расширением `timescaledb` для временных рядов**

`TimescaleDB` расширяет PostgreSQL для работы с временными рядами.

---

### **75.1. Установка расширения**
```sql
CREATE EXTENSION timescaledb;
```

---

### **75.2. Создание гипертаблицы**
```sql
SELECT create_hypertable('table_name', 'time_column');
```

**Пример:**
```sql
CREATE TABLE metrics (
    time TIMESTAMPTZ NOT NULL,
    device_id INTEGER,
    value DOUBLE PRECISION
);

SELECT create_hypertable('metrics', 'time');
```

---

### **75.3. Добавление данных в гипертаблицу**
```sql
INSERT INTO metrics (time, device_id, value)
VALUES (NOW(), 1, 42.5);
```

---

### **75.4. Запрос данных из гипертаблицы**
```sql
SELECT * FROM metrics WHERE time > NOW() - INTERVAL '1 day';
```

---

### **75.5. Создание непрерывных агрегатов**
```sql
SELECT create_continuous_aggregate(
    'view_name',
    'time_bucket_interval',
    'table_name',
    'time_column',
    'aggregate_column'
);
```

**Пример:**
```sql
SELECT create_continuous_aggregate(
    'metrics_daily_avg',
    '1 day',
    'metrics',
    'time',
    'AVG(value)'
);
```

---

### **75.6. Обновление непрерывных агрегатов**
```sql
SELECT refresh_continuous_aggregate('view_name', 'start_time', 'end_time');
```

**Пример:**
```sql
SELECT refresh_continuous_aggregate('metrics_daily_avg', NULL, NULL);
```

---

## **76. Работа с расширением `pg_graphql` для GraphQL**

`pg_graphql` позволяет выполнять GraphQL-запросы к PostgreSQL.

---

### **76.1. Установка расширения**
```sql
CREATE EXTENSION pg_graphql;
```

---

### **76.2. Выполнение GraphQL-запросов**
```sql
SELECT graphql('query { users { id name } }');
```

---

## **77. Работа с расширением `pg_net` для работы с сетями**

`pg_net` предоставляет функции для работы с сетями.

---

### **77.1. Установка расширения**
```sql
CREATE EXTENSION pg_net;
```

---

### **77.2. Использование сетевых функций**
```sql
SELECT ip4_in_cidr('192.168.1.1', '192.168.1.0/24');
```

---

## **78. Работа с расширением `pg_qualstats` для анализа условий в запросах**

`pg_qualstats` собирает статистику по условиям в запросах.

---

### **78.1. Установка расширения**
```sql
CREATE EXTENSION pgqualstats;
```

---

### **78.2. Просмотр статистики условий**
```sql
SELECT * FROM pgqualstats.pg_qualstats;
```

---

## **79. Работа с расширением `pg_stat_monitor` для мониторинга запросов**

`pg_stat_monitor` предоставляет расширенные возможности мониторинга запросов.

---

### **79.1. Установка расширения**
```sql
CREATE EXTENSION pg_stat_monitor;
```

---

### **79.2. Просмотр статистики запросов**
```sql
SELECT * FROM pg_stat_monitor;
```

---

## **80. Работа с расширением `pg_walinspect` для анализа WAL**

`pg_walinspect` позволяет анализировать содержимое WAL (Write-Ahead Log).

---

### **80.1. Установка расширения**
```sql
CREATE EXTENSION pg_walinspect;
```

---

### **80.2. Просмотр информации из WAL**
```sql
SELECT * FROM pg_walinspect_lsn_range('lsn_start', 'lsn_end');
```

---

## **81. Работа с расширением `pg_hint_plan` для управления планами выполнения**

`pg_hint_plan` позволяет управлять планами выполнения запросов с помощью hint-ов.

---

### **81.1. Установка расширения**
```sql
CREATE EXTENSION pg_hint_plan;
```

---

### **81.2. Использование hint-ов в запросах**
```sql
SELECT /*+ SeqScan(table_name) */ * FROM table_name;
```

**Пример:**
```sql
SELECT /*+ IndexScan(employees idx_employees_last_name) */ *
FROM employees
WHERE last_name = 'Иванов';
```

---

### **81.3. Настройка hint-ов на уровне базы данных**
```sql
SET pg_hint_plan.enable_hint = on;
SET pg_hint_plan.message_level = log;
```

---

## **82. Работа с расширением `pg_visibility` для анализа видимости строк**

`pg_visibility` позволяет анализировать видимость строк в таблицах.

---

### **82.1. Установка расширения**
```sql
CREATE EXTENSION pg_visibility;
```

---

### **82.2. Просмотр статистики видимости строк**
```sql
SELECT * FROM pg_visibility('schema_name.table_name');
```

**Пример:**
```sql
SELECT * FROM pg_visibility('public.employees');
```

---

## **83. Работа с расширением `pg_freespacemap` для анализа свободного пространства**

`pg_freespacemap` позволяет анализировать свободное пространство в таблицах.

---

### **83.1. Установка расширения**
```sql
CREATE EXTENSION pg_freespacemap;
```

---

### **83.2. Просмотр информации о свободном пространстве**
```sql
SELECT * FROM pg_freespace('schema_name.table_name');
```

**Пример:**
```sql
SELECT * FROM pg_freespace('public.employees');
```

---

## **84. Работа с расширением `pgrowlocks` для анализа блокировок строк**

`pgrowlocks` позволяет анализировать блокировки на уровне строк.

---

### **84.1. Установка расширения**
```sql
CREATE EXTENSION pgrowlocks;
```

---

### **84.2. Просмотр блокировок строк**
```sql
SELECT * FROM pgrowlocks('schema_name.table_name');
```

**Пример:**
```sql
SELECT * FROM pgrowlocks('public.employees');
```

---

## **85. Работа с расширением `pg_stat_kcache` для анализа использования кэша ядра**

`pg_stat_kcache` позволяет анализировать использование кэша ядра.

---

### **85.1. Установка расширения**
```sql
CREATE EXTENSION pg_stat_kcache;
```

---

### **85.2. Просмотр статистики использования кэша**
```sql
SELECT * FROM pg_stat_kcache;
```

---

## **86. Работа с расширением `pg_wait_sampling` для анализа ожиданий**

`pg_wait_sampling` позволяет анализировать, на чем тратится время ожидания в PostgreSQL.

---

### **86.1. Установка расширения**
```sql
CREATE EXTENSION pg_wait_sampling;
```

---

### **86.2. Запуск сбора статистики ожиданий**
```sql
SELECT pg_wait_sampling_start();
```

---

### **86.3. Просмотр статистики ожиданий**
```sql
SELECT * FROM pg_wait_sampling_get_samples();
```

---

### **86.4. Остановка сбора статистики ожиданий**
```sql
SELECT pg_wait_sampling_stop();
```

---

## **87. Работа с расширением `hypopg` для гипотетических индексов**

`hypopg` позволяет создавать гипотетические индексы для оценки их эффективности.

---

### **87.1. Установка расширения**
```sql
CREATE EXTENSION hypopg;
```

---

### **87.2. Создание гипотетического индекса**
```sql
SELECT * FROM hypopg_create_index('CREATE INDEX ON table_name (column_name)');
```

**Пример:**
```sql
SELECT * FROM hypopg_create_index('CREATE INDEX ON employees (last_name)');
```

---

### **87.3. Проверка использования гипотетического индекса**
```sql
EXPLAIN SELECT * FROM table_name WHERE condition;
```

---

### **87.4. Удаление гипотетического индекса**
```sql
SELECT * FROM hypopg_drop_index(index_oid);
```

---

## **88. Работа с расширением `pgqualstats` для анализа условий в запросах**

`pgqualstats` собирает статистику по условиям в запросах.

---

### **88.1. Установка расширения**
```sql
CREATE EXTENSION pgqualstats;
```

---

### **88.2. Просмотр статистики условий**
```sql
SELECT * FROM pgqualstats.pg_qualstats;
```

---

## **89. Работа с расширением `pg_track_settings` для отслеживания изменений настроек**

`pg_track_settings` позволяет отслеживать изменения настроек PostgreSQL.

---

### **89.1. Установка расширения**
```sql
CREATE EXTENSION pg_track_settings;
```

---

### **89.2. Просмотр истории изменений настроек**
```sql
SELECT * FROM pg_track_settings_history;
```

---

## **90. Работа с расширением `wal2json` для логической репликации**

`wal2json` позволяет преобразовывать WAL в формат JSON для логической репликации.

---

### **90.1. Установка расширения**
```sql
CREATE EXTENSION wal2json;
```

---

### **90.2. Настройка логической репликации с использованием `wal2json`**
```ini
# В postgresql.conf
wal_level = logical
```

---

## **91. Работа с расширением `pg_jieba` для китайской сегментации текста**

`pg_jieba` предоставляет функции для сегментации китайского текста.

---

### **91.1. Установка расширения**
```sql
CREATE EXTENSION pg_jieba;
```

---

### **91.2. Сегментация китайского текста**
```sql
SELECT jieba_segment('中文文本');
```

---

## **92. Работа с расширением `pg_similarity` для сравнения строк**

`pg_similarity` предоставляет функции для сравнения строк.

---

### **92.1. Установка расширения**
```sql
CREATE EXTENSION pg_similarity;
```

---

### **92.2. Сравнение строк**
```sql
SELECT similarity('string1', 'string2');
SELECT levenshtein('string1', 'string2');
```

**Пример:**
```sql
SELECT similarity('PostgreSQL', 'Postgres');
```

---

## **93. Работа с расширением `pgTAP` для тестирования**

`pgTAP` позволяет писать тесты для PostgreSQL.

---

### **93.1. Установка расширения**
```sql
CREATE EXTENSION pgtap;
```

---

### **93.2. Написание тестов**
```sql
BEGIN;
SELECT plan(1);
SELECT is(1, 1, '1 equals 1');
SELECT * FROM finish();
ROLLBACK;
```

---

## **94. Работа с расширением `pgMemCache` для кэширования**

`pgMemCache` позволяет кэшировать данные в памяти.

---

### **94.1. Установка расширения**
```sql
CREATE EXTENSION pgmemcache;
```

---

### **94.2. Использование кэша**
```sql
SELECT memcache_set('key', 'value');
SELECT memcache_get('key');
```

**Пример:**
```sql
SELECT memcache_set('user_1', 'Иван');
SELECT memcache_get('user_1');
```

---

## **95. Работа с расширением `pg_bigm` для полнотекстового поиска на японском языке**

`pg_bigm` предоставляет функции для полнотекстового поиска на японском языке.

---

### **95.1. Установка расширения**
```sql
CREATE EXTENSION pg_bigm;
```

---

### **95.2. Создание индекса для японского текста**
```sql
CREATE INDEX index_name ON table_name USING GIN (column_name pg_bigm_ops);
```

---

## **96. Работа с расширением `pg_roaringbitmap` для работы с битовыми картами**

`pg_roaringbitmap` предоставляет функции для работы с битовыми картами.

---

### **96.1. Установка расширения**
```sql
CREATE EXTENSION pg_roaringbitmap;
```

---

### **96.2. Использование битовых карт**
```sql
SELECT bitmap_create(ARRAY[1, 2, 3]);
```

---

## **97. Работа с расширением `pg_partman` для управления разделами**

`pg_partman` автоматизирует управление разделами.

---

### **97.1. Установка расширения**
```sql
CREATE EXTENSION pg_partman;
```

---

### **97.2. Создание разделённой таблицы**
```sql
CREATE TABLE table_name (
    ...
) PARTITION BY RANGE (column_name);

SELECT create_parent('schema_name.table_name', 'column_name', 'prefix', 'interval');
```

**Пример:**
```sql
CREATE TABLE sales (
    sale_id SERIAL,
    sale_date DATE NOT NULL,
    amount DECIMAL(10, 2)
) PARTITION BY RANGE (sale_date);

SELECT create_parent('public.sales', 'sale_date', 'sales_', 'monthly');
```

---

### **97.3. Добавление нового раздела**
```sql
SELECT create_time_partition('interval', 'timestamp');
```

**Пример:**
```sql
SELECT create_time_partition('2023-01-01', '2023-02-01');
```

---

### **97.4. Удаление старого раздела**
```sql
SELECT drop_partition_time('timestamp');
```

**Пример:**
```sql
SELECT drop_partition_time('2022-01-01');
```

---

### **97.5. Настройка автоматического управления разделами**
```sql
SELECT run_maintenance();
```

---

## **98. Работа с расширением `timescaledb` для временных рядов**

`TimescaleDB` расширяет PostgreSQL для работы с временными рядами.

---

### **98.1. Установка расширения**
```sql
CREATE EXTENSION timescaledb;
```

---

### **98.2. Создание гипертаблицы**
```sql
SELECT create_hypertable('table_name', 'time_column');
```

**Пример:**
```sql
CREATE TABLE metrics (
    time TIMESTAMPTZ NOT NULL,
    device_id INTEGER,
    value DOUBLE PRECISION
);

SELECT create_hypertable('metrics', 'time');
```

---

### **98.3. Добавление данных в гипертаблицу**
```sql
INSERT INTO metrics (time, device_id, value)
VALUES (NOW(), 1, 42.5);
```

---

### **98.4. Запрос данных из гипертаблицы**
```sql
SELECT * FROM metrics WHERE time > NOW() - INTERVAL '1 day';
```

---

### **98.5. Создание непрерывных агрегатов**
```sql
SELECT create_continuous_aggregate(
    'view_name',
    'time_bucket_interval',
    'table_name',
    'time_column',
    'aggregate_column'
);
```

**Пример:**
```sql
SELECT create_continuous_aggregate(
    'metrics_daily_avg',
    '1 day',
    'metrics',
    'time',
    'AVG(value)'
);
```

---

### **98.6. Обновление непрерывных агрегатов**
```sql
SELECT refresh_continuous_aggregate('view_name', 'start_time', 'end_time');
```

**Пример:**
```sql
SELECT refresh_continuous_aggregate('metrics_daily_avg', NULL, NULL);
```

---

## **99. Работа с расширением `pg_graphql` для GraphQL**

`pg_graphql` позволяет выполнять GraphQL-запросы к PostgreSQL.

---

### **99.1. Установка расширения**
```sql
CREATE EXTENSION pg_graphql;
```

---

### **99.2. Выполнение GraphQL-запросов**
```sql
SELECT graphql('query { users { id name } }');
```

---

## **100. Работа с расширением `pg_net` для работы с сетями**

`pg_net` предоставляет функции для работы с сетями.

---

### **100.1. Установка расширения**
```sql
CREATE EXTENSION pg_net;
```

---

### **100.2. Использование сетевых функций**
```sql
SELECT ip4_in_cidr('192.168.1.1', '192.168.1.0/24');
```

---