## **7. Dead Letter Queue (DLQ, Очередь "мёртвых писем")**
### **Цель**
Сохранять сообщения, которые не удалось обработать, для последующего анализа или повторной обработки.

---

### **Принцип работы**
- Если сообщение не может быть обработано, оно отправляется в отдельную очередь (DLQ).
- Позже сообщения из DLQ можно проанализировать или обработать повторно.

---

### **Пример с Kafka**
```csharp
using Confluent.Kafka;
using System;
using System.Threading.Tasks;

class KafkaDlqExample
{
    static async Task Main()
    {
        var config = new ConsumerConfig { GroupId = "example-group", BootstrapServers = "localhost:9092" };
        using var consumer = new ConsumerBuilder<Ignore, string>(config).Build();
        consumer.Subscribe("example-topic");

        var producer = new ProducerBuilder<Null, string>(new ProducerConfig { BootstrapServers = "localhost:9092" }).Build();

        try
        {
            while (true)
            {
                var consumeResult = consumer.Consume();
                try
                {
                    if (consumeResult.Message.Value.Contains("error"))
                    {
                        throw new Exception("Ошибка обработки!");
                    }
                    Console.WriteLine($"Обработано сообщение: {consumeResult.Message.Value}");
                }
                catch (Exception ex)
                {
                    // Отправляем в DLQ-топик
                    await producer.ProduceAsync("example-dlq-topic", new Message<Null, string> { Value = consumeResult.Message.Value });
                    Console.WriteLine($"Сообщение отправлено в DLQ: {ex.Message}");
                }
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Ошибка: {ex.Message}");
        }
    }
}
```

---

### **Плюсы и минусы**
| Плюсы                                      | Минусы                                      |
|--------------------------------------------|---------------------------------------------|
| Позволяет анализировать failed сообщения.  | Требует дополнительной логики для обработки DLQ. |
| Улучшает надёжность системы.               | Может привести к накоплению сообщений в DLQ. |