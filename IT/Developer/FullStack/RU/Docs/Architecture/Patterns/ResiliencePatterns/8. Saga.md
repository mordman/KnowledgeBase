## **8. Saga (Сага)**
### **Цель**
Управлять распределёнными транзакциями через последовательность локальных транзакций с компенсирующими действиями.

---

### **Принцип работы**
- Каждая локальная транзакция выполняется последовательно.
- Если одна из транзакций failed, выполняются компенсирующие действия для отмены предыдущих транзакций.

---

### **Пример**
Рассмотрим процесс бронирования отеля и авиабилетов:
1. **Бронирование отеля** → Успех.
2. **Бронирование авиабилета** → Провал.
3. **Компенсирующее действие:** Отмена бронирования отеля.

---

### **Реализация на C#**
```csharp
using System;
using System.Threading.Tasks;

class SagaExample
{
    static async Task Main()
    {
        try
        {
            // 1. Бронирование отеля
            await BookHotel();
            Console.WriteLine("Отель забронирован!");

            // 2. Бронирование авиабилета
            await BookFlight();
            Console.WriteLine("Авиабилет забронирован!");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Ошибка: {ex.Message}");
            // Компенсирующее действие: отмена бронирования отеля
            await CancelHotel();
            Console.WriteLine("Бронирование отеля отменено.");
        }
    }

    static async Task BookHotel()
    {
        await Task.Delay(100);
        Console.WriteLine("Отель забронирован (локальная транзакция).");
    }

    static async Task BookFlight()
    {
        await Task.Delay(100);
        throw new Exception("Не удалось забронировать авиабилет!");
    }

    static async Task CancelHotel()
    {
        await Task.Delay(100);
        Console.WriteLine("Бронирование отеля отменено (компенсирующее действие).");
    }
}
```

---

### **Плюсы и минусы**
| Плюсы                                      | Минусы                                      |
|--------------------------------------------|---------------------------------------------|
| Подходит для распределённых систем.        | Сложность реализации и отладки.             |
| Обеспечивает согласованность данных.       | Требует поддержки компенсирующих действий.  |