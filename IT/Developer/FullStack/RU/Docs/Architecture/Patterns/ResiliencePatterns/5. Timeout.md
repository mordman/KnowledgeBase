## **5. Timeout (Таймаут)**


## Оглавление
- [**5. Timeout (Таймаут)**](#5-timeout-таймаут)
  - [**Цель**](#цель)
  - [**Принцип работы**](#принцип-работы)
  - [**Пример на C# (Polly)**](#пример-на-c-polly)
  - [**Пример с базой данных**](#пример-с-базой-данных)
  - [**Плюсы и минусы**](#плюсы-и-минусы)

  - [**Цель**](#цель)
  - [**Принцип работы**](#принцип-работы)
  - [**Пример на C# (Polly)**](#пример-на-c-polly)
  - [**Пример с базой данных**](#пример-с-базой-данных)
  - [**Плюсы и минусы**](#плюсы-и-минусы)
### **Цель**
Ограничить время ожидания ответа от внешней зависимости, чтобы избежать "зависания" системы.

---

### **Принцип работы**
- Если операция не завершилась за заданное время, она прерывается.
- Часто используется вместе с **Retry** или **Circuit Breaker**.

---

### **Пример на C# (Polly)**
```csharp
using Polly;
using System;
using System.Net.Http;
using System.Threading.Tasks;

class Program
{
    static async Task Main()
    {
        var timeoutPolicy = Policy.TimeoutAsync(TimeSpan.FromSeconds(5)); // Ждём максимум 5 секунд

        try
        {
            await timeoutPolicy.ExecuteAsync(async () =>
            {
                HttpClient httpClient = new HttpClient();
                HttpResponseMessage response = await httpClient.GetAsync("https://example.com/api");
                response.EnsureSuccessStatusCode();
                Console.WriteLine("Запрос успешен!");
            });
        }
        catch (TimeoutRejectedException)
        {
            Console.WriteLine("Запрос прерван по таймауту!");
        }
    }
}
```

---

### **Пример с базой данных**
```csharp
using Polly;
using System.Data.SqlClient;
using System.Threading.Tasks;

class TimeoutDatabaseExample
{
    static async Task Main()
    {
        var timeoutPolicy = Policy.TimeoutAsync(TimeSpan.FromSeconds(2)); // Ждём максимум 2 секунды

        try
        {
            await timeoutPolicy.ExecuteAsync(async () =>
            {
                using (var connection = new SqlConnection("Server=localhost;Database=Example;"))
                {
                    await connection.OpenAsync();
                    Console.WriteLine("Соединение с базой данных установлено!");
                }
            });
        }
        catch (TimeoutRejectedException)
        {
            Console.WriteLine("Превышено время ожидания соединения с базой данных!");
        }
    }
}
```

---

### **Плюсы и минусы**
| Плюсы                                      | Минусы                                      |
|--------------------------------------------|---------------------------------------------|
| Предотвращает "зависание" системы.         | Может привести к ложным срабатываниям.      |
| Улучшает отзывчивость.                     | Требует настройки оптимального времени.     |