## **6. Rate Limiter (Ограничение частоты запросов)**
### **Цель**
Ограничить количество запросов к сервису в единицу времени, чтобы избежать перегрузки.

---

### **Принцип работы**
- Ограничивает количество запросов в заданный интервал времени.
- Если лимит превышен, запросы отклоняются или ставятся в очередь.

---

### **Пример на C# (Polly)**
```csharp
using Polly;
using Polly.RateLimit;
using System;
using System.Threading.Tasks;

class Program
{
    static async Task Main()
    {
        var rateLimiterPolicy = Policy
            .RateLimitAsync(
                numberOfExecutions: 10, // Максимум 10 запросов
                perTimeSpan: TimeSpan.FromSeconds(1), // За 1 секунду
                maxBurst: 5); // Максимум 5 запросов одновременно

        for (int i = 0; i < 20; i++)
        {
            try
            {
                await rateLimiterPolicy.ExecuteAsync(async () =>
                {
                    Console.WriteLine($"Запрос {i} выполнен в {DateTime.Now:HH:mm:ss}");
                    await Task.Delay(100);
                });
            }
            catch (RateLimitRejectedException ex)
            {
                Console.WriteLine($"Запрос {i} отклонён: {ex.Message}");
            }
        }
    }
}
```

---

### **Пример с API**
Ограничение количества запросов к внешнему API:
```csharp
using Polly;
using Polly.RateLimit;
using System;
using System.Net.Http;
using System.Threading.Tasks;

class RateLimiterApiExample
{
    static async Task Main()
    {
        var rateLimiterPolicy = Policy
            .RateLimitAsync(100, TimeSpan.FromMinutes(1)); // 100 запросов в минуту

        HttpClient httpClient = new HttpClient();

        for (int i = 0; i < 150; i++)
        {
            try
            {
                await rateLimiterPolicy.ExecuteAsync(async () =>
                {
                    HttpResponseMessage response = await httpClient.GetAsync("https://example.com/api");
                    response.EnsureSuccessStatusCode();
                    Console.WriteLine($"Запрос {i} успешен!");
                });
            }
            catch (RateLimitRejectedException)
            {
                Console.WriteLine($"Запрос {i} отклонён: превышен лимит.");
            }
        }
    }
}
```

---

### **Плюсы и минусы**
| Плюсы                                      | Минусы                                      |
|--------------------------------------------|---------------------------------------------|
| Защищает от перегрузок.                    | Может создать узкое место.                  |
| Улучшает стабильность системы.             | Требует настройки лимитов.                  |